{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport styled from 'styled-components';\nimport ShoppingCartIcon from '@material-ui/icons/ShoppingCart';\nimport React, { useEffect } from 'react';\nimport { dealImgUrl } from '../../tools/img';\nimport { Card, IconButton } from '@material-ui/core';\nimport { dealMoney } from '../../tools/utils';\nimport { mpStyle } from '../../style/common';\nimport { modelFactory } from '../../ModelAction/modelUtil';\nimport { useStoreModel } from '../../ModelAction/useStore';\nimport { meModel } from '../../view/me/model';\nimport { doc } from '../../graphqlTypes/doc';\nimport { showMessage } from '../Message/Message';\nexport var productModel = modelFactory('productModel', {}, {\n  updateNumShopCart: function () {\n    var _updateNumShopCart = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.mutate(doc.updateNumShopCart, _objectSpread({\n                shopCart: value\n              }, value.number ? {\n                updateNum: value.number\n              } : {}));\n\n            case 2:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function updateNumShopCart(_x, _x2) {\n      return _updateNumShopCart.apply(this, arguments);\n    }\n\n    return updateNumShopCart;\n  }()\n});\nvar Box = styled(Card).withConfig({\n  displayName: \"ProductItem__Box\",\n  componentId: \"sc-1cef71f-0\"\n})([\"padding:10px 10px 0;> header{width:100%;height:40vw;> img{border-radius:8px;width:100%;height:40vw;}}> main{margin-top:10px;}> footer{margin-top:4px;display:flex;align-items:center;> main{flex-grow:1;}> .MuiButtonBase-root{padding:5px;}}\"]);\nexport var ProductPrice = function ProductPrice(_ref) {\n  var product = _ref.product;\n  return __jsx(React.Fragment, null, __jsx(\"aside\", {\n    style: {\n      display: 'inline-block',\n      fontSize: '12px',\n      textDecoration: 'line-through'\n    }\n  }, dealMoney(product === null || product === void 0 ? void 0 : product.priceMarket)), __jsx(\"main\", {\n    style: {\n      display: 'inline-block',\n      fontSize: '14px',\n      marginLeft: '6px',\n      color: mpStyle.red\n    }\n  }, dealMoney(product === null || product === void 0 ? void 0 : product.priceOut)));\n};\nexport var ProductItem = function ProductItem(_ref2) {\n  var _product$img, _product$img$, _stateMe$user;\n\n  var product = _ref2.product;\n\n  var _useStoreModel = useStoreModel(meModel),\n      stateMe = _useStoreModel.state,\n      actionsMe = _useStoreModel.actions;\n\n  useEffect(function () {\n    if (!stateMe.user.id) {\n      actionsMe.getLoginUser();\n    }\n  }, []);\n\n  var _useStoreModel2 = useStoreModel(productModel),\n      actionsPM = _useStoreModel2.actions;\n\n  return __jsx(Box, null, __jsx(\"header\", null, __jsx(\"img\", {\n    src: dealImgUrl(product === null || product === void 0 ? void 0 : (_product$img = product.img) === null || _product$img === void 0 ? void 0 : (_product$img$ = _product$img[0]) === null || _product$img$ === void 0 ? void 0 : _product$img$.url),\n    alt: \"\"\n  })), __jsx(\"main\", null, product.name, product.weight, product.unit), __jsx(\"footer\", null, __jsx(ProductPrice, {\n    product: product\n  }), ((_stateMe$user = stateMe.user) === null || _stateMe$user === void 0 ? void 0 : _stateMe$user.id) && __jsx(IconButton, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _yield$actionsPM$upda, _yield$actionsPM$upda2;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return actionsPM.updateNumShopCart({\n                product: product\n              });\n\n            case 2:\n              _context2.t1 = _yield$actionsPM$upda = _context2.sent;\n              _context2.t0 = _context2.t1 === null;\n\n              if (_context2.t0) {\n                _context2.next = 6;\n                break;\n              }\n\n              _context2.t0 = _yield$actionsPM$upda === void 0;\n\n            case 6:\n              if (!_context2.t0) {\n                _context2.next = 10;\n                break;\n              }\n\n              _context2.t2 = void 0;\n              _context2.next = 11;\n              break;\n\n            case 10:\n              _context2.t2 = (_yield$actionsPM$upda2 = _yield$actionsPM$upda.updateNumShopCart) === null || _yield$actionsPM$upda2 === void 0 ? void 0 : _yield$actionsPM$upda2.id;\n\n            case 11:\n              if (!_context2.t2) {\n                _context2.next = 13;\n                break;\n              }\n\n              showMessage('操作成功');\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }))\n  }, __jsx(ShoppingCartIcon, {\n    color: 'secondary'\n  }))));\n};","map":null,"metadata":{},"sourceType":"module"}