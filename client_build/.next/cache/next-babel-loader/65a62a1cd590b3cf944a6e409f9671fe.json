{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { MainBox } from '../pcComponents/mainBox/mainBox';\nimport { PcHeader } from '../pcComponents/header/header';\nimport { PcContentBox } from '../home/pcHome';\nimport styled from 'styled-components';\nimport { TopAction } from '../pcComponents/topAction/topAction';\nimport { HeaderTab } from '../home/components/headerTab';\nimport { Space } from '../../../components/Box/Box';\nimport { mpStyle, RedBox } from '../../../style/common';\nimport { ls } from '../../../tools/dealKey';\nimport { dealMaybeNumber, dealMoney, fpMergePre } from '../../../tools/utils';\nimport { useOrderPageHooks } from '../../m/cart/orderPage';\nimport { Divider, TextField, Button, ExpansionPanel, ExpansionPanelSummary, ExpansionPanelDetails, ButtonBase } from '@material-ui/core';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { useRouter } from 'next/router';\nimport { grey } from '@material-ui/core/colors';\nimport { showMessage } from '../../../components/Message/Message';\nconst OrderContentBox = styled.div.withConfig({\n  displayName: \"orderPage__OrderContentBox\",\n  componentId: \"l65kr3-0\"\n})([\"display:grid;grid-template-columns:1fr 450px;grid-gap:\", \";\"], mpStyle.spacePx.n);\nconst ModifyBox = styled.div.withConfig({\n  displayName: \"orderPage__ModifyBox\",\n  componentId: \"l65kr3-1\"\n})([\"&&&{.MuiExpansionPanelDetails-root{flex-direction:column;}}\"]);\nconst OrderDetailBox = styled.div.withConfig({\n  displayName: \"orderPage__OrderDetailBox\",\n  componentId: \"l65kr3-2\"\n})([\"padding:\", \";border:1px solid \", \";> header{\", \";}\"], mpStyle.spacePx.xs, mpStyle.greyLite, mpStyle.fontType.n);\nconst ShopTotal = styled.div.withConfig({\n  displayName: \"orderPage__ShopTotal\",\n  componentId: \"l65kr3-3\"\n})([\"display:flex;justify-content:space-between;margin-top:\", \";\"], mpStyle.spacePx.xs);\nconst RedSpan = styled.span.withConfig({\n  displayName: \"orderPage__RedSpan\",\n  componentId: \"l65kr3-4\"\n})([\"color:\", \";\"], mpStyle.red);\nconst FillInputBox = styled.div.withConfig({\n  displayName: \"orderPage__FillInputBox\",\n  componentId: \"l65kr3-5\"\n})([\"&&&{.MuiFilledInput-input{padding-top:10px;}}\"]);\nconst TabHeader = styled.div.withConfig({\n  displayName: \"orderPage__TabHeader\",\n  componentId: \"l65kr3-6\"\n})([\"\", \";display:flex;align-items:center;> aside{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;border:1px solid \", \";margin-right:\", \";\", \";}\"], mpStyle.fontType.n, mpStyle.grey, mpStyle.spacePx.xxs, props => props.isAct && `\n      background: ${mpStyle.red};\n      border-color: ${mpStyle.red};\n      color: #fff;\n    `);\nconst ProductBox = styled.div.withConfig({\n  displayName: \"orderPage__ProductBox\",\n  componentId: \"l65kr3-7\"\n})([\"width:100%;border:1px solid \", \";border-radius:4px;\"], mpStyle.greyLite);\nconst ProductBoxHeader = styled.div.withConfig({\n  displayName: \"orderPage__ProductBoxHeader\",\n  componentId: \"l65kr3-8\"\n})([\"height:60px;background:\", \";display:flex;align-items:center;\"], mpStyle.greyLite);\nconst ProductRow = styled.div.withConfig({\n  displayName: \"orderPage__ProductRow\",\n  componentId: \"l65kr3-9\"\n})([\"margin:\", \" 0;display:grid;grid-template-columns:200px 1fr 200px;grid-template-rows:1fr 32px 32px;grid-template-areas:\\\"img a d\\\" \\\"img b d\\\" \\\"img c d\\\";> img{grid-area:img;justify-self:center;width:80px;height:120px;}> div{display:flex;}> section{grid-area:a;}> aside{grid-area:d;display:flex;flex-direction:column;justify-content:flex-end;> header{height:40px;flex-basis:70%;}\", \"{\", \";flex-grow:1;}}\"], mpStyle.spacePx.n, RedBox, mpStyle.fontType.n);\nconst ProductFooter = styled.div.withConfig({\n  displayName: \"orderPage__ProductFooter\",\n  componentId: \"l65kr3-10\"\n})([\"display:flex;justify-content:space-between;.MuiButton-root{width:45%;}\"]);\nconst AddressBox = styled.div.withConfig({\n  displayName: \"orderPage__AddressBox\",\n  componentId: \"l65kr3-11\"\n})([\"display:grid;grid-template-columns:repeat(3,1fr);grid-gap:\", \";\"], mpStyle.spacePx.xs);\nconst AddressBoxItem = styled(ButtonBase).withConfig({\n  displayName: \"orderPage__AddressBoxItem\",\n  componentId: \"l65kr3-12\"\n})([\"&&&{flex-direction:column;align-items:flex-start;border:1px solid \", \";border-radius:4px;padding:\", \";cursor:pointer;\", \";}\"], grey[800], mpStyle.spacePx.xxs, props => props.isAct && `\n      background: ${mpStyle.red};\n      color: #fff;\n      border: none;\n    `);\nconst ActStepEnum = {\n  product: 'product',\n  address: 'address',\n  payType: 'payType'\n};\nexport const PcOrderPageModel = modelFactory('PcOrderPageModel', {\n  actStep: ActStepEnum.product\n}, {\n  updateActStep: async (value, option) => {\n    option.setData(fpMergePre({\n      actStep: value\n    }));\n  }\n});\nexport const OrderPage = () => {\n  var _stateShopCartModel$f, _stateShopCartModel$f2, _stateShopCartModel$u, _stateShopCartModel$f3, _stateShopCartModel$f4;\n\n  const router = useRouter();\n  const {\n    stateShopCartModel,\n    actionsShopCartModel,\n    getLoad,\n    addressData,\n    cardData,\n    productTotal,\n    transportationCosts,\n    actuallyPaid,\n    generateCoin\n  } = useOrderPageHooks();\n  const {\n    actions: actionsPcOrderPageModel,\n    state: statePcOrderPageModel\n  } = useStoreModel(PcOrderPageModel);\n  const addressList = stateShopCartModel.dealAddressList(stateShopCartModel);\n  console.log(addressList);\n  console.log(stateShopCartModel.form);\n  return __jsx(MainBox, null, __jsx(PcHeader, null), __jsx(PcContentBox, null, __jsx(TopAction, null), __jsx(HeaderTab, null), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(OrderContentBox, null, __jsx(ModifyBox, null, __jsx(ExpansionPanel, {\n    elevation: 0,\n    expanded: true\n  }, __jsx(ExpansionPanelSummary, null, __jsx(TabHeader, {\n    isAct: statePcOrderPageModel.actStep === ActStepEnum.address\n  }, __jsx(\"aside\", null, \"1\"), ls('选择地址'))), __jsx(ExpansionPanelDetails, null, __jsx(AddressBox, null, addressList.map(v => __jsx(AddressBoxItem, {\n    key: `addressList.map${v.id}`,\n    isAct: stateShopCartModel.form.addressId === v.id,\n    onClick: () => {\n      actionsShopCartModel.setForm(['addressId', v.id]);\n    }\n  }, __jsx(\"header\", null, v.name), __jsx(\"main\", null, v.address), __jsx(\"footer\", null, `${v.city} ${v.province} ${v.zip}`)))))), __jsx(ExpansionPanel, {\n    elevation: 0,\n    expanded: true\n  }, __jsx(ExpansionPanelSummary, null, __jsx(TabHeader, null, __jsx(\"aside\", null, \"2\"), ls('选择付款方式'))), __jsx(ExpansionPanelDetails, null, __jsx(AddressBox, null, stateShopCartModel.payCardList.map(v => __jsx(AddressBoxItem, {\n    key: `addressList.map${v.id}`,\n    isAct: stateShopCartModel.form.paymentMethodCardId === v.id,\n    onClick: () => {\n      actionsShopCartModel.setForm(['paymentMethodCardId', v.id]);\n    }\n  }, __jsx(\"header\", null, v.name), __jsx(\"footer\", null, `${v.number}`))))))), __jsx(OrderDetailBox, null, __jsx(\"header\", null, ls('订单详情')), __jsx(ShopTotal, null, __jsx(\"header\", null, ls('购物车总计')), __jsx(\"footer\", null, dealMoney(productTotal - ((_stateShopCartModel$f = (_stateShopCartModel$f2 = stateShopCartModel.form) === null || _stateShopCartModel$f2 === void 0 ? void 0 : _stateShopCartModel$f2.couponDiscount) !== null && _stateShopCartModel$f !== void 0 ? _stateShopCartModel$f : 0)))), transportationCosts > 0 && __jsx(ShopTotal, null, __jsx(\"header\", null, ls('运费')), __jsx(\"footer\", null, dealMoney(transportationCosts))), __jsx(ShopTotal, null, __jsx(\"header\", null, ls('达人币抵扣')), __jsx(\"footer\", null, dealMoney(stateShopCartModel.form.deductCoin, '-'))), __jsx(Space, {\n    h: mpStyle.space.xs\n  }), __jsx(Divider, {\n    light: true\n  }), __jsx(ShopTotal, {\n    style: {\n      fontSize: '18px'\n    }\n  }, __jsx(\"header\", null, ls('订单总额')), __jsx(\"footer\", null, dealMoney(actuallyPaid))), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(\"div\", null, ls('使用达人币'), __jsx(RedSpan, null, ls('当月可用余额'), \" \", dealMoney((_stateShopCartModel$u = stateShopCartModel.user) === null || _stateShopCartModel$u === void 0 ? void 0 : _stateShopCartModel$u.orderCoinCurrentMonth))), __jsx(Space, {\n    h: mpStyle.space.xxs\n  }), __jsx(FillInputBox, null, __jsx(TextField, {\n    variant: 'filled',\n    label: ls(''),\n    value: stateShopCartModel.form.deductCoin,\n    onChange: e => {\n      actionsShopCartModel.setForm(['deductCoin', e.target.value]);\n    }\n  })), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(ShopTotal, null, __jsx(\"header\", null, ls('购物车总计')), __jsx(\"footer\", null, dealMoney(productTotal - ((_stateShopCartModel$f3 = (_stateShopCartModel$f4 = stateShopCartModel.form) === null || _stateShopCartModel$f4 === void 0 ? void 0 : _stateShopCartModel$f4.couponDiscount) !== null && _stateShopCartModel$f3 !== void 0 ? _stateShopCartModel$f3 : 0)))), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(Button, {\n    fullWidth: true,\n    variant: 'contained',\n    color: 'secondary',\n    onClick: async () => {\n      var _stateShopCartModel$u2, _stateShopCartModel$u3, _res$saveOrder;\n\n      if (dealMaybeNumber((_stateShopCartModel$u2 = stateShopCartModel.user) === null || _stateShopCartModel$u2 === void 0 ? void 0 : _stateShopCartModel$u2.orderCoinCurrentMonth) < dealMaybeNumber(stateShopCartModel.form.deductCoin)) {\n        showMessage(ls('达人币余额不足'));\n        return;\n      }\n\n      const submitData = _objectSpread(_objectSpread({}, stateShopCartModel.form), {}, {\n        generateCoin,\n        actuallyPaid,\n        transportationCosts,\n        subtotal: productTotal,\n        currentUserLevel: (_stateShopCartModel$u3 = stateShopCartModel.user.userInfo) === null || _stateShopCartModel$u3 === void 0 ? void 0 : _stateShopCartModel$u3.userLevel,\n        rOrderProduct: stateShopCartModel.shopCartList.map(v => {\n          var _v$product;\n\n          return {\n            count: v.number,\n            productId: (_v$product = v.product) === null || _v$product === void 0 ? void 0 : _v$product.id,\n            product: v.product\n          };\n        })\n      });\n\n      const res = await actionsShopCartModel.submit(_objectSpread({}, submitData));\n\n      if (res === null || res === void 0 ? void 0 : (_res$saveOrder = res.saveOrder) === null || _res$saveOrder === void 0 ? void 0 : _res$saveOrder.id) {\n        showMessage('操作成功'); // const _query = dealUrlQuery({orderId: res?.saveOrder?.id})\n\n        await router.replace(`/pc/home`);\n        actionsShopCartModel.clearData();\n        actionsShopCartModel.getList();\n      }\n    }\n  }, ls('提交订单'))))));\n};","map":null,"metadata":{},"sourceType":"module"}