{"ast":null,"code":"var _this = this,\n    _jsxFileName = \"D:\\\\code\\\\zw\\\\zw_client_web\\\\utils\\\\view\\\\pay\\\\index.tsx\",\n    _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport Head from 'next/head';\nimport { HeaderTitle } from '../../components/HeaderTitle/HeaderTitle';\nimport { useRouter } from 'next/router';\nimport { showMessage } from '../../components/Message/Message';\nimport { useStoreModel } from '../../ModelAction/useStore';\nimport { orderDetailModel } from '../me/orderDetail/orderDetail';\nimport { dealMoney } from '../../tools/utils';\nimport { OrderState } from '../../ss_common/enum';\nvar applicationId = false ? 'sq0idp-IAEwX77Hdunl5dWByHQjIQ' : 'sandbox-sq0idb-42FQ7wGBwzibToRM9_zdFw'; // const applicationId = 'sq0idp-IAEwX77Hdunl5dWByHQjIQ'\n\nexport var Pay = function Pay() {\n  _s();\n\n  var _ref, _router$query;\n\n  var router = useRouter();\n  var orderId = (_ref = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.orderId) !== null && _ref !== void 0 ? _ref : '';\n\n  var _useStoreModel = useStoreModel(orderDetailModel),\n      stateOD = _useStoreModel.state,\n      actionsOD = _useStoreModel.actions;\n\n  var orderInfo = stateOD.orderInfo;\n  useEffect(function () {\n    if (orderId) {\n      actionsOD.getDetail(\"\".concat(orderId));\n    }\n  }, [orderId]);\n  useEffect(function () {\n    // @ts-ignore\n    if (window.SqPaymentForm && orderInfo.actuallyPaid) {\n      var _document$querySelect;\n\n      // @ts-ignore\n      var paymentForm = new SqPaymentForm({\n        // Initialize the payment form elements\n        applicationId: applicationId,\n        inputClass: 'sq-input',\n        autoBuild: false,\n        // Customize the CSS for SqPaymentForm iframe elements\n        inputStyles: [{\n          fontSize: '16px',\n          lineHeight: '24px',\n          padding: '16px',\n          placeholderColor: '#a0a0a0',\n          backgroundColor: 'transparent'\n        }],\n        // Initialize the credit card placeholders\n        cardNumber: {\n          elementId: 'sq-card-number',\n          placeholder: 'Card Number'\n        },\n        cvv: {\n          elementId: 'sq-cvv',\n          placeholder: 'CVV'\n        },\n        expirationDate: {\n          elementId: 'sq-expiration-date',\n          placeholder: 'MM/YY'\n        },\n        postalCode: {\n          elementId: 'sq-postal-code',\n          placeholder: 'Postal'\n        },\n        // SqPaymentForm callback functions\n        callbacks: {\n          /*\r\n          * callback function: cardNonceResponseReceived\r\n          * Triggered when: SqPaymentForm completes a card nonce request\r\n          */\n          cardNonceResponseReceived: function cardNonceResponseReceived(errors, nonce, cardData) {\n            var _orderInfo$actuallyPa;\n\n            if (errors) {\n              // Log errors from nonce generation to the browser developer console.\n              console.error('Encountered errors:');\n              errors.forEach(function (error) {\n                console.error('  ' + error.message);\n              });\n              showMessage('Encountered errors, check browser developer console for more details');\n              return;\n            } // alert(`The generated nonce is:\\n${nonce}`)\n\n\n            fetch(\"/pay/process-payment\", {\n              method: 'POST',\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify({\n                nonce: nonce,\n                amount: ~~(((_orderInfo$actuallyPa = orderInfo.actuallyPaid) !== null && _orderInfo$actuallyPa !== void 0 ? _orderInfo$actuallyPa : 0) * 100)\n              })\n            })[\"catch\"](function (err) {\n              showMessage('Network error: ' + err);\n            }).then(function (response) {\n              if (!response.ok) {\n                return response.json().then(function (errorInfo) {\n                  return Promise.reject(errorInfo);\n                }); //UPDATE HERE\n              }\n\n              return response.json(); //UPDATE HERE\n            }).then(function (data) {\n              // console.log(data) //UPDATE HERE\n              // showMessage('Payment complete successfully!\\nCheck browser developer console for more details')\n              return actionsOD.updateOrder({\n                id: orderId,\n                state: OrderState.Paid\n              });\n            }).then(function () {\n              showMessage('支付成功');\n              router.replace('/cart/result');\n            })[\"catch\"](function (err) {\n              console.error(err);\n              showMessage('Payment failed to complete!\\nCheck browser developer console for more details');\n            });\n          }\n        }\n      });\n      paymentForm.build();\n\n      var onGetCardNonce = function onGetCardNonce(event) {\n        // Don't submit the form until SqPaymentForm returns with a nonce\n        event.preventDefault(); // Request a nonce from the SqPaymentForm object\n\n        paymentForm.requestCardNonce();\n      };\n\n      (_document$querySelect = document.querySelector('#sq-creditcard')) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.addEventListener('click', onGetCardNonce);\n    }\n  }, [orderInfo.actuallyPaid]);\n  return __jsx(\"div\", {\n    className: \"jsx-2628901187\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 10\n    }\n  }, __jsx(Head, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, __jsx(\"title\", {\n    className: \"jsx-2628901187\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }\n  }, \"pay\"), __jsx(\"script\", {\n    type: \"text/javascript\",\n    src: \"https://js.squareup.com/v2/paymentform\",\n    className: \"jsx-2628901187\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  })), __jsx(HeaderTitle, {\n    title: '支付',\n    backCall: function backCall() {\n      router.replace('/home');\n      return true;\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 5\n    }\n  }), __jsx(\"div\", {\n    id: \"form-container\",\n    className: \"jsx-2628901187\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    id: \"sq-card-number\",\n    className: \"jsx-2628901187\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    id: \"sq-expiration-date\",\n    className: \"jsx-2628901187\" + \" \" + \"third\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    id: \"sq-cvv\",\n    className: \"jsx-2628901187\" + \" \" + \"third\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    id: \"sq-postal-code\",\n    className: \"jsx-2628901187\" + \" \" + \"third\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }), __jsx(\"button\", {\n    id: \"sq-creditcard\",\n    className: \"jsx-2628901187\" + \" \" + \"button-credit-card\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, \"Pay \", dealMoney(orderInfo.actuallyPaid))), __jsx(_JSXStyle, {\n    id: \"2628901187\",\n    __self: _this\n  }, \"*{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}body,html{background-color:#F7F8F9;color:#373F4A;font-family:\\\"Helvetica Neue\\\",Helvetica,Arial,sans-serif;font-weight:normal;height:100%;}button{border:0;font-weight:500;}fieldset{margin:0;padding:0;border:0;}#form-container{padding:6.25vw;}.third{float:left;width:calc((100% - 10vw) / 3);padding:0;margin:0 5vw 5vw 0;}.third:last-of-type{margin-right:0;}.sq-input{height:56PX;box-sizing:border-box;border:1px solid #E0E2E3;background-color:white;border-radius:1.875vw;display:inline-block;-webkit-transition:border-color .2s ease-in-out;transition:border-color .2s ease-in-out;}.sq-input--focus{border:1px solid #4A90E2;}.sq-input--error{border:1px solid #E02F2F;}#sq-card-number{margin-bottom:5vw;}.button-credit-card{width:100%;height:17.5vw;margin-top:3.125vw;background:#4A90E2;border-radius:1.875vw;cursor:pointer;display:block;color:#FFFFFF;font-size:5vw;line-height:7.5vw;font-weight:700;-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;text-align:center;-webkit-transition:background .2s ease-in-out;transition:background .2s ease-in-out;}.button-credit-card:hover{background-color:#4281CB;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFxjb2RlXFx6d1xcendfY2xpZW50X3dlYlxcdXRpbHNcXHZpZXdcXHBheVxcaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTBKZ0IsQUFFc0MsQUFJVixBQU9oQixBQUlBLEFBS00sQUFHSixBQU1JLEFBSUgsQUFVYSxBQUlBLEFBR1AsQUFJUCxBQWdCYyxTQTFEVCxBQUlOLEVBUW9CLEFBK0JoQixDQXJCUSxHQWROLEFBU0EsR0FxQkcsQ0FqQ1YsTUFaSyxBQU9HLEFBK0JTLEFBSUEsQUFTUCxBQWNPLEdBckRoQixNQWtCZSxDQWxDUyxJQUt5QixFQW1CakQsR0FnQ1MsT0EvQkEsUUFVSSxJQXNCRCxNQXpEYSxDQXlCZixZQVdFLEdBc0JQLFVBcERJLEtBcURMLElBdEJPLFVBOUJULEFBcURFLFdBdEIwQixDQS9CM0IsRUFzREMsY0FDSSxrQkFDRixnQkFDQyxxQ0ExQndCLGdEQTJCdkIsa0JBQ29CLG9GQUFDIiwiZmlsZSI6IkQ6XFxjb2RlXFx6d1xcendfY2xpZW50X3dlYlxcdXRpbHNcXHZpZXdcXHBheVxcaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7dXNlRWZmZWN0fSBmcm9tICdyZWFjdCdcclxuaW1wb3J0IEhlYWQgZnJvbSAnbmV4dC9oZWFkJ1xyXG5pbXBvcnQge0hlYWRlclRpdGxlfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL0hlYWRlclRpdGxlL0hlYWRlclRpdGxlJ1xyXG5pbXBvcnQge3VzZVJvdXRlcn0gZnJvbSAnbmV4dC9yb3V0ZXInXHJcbmltcG9ydCB7c2hvd01lc3NhZ2V9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvTWVzc2FnZS9NZXNzYWdlJ1xyXG5pbXBvcnQge3VzZVN0b3JlTW9kZWx9IGZyb20gJy4uLy4uL01vZGVsQWN0aW9uL3VzZVN0b3JlJ1xyXG5pbXBvcnQge29yZGVyRGV0YWlsTW9kZWx9IGZyb20gJy4uL21lL29yZGVyRGV0YWlsL29yZGVyRGV0YWlsJ1xyXG5pbXBvcnQge2RlYWxNb25leX0gZnJvbSAnLi4vLi4vdG9vbHMvdXRpbHMnXHJcbmltcG9ydCB7T3JkZXJTdGF0ZX0gZnJvbSAnLi4vLi4vc3NfY29tbW9uL2VudW0nXHJcblxyXG5jb25zdCBhcHBsaWNhdGlvbklkID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyA/ICdzcTBpZHAtSUFFd1g3N0hkdW5sNWRXQnlIUWpJUScgOiAnc2FuZGJveC1zcTBpZGItNDJGUTd3R0J3emliVG9STTlfemRGdydcclxuLy8gY29uc3QgYXBwbGljYXRpb25JZCA9ICdzcTBpZHAtSUFFd1g3N0hkdW5sNWRXQnlIUWpJUSdcclxuXHJcbmV4cG9ydCBjb25zdCBQYXkgPSAoKSA9PiB7XHJcbiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKClcclxuICBjb25zdCBvcmRlcklkID0gKHJvdXRlci5xdWVyeT8ub3JkZXJJZCBhcyBzdHJpbmcpID8/ICcnXHJcblxyXG4gIGNvbnN0IHtzdGF0ZTogc3RhdGVPRCwgYWN0aW9uczogYWN0aW9uc09EfSA9IHVzZVN0b3JlTW9kZWwob3JkZXJEZXRhaWxNb2RlbClcclxuICBjb25zdCBvcmRlckluZm8gPSBzdGF0ZU9ELm9yZGVySW5mb1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG9yZGVySWQpIHtcclxuICAgICAgYWN0aW9uc09ELmdldERldGFpbChgJHtvcmRlcklkfWApXHJcbiAgICB9XHJcbiAgfSwgW29yZGVySWRdKVxyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgaWYgKHdpbmRvdy5TcVBheW1lbnRGb3JtICYmIG9yZGVySW5mby5hY3R1YWxseVBhaWQpIHtcclxuICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICBjb25zdCBwYXltZW50Rm9ybSA9IG5ldyBTcVBheW1lbnRGb3JtKHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBwYXltZW50IGZvcm0gZWxlbWVudHNcclxuICAgICAgICBhcHBsaWNhdGlvbklkLFxyXG4gICAgICAgIGlucHV0Q2xhc3M6ICdzcS1pbnB1dCcsXHJcbiAgICAgICAgYXV0b0J1aWxkOiBmYWxzZSxcclxuICAgICAgICAvLyBDdXN0b21pemUgdGhlIENTUyBmb3IgU3FQYXltZW50Rm9ybSBpZnJhbWUgZWxlbWVudHNcclxuICAgICAgICBpbnB1dFN0eWxlczogW3tcclxuICAgICAgICAgIGZvbnRTaXplOiAnMTZweCcsXHJcbiAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjRweCcsXHJcbiAgICAgICAgICBwYWRkaW5nOiAnMTZweCcsXHJcbiAgICAgICAgICBwbGFjZWhvbGRlckNvbG9yOiAnI2EwYTBhMCcsXHJcbiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXHJcbiAgICAgICAgfV0sXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgY3JlZGl0IGNhcmQgcGxhY2Vob2xkZXJzXHJcbiAgICAgICAgY2FyZE51bWJlcjoge1xyXG4gICAgICAgICAgZWxlbWVudElkOiAnc3EtY2FyZC1udW1iZXInLFxyXG4gICAgICAgICAgcGxhY2Vob2xkZXI6ICdDYXJkIE51bWJlcicsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjdnY6IHtcclxuICAgICAgICAgIGVsZW1lbnRJZDogJ3NxLWN2dicsXHJcbiAgICAgICAgICBwbGFjZWhvbGRlcjogJ0NWVicsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBleHBpcmF0aW9uRGF0ZToge1xyXG4gICAgICAgICAgZWxlbWVudElkOiAnc3EtZXhwaXJhdGlvbi1kYXRlJyxcclxuICAgICAgICAgIHBsYWNlaG9sZGVyOiAnTU0vWVknLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcG9zdGFsQ29kZToge1xyXG4gICAgICAgICAgZWxlbWVudElkOiAnc3EtcG9zdGFsLWNvZGUnLFxyXG4gICAgICAgICAgcGxhY2Vob2xkZXI6ICdQb3N0YWwnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy8gU3FQYXltZW50Rm9ybSBjYWxsYmFjayBmdW5jdGlvbnNcclxuICAgICAgICBjYWxsYmFja3M6IHtcclxuICAgICAgICAgIC8qXHJcbiAgICAgICAgICAqIGNhbGxiYWNrIGZ1bmN0aW9uOiBjYXJkTm9uY2VSZXNwb25zZVJlY2VpdmVkXHJcbiAgICAgICAgICAqIFRyaWdnZXJlZCB3aGVuOiBTcVBheW1lbnRGb3JtIGNvbXBsZXRlcyBhIGNhcmQgbm9uY2UgcmVxdWVzdFxyXG4gICAgICAgICAgKi9cclxuICAgICAgICAgIGNhcmROb25jZVJlc3BvbnNlUmVjZWl2ZWQ6IGZ1bmN0aW9uIChlcnJvcnM6IGFueSwgbm9uY2U6IGFueSwgY2FyZERhdGE6IGFueSkge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3JzKSB7XHJcbiAgICAgICAgICAgICAgLy8gTG9nIGVycm9ycyBmcm9tIG5vbmNlIGdlbmVyYXRpb24gdG8gdGhlIGJyb3dzZXIgZGV2ZWxvcGVyIGNvbnNvbGUuXHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRW5jb3VudGVyZWQgZXJyb3JzOicpXHJcbiAgICAgICAgICAgICAgZXJyb3JzLmZvckVhY2goZnVuY3Rpb24gKGVycm9yOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJyAgJyArIGVycm9yLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICBzaG93TWVzc2FnZSgnRW5jb3VudGVyZWQgZXJyb3JzLCBjaGVjayBicm93c2VyIGRldmVsb3BlciBjb25zb2xlIGZvciBtb3JlIGRldGFpbHMnKVxyXG4gICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGFsZXJ0KGBUaGUgZ2VuZXJhdGVkIG5vbmNlIGlzOlxcbiR7bm9uY2V9YClcclxuICAgICAgICAgICAgZmV0Y2goYC9wYXkvcHJvY2Vzcy1wYXltZW50YCwge1xyXG4gICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgbm9uY2U6IG5vbmNlLFxyXG4gICAgICAgICAgICAgICAgYW1vdW50OiB+figob3JkZXJJbmZvLmFjdHVhbGx5UGFpZCA/PyAwKSAqIDEwMCksXHJcbiAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoJ05ldHdvcmsgZXJyb3I6ICcgKyBlcnIpXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkudGhlbigoZXJyb3JJbmZvOiBhbnkpID0+IFByb21pc2UucmVqZWN0KGVycm9ySW5mbykpIC8vVVBEQVRFIEhFUkVcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpIC8vVVBEQVRFIEhFUkVcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YSkgLy9VUERBVEUgSEVSRVxyXG4gICAgICAgICAgICAgICAgICAvLyBzaG93TWVzc2FnZSgnUGF5bWVudCBjb21wbGV0ZSBzdWNjZXNzZnVsbHkhXFxuQ2hlY2sgYnJvd3NlciBkZXZlbG9wZXIgY29uc29sZSBmb3IgbW9yZSBkZXRhaWxzJylcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNPRC51cGRhdGVPcmRlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IG9yZGVySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IE9yZGVyU3RhdGUuUGFpZCxcclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCfmlK/ku5jmiJDlip8nKVxyXG4gICAgICAgICAgICAgICAgICByb3V0ZXIucmVwbGFjZSgnL2NhcnQvcmVzdWx0JylcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpXHJcbiAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCdQYXltZW50IGZhaWxlZCB0byBjb21wbGV0ZSFcXG5DaGVjayBicm93c2VyIGRldmVsb3BlciBjb25zb2xlIGZvciBtb3JlIGRldGFpbHMnKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfSlcclxuICAgICAgcGF5bWVudEZvcm0uYnVpbGQoKVxyXG4gICAgICBjb25zdCBvbkdldENhcmROb25jZSA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgLy8gRG9uJ3Qgc3VibWl0IHRoZSBmb3JtIHVudGlsIFNxUGF5bWVudEZvcm0gcmV0dXJucyB3aXRoIGEgbm9uY2VcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICAgICAgLy8gUmVxdWVzdCBhIG5vbmNlIGZyb20gdGhlIFNxUGF5bWVudEZvcm0gb2JqZWN0XHJcbiAgICAgICAgcGF5bWVudEZvcm0ucmVxdWVzdENhcmROb25jZSgpXHJcbiAgICAgIH1cclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NxLWNyZWRpdGNhcmQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkdldENhcmROb25jZSlcclxuICAgIH1cclxuICB9LCBbb3JkZXJJbmZvLmFjdHVhbGx5UGFpZF0pXHJcblxyXG4gIHJldHVybiA8ZGl2PlxyXG4gICAgPEhlYWQ+XHJcbiAgICAgIDx0aXRsZT5wYXk8L3RpdGxlPlxyXG4gICAgICA8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIlxyXG4gICAgICAgICAgICAgIHNyYz1cImh0dHBzOi8vanMuc3F1YXJldXAuY29tL3YyL3BheW1lbnRmb3JtXCI+XHJcbiAgICAgIDwvc2NyaXB0PlxyXG4gICAgPC9IZWFkPlxyXG4gICAgPEhlYWRlclRpdGxlXHJcbiAgICAgICAgdGl0bGU9eyfmlK/ku5gnfVxyXG4gICAgICAgIGJhY2tDYWxsPXsoKSA9PiB7XHJcbiAgICAgICAgICByb3V0ZXIucmVwbGFjZSgnL2hvbWUnKVxyXG4gICAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgICB9fVxyXG4gICAgLz5cclxuICAgIDxkaXYgaWQ9XCJmb3JtLWNvbnRhaW5lclwiPlxyXG4gICAgICA8ZGl2IGlkPVwic3EtY2FyZC1udW1iZXJcIi8+XHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGhpcmRcIlxyXG4gICAgICAgICAgIGlkPVwic3EtZXhwaXJhdGlvbi1kYXRlXCIvPlxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInRoaXJkXCJcclxuICAgICAgICAgICBpZD1cInNxLWN2dlwiLz5cclxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0aGlyZFwiXHJcbiAgICAgICAgICAgaWQ9XCJzcS1wb3N0YWwtY29kZVwiLz5cclxuICAgICAgPGJ1dHRvbiBpZD1cInNxLWNyZWRpdGNhcmRcIlxyXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImJ1dHRvbi1jcmVkaXQtY2FyZFwiXHJcbiAgICAgID5QYXkge2RlYWxNb25leShvcmRlckluZm8uYWN0dWFsbHlQYWlkKX1cclxuICAgICAgPC9idXR0b24+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxzdHlsZSBqc3g+e2BcclxuICAgICAgICA6Z2xvYmFsKCopIHtcclxuICAgICAgICAgIC13ZWJraXQtZm9udC1zbW9vdGhpbmc6IGFudGlhbGlhc2VkO1xyXG4gICAgICAgICAgLW1vei1vc3gtZm9udC1zbW9vdGhpbmc6IGdyYXlzY2FsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIDpnbG9iYWwoYm9keSwgaHRtbCkge1xyXG4gICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0Y3RjhGOTtcclxuICAgICAgICAgIGNvbG9yOiAjMzczRjRBO1xyXG4gICAgICAgICAgZm9udC1mYW1pbHk6IFwiSGVsdmV0aWNhIE5ldWVcIiwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjtcclxuICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7XHJcbiAgICAgICAgICBoZWlnaHQ6IDEwMCU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICA6Z2xvYmFsKGJ1dHRvbikge1xyXG4gICAgICAgICAgYm9yZGVyOiAwO1xyXG4gICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIDpnbG9iYWwoZmllbGRzZXQpIHtcclxuICAgICAgICAgIG1hcmdpbjogMDtcclxuICAgICAgICAgIHBhZGRpbmc6IDA7XHJcbiAgICAgICAgICBib3JkZXI6IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICA6Z2xvYmFsKCNmb3JtLWNvbnRhaW5lcikge1xyXG4gICAgICAgICAgcGFkZGluZzogMjBweDtcclxuICAgICAgICAgIC8vcG9zaXRpb246IHJlbGF0aXZlO1xyXG4gICAgICAgICAgLy93aWR0aDogMzgwcHg7XHJcbiAgICAgICAgICAvL21hcmdpbjogMCBhdXRvO1xyXG4gICAgICAgICAgLy90b3A6IDUwJTtcclxuICAgICAgICAgIC8vdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgOmdsb2JhbCgudGhpcmQpIHtcclxuICAgICAgICAgIGZsb2F0OiBsZWZ0O1xyXG4gICAgICAgICAgd2lkdGg6IGNhbGMoKDEwMCUgLSAzMnB4KSAvIDMpO1xyXG4gICAgICAgICAgcGFkZGluZzogMDtcclxuICAgICAgICAgIG1hcmdpbjogMCAxNnB4IDE2cHggMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIDpnbG9iYWwoLnRoaXJkOmxhc3Qtb2YtdHlwZSkge1xyXG4gICAgICAgICAgbWFyZ2luLXJpZ2h0OiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyogRGVmaW5lIGhvdyBTcVBheW1lbnRGb3JtIGlmcmFtZXMgc2hvdWxkIGxvb2sgKi9cclxuICAgICAgICA6Z2xvYmFsKC5zcS1pbnB1dCkge1xyXG4gICAgICAgICAgaGVpZ2h0OiA1NlBYO1xyXG4gICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcclxuICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNFMEUyRTM7XHJcbiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcclxuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcclxuICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcclxuICAgICAgICAgIC13ZWJraXQtdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIC4ycyBlYXNlLWluLW91dDtcclxuICAgICAgICAgICAgIC1tb3otdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIC4ycyBlYXNlLWluLW91dDtcclxuICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIC4ycyBlYXNlLWluLW91dDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qIERlZmluZSBob3cgU3FQYXltZW50Rm9ybSBpZnJhbWVzIHNob3VsZCBsb29rIHdoZW4gdGhleSBoYXZlIGZvY3VzICovXHJcbiAgICAgICAgOmdsb2JhbCguc3EtaW5wdXQtLWZvY3VzKSB7XHJcbiAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjNEE5MEUyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyogRGVmaW5lIGhvdyBTcVBheW1lbnRGb3JtIGlmcmFtZXMgc2hvdWxkIGxvb2sgd2hlbiB0aGV5IGNvbnRhaW4gaW52YWxpZCB2YWx1ZXMgKi9cclxuICAgICAgICA6Z2xvYmFsKC5zcS1pbnB1dC0tZXJyb3IpIHtcclxuICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNFMDJGMkY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICA6Z2xvYmFsKCNzcS1jYXJkLW51bWJlcikge1xyXG4gICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qIEN1c3RvbWl6ZSB0aGUgXCJQYXkgd2l0aCBDcmVkaXQgQ2FyZFwiIGJ1dHRvbiAqL1xyXG4gICAgICAgIDpnbG9iYWwoLmJ1dHRvbi1jcmVkaXQtY2FyZCkge1xyXG4gICAgICAgICAgd2lkdGg6IDEwMCU7XHJcbiAgICAgICAgICBoZWlnaHQ6IDU2cHg7XHJcbiAgICAgICAgICBtYXJnaW4tdG9wOiAxMHB4O1xyXG4gICAgICAgICAgYmFja2dyb3VuZDogIzRBOTBFMjtcclxuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcclxuICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcclxuICAgICAgICAgIGRpc3BsYXk6IGJsb2NrO1xyXG4gICAgICAgICAgY29sb3I6ICNGRkZGRkY7XHJcbiAgICAgICAgICBmb250LXNpemU6IDE2cHg7XHJcbiAgICAgICAgICBsaW5lLWhlaWdodDogMjRweDtcclxuICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7XHJcbiAgICAgICAgICBsZXR0ZXItc3BhY2luZzogMDtcclxuICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcclxuICAgICAgICAgIC13ZWJraXQtdHJhbnNpdGlvbjogYmFja2dyb3VuZCAuMnMgZWFzZS1pbi1vdXQ7XHJcbiAgICAgICAgICAgICAtbW96LXRyYW5zaXRpb246IGJhY2tncm91bmQgLjJzIGVhc2UtaW4tb3V0O1xyXG4gICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIC4ycyBlYXNlLWluLW91dDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIDpnbG9iYWwoLmJ1dHRvbi1jcmVkaXQtY2FyZDpob3Zlcikge1xyXG4gICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzQyODFDQjtcclxuICAgICAgICB9XHJcbiAgICBgfTwvc3R5bGU+XHJcbiAgPC9kaXY+XHJcbn1cclxuIl19 */\\n/*@ sourceURL=D:\\\\\\\\code\\\\\\\\zw\\\\\\\\zw_client_web\\\\\\\\utils\\\\\\\\view\\\\\\\\pay\\\\\\\\index.tsx */\"));\n};\n\n_s(Pay, \"BoX5+U8iSCxWP1b/WK/+J9iB0m4=\", false, function () {\n  return [useRouter, useStoreModel];\n});\n\n_c = Pay;\n\nvar _c;\n\n$RefreshReg$(_c, \"Pay\");","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/pay/index.tsx"],"names":["React","useEffect","Head","HeaderTitle","useRouter","showMessage","useStoreModel","orderDetailModel","dealMoney","OrderState","applicationId","Pay","router","orderId","query","stateOD","state","actionsOD","actions","orderInfo","getDetail","window","SqPaymentForm","actuallyPaid","paymentForm","inputClass","autoBuild","inputStyles","fontSize","lineHeight","padding","placeholderColor","backgroundColor","cardNumber","elementId","placeholder","cvv","expirationDate","postalCode","callbacks","cardNonceResponseReceived","errors","nonce","cardData","console","error","forEach","message","fetch","method","headers","body","JSON","stringify","amount","err","then","response","ok","json","errorInfo","Promise","reject","data","updateOrder","id","Paid","replace","build","onGetCardNonce","event","preventDefault","requestCardNonce","document","querySelector","addEventListener"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport Head from 'next/head'\r\nimport {HeaderTitle} from '../../components/HeaderTitle/HeaderTitle'\r\nimport {useRouter} from 'next/router'\r\nimport {showMessage} from '../../components/Message/Message'\r\nimport {useStoreModel} from '../../ModelAction/useStore'\r\nimport {orderDetailModel} from '../me/orderDetail/orderDetail'\r\nimport {dealMoney} from '../../tools/utils'\r\nimport {OrderState} from '../../ss_common/enum'\r\n\r\nconst applicationId = process.env.NODE_ENV === 'production' ? 'sq0idp-IAEwX77Hdunl5dWByHQjIQ' : 'sandbox-sq0idb-42FQ7wGBwzibToRM9_zdFw'\r\n// const applicationId = 'sq0idp-IAEwX77Hdunl5dWByHQjIQ'\r\n\r\nexport const Pay = () => {\r\n  const router = useRouter()\r\n  const orderId = (router.query?.orderId as string) ?? ''\r\n\r\n  const {state: stateOD, actions: actionsOD} = useStoreModel(orderDetailModel)\r\n  const orderInfo = stateOD.orderInfo\r\n\r\n  useEffect(() => {\r\n    if (orderId) {\r\n      actionsOD.getDetail(`${orderId}`)\r\n    }\r\n  }, [orderId])\r\n\r\n  useEffect(() => {\r\n    // @ts-ignore\r\n    if (window.SqPaymentForm && orderInfo.actuallyPaid) {\r\n      // @ts-ignore\r\n      const paymentForm = new SqPaymentForm({\r\n        // Initialize the payment form elements\r\n        applicationId,\r\n        inputClass: 'sq-input',\r\n        autoBuild: false,\r\n        // Customize the CSS for SqPaymentForm iframe elements\r\n        inputStyles: [{\r\n          fontSize: '16px',\r\n          lineHeight: '24px',\r\n          padding: '16px',\r\n          placeholderColor: '#a0a0a0',\r\n          backgroundColor: 'transparent',\r\n        }],\r\n        // Initialize the credit card placeholders\r\n        cardNumber: {\r\n          elementId: 'sq-card-number',\r\n          placeholder: 'Card Number',\r\n        },\r\n        cvv: {\r\n          elementId: 'sq-cvv',\r\n          placeholder: 'CVV',\r\n        },\r\n        expirationDate: {\r\n          elementId: 'sq-expiration-date',\r\n          placeholder: 'MM/YY',\r\n        },\r\n        postalCode: {\r\n          elementId: 'sq-postal-code',\r\n          placeholder: 'Postal',\r\n        },\r\n        // SqPaymentForm callback functions\r\n        callbacks: {\r\n          /*\r\n          * callback function: cardNonceResponseReceived\r\n          * Triggered when: SqPaymentForm completes a card nonce request\r\n          */\r\n          cardNonceResponseReceived: function (errors: any, nonce: any, cardData: any) {\r\n            if (errors) {\r\n              // Log errors from nonce generation to the browser developer console.\r\n              console.error('Encountered errors:')\r\n              errors.forEach(function (error: any) {\r\n                console.error('  ' + error.message)\r\n              })\r\n              showMessage('Encountered errors, check browser developer console for more details')\r\n              return\r\n            }\r\n            // alert(`The generated nonce is:\\n${nonce}`)\r\n            fetch(`/pay/process-payment`, {\r\n              method: 'POST',\r\n              headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json',\r\n              },\r\n              body: JSON.stringify({\r\n                nonce: nonce,\r\n                amount: ~~((orderInfo.actuallyPaid ?? 0) * 100),\r\n              }),\r\n            })\r\n                .catch(err => {\r\n                  showMessage('Network error: ' + err)\r\n                })\r\n                .then((response: any) => {\r\n                  if (!response.ok) {\r\n                    return response.json().then((errorInfo: any) => Promise.reject(errorInfo)) //UPDATE HERE\r\n                  }\r\n                  return response.json() //UPDATE HERE\r\n                })\r\n                .then(data => {\r\n                  // console.log(data) //UPDATE HERE\r\n                  // showMessage('Payment complete successfully!\\nCheck browser developer console for more details')\r\n                  return actionsOD.updateOrder({\r\n                    id: orderId,\r\n                    state: OrderState.Paid,\r\n                  })\r\n                })\r\n                .then(() => {\r\n                  showMessage('支付成功')\r\n                  router.replace('/cart/result')\r\n                })\r\n                .catch(err => {\r\n                  console.error(err)\r\n                  showMessage('Payment failed to complete!\\nCheck browser developer console for more details')\r\n                })\r\n          },\r\n        },\r\n      })\r\n      paymentForm.build()\r\n      const onGetCardNonce = (event: any) => {\r\n        // Don't submit the form until SqPaymentForm returns with a nonce\r\n        event.preventDefault()\r\n        // Request a nonce from the SqPaymentForm object\r\n        paymentForm.requestCardNonce()\r\n      }\r\n      document.querySelector('#sq-creditcard')?.addEventListener('click', onGetCardNonce)\r\n    }\r\n  }, [orderInfo.actuallyPaid])\r\n\r\n  return <div>\r\n    <Head>\r\n      <title>pay</title>\r\n      <script type=\"text/javascript\"\r\n              src=\"https://js.squareup.com/v2/paymentform\">\r\n      </script>\r\n    </Head>\r\n    <HeaderTitle\r\n        title={'支付'}\r\n        backCall={() => {\r\n          router.replace('/home')\r\n          return true\r\n        }}\r\n    />\r\n    <div id=\"form-container\">\r\n      <div id=\"sq-card-number\"/>\r\n      <div className=\"third\"\r\n           id=\"sq-expiration-date\"/>\r\n      <div className=\"third\"\r\n           id=\"sq-cvv\"/>\r\n      <div className=\"third\"\r\n           id=\"sq-postal-code\"/>\r\n      <button id=\"sq-creditcard\"\r\n              className=\"button-credit-card\"\r\n      >Pay {dealMoney(orderInfo.actuallyPaid)}\r\n      </button>\r\n    </div>\r\n    <style jsx>{`\r\n        :global(*) {\r\n          -webkit-font-smoothing: antialiased;\r\n          -moz-osx-font-smoothing: grayscale;\r\n        }\r\n\r\n        :global(body, html) {\r\n          background-color: #F7F8F9;\r\n          color: #373F4A;\r\n          font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\r\n          font-weight: normal;\r\n          height: 100%;\r\n        }\r\n\r\n        :global(button) {\r\n          border: 0;\r\n          font-weight: 500;\r\n        }\r\n\r\n        :global(fieldset) {\r\n          margin: 0;\r\n          padding: 0;\r\n          border: 0;\r\n        }\r\n\r\n        :global(#form-container) {\r\n          padding: 20px;\r\n          //position: relative;\r\n          //width: 380px;\r\n          //margin: 0 auto;\r\n          //top: 50%;\r\n          //transform: translateY(-50%);\r\n        }\r\n\r\n        :global(.third) {\r\n          float: left;\r\n          width: calc((100% - 32px) / 3);\r\n          padding: 0;\r\n          margin: 0 16px 16px 0;\r\n        }\r\n\r\n        :global(.third:last-of-type) {\r\n          margin-right: 0;\r\n        }\r\n\r\n        /* Define how SqPaymentForm iframes should look */\r\n        :global(.sq-input) {\r\n          height: 56PX;\r\n          box-sizing: border-box;\r\n          border: 1px solid #E0E2E3;\r\n          background-color: white;\r\n          border-radius: 6px;\r\n          display: inline-block;\r\n          -webkit-transition: border-color .2s ease-in-out;\r\n             -moz-transition: border-color .2s ease-in-out;\r\n                  transition: border-color .2s ease-in-out;\r\n        }\r\n\r\n        /* Define how SqPaymentForm iframes should look when they have focus */\r\n        :global(.sq-input--focus) {\r\n          border: 1px solid #4A90E2;\r\n        }\r\n\r\n        /* Define how SqPaymentForm iframes should look when they contain invalid values */\r\n        :global(.sq-input--error) {\r\n          border: 1px solid #E02F2F;\r\n        }\r\n\r\n        :global(#sq-card-number) {\r\n          margin-bottom: 16px;\r\n        }\r\n\r\n        /* Customize the \"Pay with Credit Card\" button */\r\n        :global(.button-credit-card) {\r\n          width: 100%;\r\n          height: 56px;\r\n          margin-top: 10px;\r\n          background: #4A90E2;\r\n          border-radius: 6px;\r\n          cursor: pointer;\r\n          display: block;\r\n          color: #FFFFFF;\r\n          font-size: 16px;\r\n          line-height: 24px;\r\n          font-weight: 700;\r\n          letter-spacing: 0;\r\n          text-align: center;\r\n          -webkit-transition: background .2s ease-in-out;\r\n             -moz-transition: background .2s ease-in-out;\r\n                  transition: background .2s ease-in-out;\r\n        }\r\n\r\n        :global(.button-credit-card:hover) {\r\n          background-color: #4281CB;\r\n        }\r\n    `}</style>\r\n  </div>\r\n}\r\n"]},"metadata":{},"sourceType":"module"}