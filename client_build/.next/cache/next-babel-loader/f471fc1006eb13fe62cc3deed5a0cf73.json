{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\code\\\\zw\\\\zw_client_web\\\\utils\\\\view\\\\category\\\\[id].tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport { useStoreModel } from '../../ModelAction/useStore';\nimport { KeyboardArrowRight } from '@material-ui/icons';\nimport { Breadcrumbs, ButtonBase, LinearProgress, Link } from '@material-ui/core';\nimport { dealUrlQuery, fpMergePre } from '../../tools/utils';\nimport { HeaderTitle } from '../../components/HeaderTitle/HeaderTitle';\nimport { doc } from '../../graphqlTypes/doc';\nimport { BScroller } from '../../components/BScroll/BScroller';\nimport { modelFactory } from '../../ModelAction/modelUtil';\nimport styled from 'styled-components';\nimport { grey } from '@material-ui/core/colors';\nimport { dealImgUrl } from '../../tools/img';\nimport { GroupProductItem, ProductItem } from '../../components/ProductItem/ProductItem';\nimport { ls } from '../../tools/dealKey';\nimport { NoData } from '../../components/NoData/NoData';\nimport { homeTabsModel } from '../home/components/Tabs/Tabs';\nimport { HomeType } from '../home/appModule';\nexport var CategoryPageModel = modelFactory('CategoryPage', {\n  productList: [],\n  categoryList: []\n}, {\n  getProductList: function () {\n    var _getProductList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var _res$productsInCatego, _res$categoryList$lis, _res$categoryList;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.productsInCategory, {\n                data: value.categoryItemInput,\n                productItemInput: value.productItemInput\n              });\n\n            case 2:\n              res = _context.sent;\n              option.setData(fpMergePre({\n                productList: (_res$productsInCatego = res === null || res === void 0 ? void 0 : res.productsInCategory) !== null && _res$productsInCatego !== void 0 ? _res$productsInCatego : [],\n                categoryList: _toConsumableArray((_res$categoryList$lis = res === null || res === void 0 ? void 0 : (_res$categoryList = res.categoryList) === null || _res$categoryList === void 0 ? void 0 : _res$categoryList.list) !== null && _res$categoryList$lis !== void 0 ? _res$categoryList$lis : [])\n              }));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getProductList(_x, _x2) {\n      return _getProductList.apply(this, arguments);\n    }\n\n    return getProductList;\n  }()\n});\nvar Box = styled('div').withConfig({\n  displayName: \"id__Box\",\n  componentId: \"sc-13c54cm-0\"\n})([\"padding:18px 20px 0;> header{font-size:18px;font-weight:bold;margin:10px 0;}\"]);\n_c = Box;\nvar CategoryItemStyle = styled(ButtonBase).withConfig({\n  displayName: \"id__CategoryItemStyle\",\n  componentId: \"sc-13c54cm-1\"\n})([\"&&&{width:100%;height:60px;display:flex;border-radius:8px;overflow:hidden;margin-bottom:10px;background:\", \";> img{height:100%;width:70%;}> span{flex:1;color:#fff;display:flex;align-items:center;justify-content:center;}}\"], grey[700]);\n_c2 = CategoryItemStyle;\nvar categoryItemModel = modelFactory('categoryItemModel', {\n  test: '',\n  category: {}\n}, {\n  getLevel: function () {\n    var _getLevel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value, option) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return option.query(doc.categoryLevel, {\n                data: value\n              });\n\n            case 2:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function getLevel(_x3, _x4) {\n      return _getLevel.apply(this, arguments);\n    }\n\n    return getLevel;\n  }(),\n  getCategory: function () {\n    var _getCategory = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value, option) {\n      var _res$oneCategory;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return option.query(doc.oneCategory, {\n                data: value\n              });\n\n            case 2:\n              res = _context3.sent;\n              option.setData(fpMergePre({\n                category: (_res$oneCategory = res === null || res === void 0 ? void 0 : res.oneCategory) !== null && _res$oneCategory !== void 0 ? _res$oneCategory : {}\n              }));\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function getCategory(_x5, _x6) {\n      return _getCategory.apply(this, arguments);\n    }\n\n    return getCategory;\n  }()\n});\nvar ListBox = styled.div.withConfig({\n  displayName: \"id__ListBox\",\n  componentId: \"sc-13c54cm-2\"\n})([\"display:grid;grid-template-columns:repeat(\", \",1fr);grid-gap:16px;\"], function (props) {\n  return props.columns || 2;\n});\n_c3 = ListBox;\nexport var CategoryPage = function CategoryPage() {\n  _s();\n\n  var _ref, _router$query;\n\n  var router = useRouter();\n  var id = (_ref = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id) !== null && _ref !== void 0 ? _ref : '';\n\n  var _useStoreModel = useStoreModel(CategoryPageModel),\n      stateCPM = _useStoreModel.state,\n      actionsCPM = _useStoreModel.actions,\n      getLoad = _useStoreModel.getLoad;\n\n  var _useStoreModel2 = useStoreModel(categoryItemModel),\n      actionsCI = _useStoreModel2.actions,\n      stateCategoryItemModel = _useStoreModel2.state;\n\n  var _useStoreModel3 = useStoreModel(homeTabsModel),\n      stateHomeTabs = _useStoreModel3.state,\n      actionsHomeTabs = _useStoreModel3.actions;\n\n  useEffect(function () {\n    var _ref2;\n\n    actionsHomeTabs.setHomeType((_ref2 = router.query.homeType) !== null && _ref2 !== void 0 ? _ref2 : HomeType.home);\n  }, [router.query.homeType]);\n\n  var CategoryItem = function CategoryItem(v) {\n    return __jsx(CategoryItemStyle, {\n      key: \"CategoryItem_\".concat(v.id),\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var _yield$actionsCI$getL;\n\n        var _query;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _query = dealUrlQuery({\n                  homeType: router.query.homeType\n                });\n                _context4.next = 3;\n                return actionsCI.getLevel({\n                  id: v.id\n                });\n\n              case 3:\n                _context4.t1 = _yield$actionsCI$getL = _context4.sent;\n                _context4.t0 = _context4.t1 === null;\n\n                if (_context4.t0) {\n                  _context4.next = 7;\n                  break;\n                }\n\n                _context4.t0 = _yield$actionsCI$getL === void 0;\n\n              case 7:\n                if (!_context4.t0) {\n                  _context4.next = 11;\n                  break;\n                }\n\n                _context4.t2 = void 0;\n                _context4.next = 12;\n                break;\n\n              case 11:\n                _context4.t2 = _yield$actionsCI$getL.categoryLevel;\n\n              case 12:\n                _context4.t3 = _context4.t2;\n\n                if (!(_context4.t3 === 3)) {\n                  _context4.next = 18;\n                  break;\n                }\n\n                _context4.next = 16;\n                return Router.push(\"/productList/[id]\".concat(_query), \"/productList/\".concat(v.id).concat(_query));\n\n              case 16:\n                _context4.next = 20;\n                break;\n\n              case 18:\n                _context4.next = 20;\n                return Router.push(\"/category/[id]\".concat(_query), \"/category/\".concat(v.id).concat(_query));\n\n              case 20:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      })),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 12\n      }\n    }, __jsx(\"img\", {\n      src: dealImgUrl(v.imgUrl),\n      alt: \"\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 7\n      }\n    }), __jsx(\"span\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 7\n      }\n    }, v.name, __jsx(KeyboardArrowRight, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 21\n      }\n    })));\n  };\n\n  useEffect(function () {\n    if (id) {\n      actionsCPM.getProductList({\n        categoryItemInput: {\n          id: id\n        },\n        productItemInput: {\n          isGroup: router.query.homeType === HomeType.group ? 1 : 0\n        }\n      });\n      actionsCI.getCategory({\n        id: id\n      });\n    }\n  }, [id]);\n  console.log(stateCategoryItemModel.category);\n  return __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 10\n    }\n  }, __jsx(HeaderTitle, {\n    title: '',\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 5\n    }\n  }), !!getLoad(doc.productsInCategory) && __jsx(LinearProgress, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 43\n    }\n  }), __jsx(Breadcrumbs, {\n    separator: \"\\u203A\",\n    \"aria-label\": \"breadcrumb\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 5\n    }\n  }, __jsx(Link, {\n    color: \"inherit\",\n    href: \"#\",\n    onClick: function onClick() {},\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, \"Material-UI\"), __jsx(Link, {\n    color: \"inherit\",\n    href: \"#\",\n    onClick: function onClick() {},\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }\n  }, \"Core\")), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 60px)',\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 5\n    }\n  }, __jsx(Box, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }\n  }, stateCPM.categoryList.length === 0 && stateCPM.productList.length === 0 && __jsx(NoData, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 88\n    }\n  }) || __jsx(React.Fragment, null, stateCPM.categoryList.map(function (value) {\n    return CategoryItem(value);\n  }), __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 15\n    }\n  }, ls('热门推荐')), stateCPM.productList.length === 0 && __jsx(NoData, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 55\n    }\n  }), __jsx(ListBox, {\n    columns: stateHomeTabs.homeType === HomeType.group ? 1 : 2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 15\n    }\n  }, stateCPM.productList.map(function (value) {\n    return stateHomeTabs.homeType === HomeType.group && __jsx(GroupProductItem, {\n      product: value,\n      key: \"ProductItem_\".concat(value.id),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 98\n      }\n    }) || __jsx(ProductItem, {\n      key: \"ProductItem_\".concat(value.id),\n      product: value,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 24\n      }\n    });\n  }))))));\n};\n\n_s(CategoryPage, \"oVKc5jraOYzYdSlgLpmAF2fkhYA=\", false, function () {\n  return [useRouter, useStoreModel, useStoreModel, useStoreModel];\n});\n\n_c4 = CategoryPage;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Box\");\n$RefreshReg$(_c2, \"CategoryItemStyle\");\n$RefreshReg$(_c3, \"ListBox\");\n$RefreshReg$(_c4, \"CategoryPage\");","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/category/[id].tsx"],"names":["React","useEffect","Router","useRouter","useStoreModel","KeyboardArrowRight","Breadcrumbs","ButtonBase","LinearProgress","Link","dealUrlQuery","fpMergePre","HeaderTitle","doc","BScroller","modelFactory","styled","grey","dealImgUrl","GroupProductItem","ProductItem","ls","NoData","homeTabsModel","HomeType","CategoryPageModel","productList","categoryList","getProductList","value","option","query","productsInCategory","data","categoryItemInput","productItemInput","res","setData","list","Box","CategoryItemStyle","categoryItemModel","test","category","getLevel","categoryLevel","getCategory","oneCategory","ListBox","div","props","columns","CategoryPage","router","id","stateCPM","state","actionsCPM","actions","getLoad","actionsCI","stateCategoryItemModel","stateHomeTabs","actionsHomeTabs","setHomeType","homeType","home","CategoryItem","v","_query","push","imgUrl","name","isGroup","group","console","log","length","map"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport Router, {useRouter} from 'next/router'\r\nimport {useStoreModel} from '../../ModelAction/useStore'\r\nimport {Category, CategoryItemInput, Product, ProductItemInput} from '../../graphqlTypes/types'\r\nimport {KeyboardArrowRight} from '@material-ui/icons'\r\nimport {Breadcrumbs, ButtonBase, LinearProgress, Link} from '@material-ui/core'\r\nimport {dealUrlQuery, fpMergePre} from '../../tools/utils'\r\nimport {HeaderTitle} from '../../components/HeaderTitle/HeaderTitle'\r\nimport {doc} from '../../graphqlTypes/doc'\r\nimport {BScroller} from '../../components/BScroll/BScroller'\r\nimport {modelFactory} from '../../ModelAction/modelUtil'\r\nimport styled from 'styled-components'\r\nimport {grey} from '@material-ui/core/colors'\r\nimport {dealImgUrl} from '../../tools/img'\r\nimport {GroupProductItem, ProductItem} from '../../components/ProductItem/ProductItem'\r\nimport {ls} from '../../tools/dealKey'\r\nimport {NoData} from '../../components/NoData/NoData'\r\nimport {homeTabsModel} from '../home/components/Tabs/Tabs'\r\nimport {HomeType} from '../home/appModule'\r\n\r\nexport const CategoryPageModel = modelFactory('CategoryPage', {\r\n  productList: [] as Product[],\r\n  categoryList: [] as Category[],\r\n}, {\r\n  getProductList: async (value: {\r\n    categoryItemInput?: CategoryItemInput,\r\n    productItemInput?: ProductItemInput,\r\n  }, option) => {\r\n    const res = await option.query(doc.productsInCategory, {\r\n      data: value.categoryItemInput,\r\n      productItemInput: value.productItemInput,\r\n    })\r\n    option.setData(fpMergePre({\r\n      productList: res?.productsInCategory ?? [],\r\n      categoryList: [\r\n        ...res?.categoryList?.list ?? [],\r\n      ],\r\n    }))\r\n  },\r\n\r\n})\r\n\r\nconst Box = styled('div')`\r\n  padding: 18px 20px 0;\r\n  > header {\r\n    font-size: 18px;\r\n    font-weight: bold;\r\n    margin: 10px 0;\r\n  }\r\n`\r\n\r\nconst CategoryItemStyle = styled(ButtonBase)`\r\n  &&& {\r\n    width: 100%;\r\n    height: 60px;\r\n    display: flex;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n    margin-bottom: 10px;\r\n    background: ${grey[700]};\r\n    > img {\r\n      height: 100%;\r\n      width: 70%;\r\n    }\r\n    > span {\r\n      flex: 1;\r\n      color: #fff;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n  }\r\n`\r\n\r\nconst categoryItemModel = modelFactory('categoryItemModel', {\r\n  test: '',\r\n  category: {} as Category,\r\n}, {\r\n  getLevel: async (value: CategoryItemInput, option) => {\r\n    return await option.query(doc.categoryLevel, {\r\n      data: value,\r\n    })\r\n  },\r\n  getCategory: async (value: CategoryItemInput, option) => {\r\n    const res = await option.query(doc.oneCategory, {data: value})\r\n    option.setData(fpMergePre({\r\n      category: res?.oneCategory ?? {},\r\n    }))\r\n  },\r\n})\r\n\r\n\r\nconst ListBox = styled.div<React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> & {columns?: number}>`\r\n  display: grid;\r\n  grid-template-columns: repeat(${props => props.columns || 2}, 1fr);\r\n  grid-gap: 16px;\r\n`\r\n\r\nexport const CategoryPage = () => {\r\n  const router = useRouter()\r\n  const id = (router.query?.id as string) ?? ''\r\n  const {state: stateCPM, actions: actionsCPM, getLoad} = useStoreModel(CategoryPageModel)\r\n  const {actions: actionsCI, state: stateCategoryItemModel} = useStoreModel(categoryItemModel)\r\n  const {state: stateHomeTabs, actions: actionsHomeTabs} = useStoreModel(homeTabsModel)\r\n  useEffect(() => {\r\n    actionsHomeTabs.setHomeType((router.query.homeType as string) ?? HomeType.home)\r\n  }, [router.query.homeType])\r\n\r\n  const CategoryItem = (v: Category) => {\r\n    return <CategoryItemStyle\r\n        key={`CategoryItem_${v.id}`}\r\n        onClick={async () => {\r\n          const _query = dealUrlQuery({homeType: router.query.homeType})\r\n          if ((await actionsCI.getLevel({\r\n            id: v.id,\r\n          }))?.categoryLevel === 3) {\r\n            await Router.push(`/productList/[id]${_query}`, `/productList/${v.id}${_query}`)\r\n          } else {\r\n            await Router.push(`/category/[id]${_query}`, `/category/${v.id}${_query}`)\r\n          }\r\n        }}\r\n    >\r\n      <img\r\n          src={dealImgUrl(v.imgUrl)}\r\n          alt=''\r\n      />\r\n      <span>{v.name}<KeyboardArrowRight/></span>\r\n    </CategoryItemStyle>\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      actionsCPM.getProductList({\r\n        categoryItemInput: {id},\r\n        productItemInput: {\r\n          isGroup: router.query.homeType === HomeType.group ? 1 : 0,\r\n        },\r\n      })\r\n      actionsCI.getCategory({id})\r\n    }\r\n  }, [id])\r\n\r\n  console.log(stateCategoryItemModel.category)\r\n  return <div>\r\n    <HeaderTitle\r\n        title={''}\r\n    />\r\n    {!!getLoad(doc.productsInCategory) && <LinearProgress/>}\r\n    <Breadcrumbs separator=\"›\" aria-label=\"breadcrumb\">\r\n      <Link color=\"inherit\" href=\"#\" onClick={() => {}}>\r\n        Material-UI\r\n      </Link>\r\n      <Link color=\"inherit\" href=\"#\" onClick={() => {}}>\r\n        Core\r\n      </Link>\r\n    </Breadcrumbs>\r\n    <BScroller boxHeight={'calc(100vh - 60px)'}>\r\n      <Box>\r\n        {((stateCPM.categoryList.length === 0 && stateCPM.productList.length === 0) && <NoData/>) ||\r\n        (\r\n            <>\r\n              {stateCPM.categoryList.map(value => CategoryItem(value))}\r\n              <header>{ls('热门推荐')}</header>\r\n              {(stateCPM.productList.length === 0) && <NoData/>}\r\n              <ListBox\r\n                  columns={stateHomeTabs.homeType === HomeType.group ? 1 : 2}\r\n              >\r\n                {stateCPM.productList.map(value => (stateHomeTabs.homeType === HomeType.group && <GroupProductItem\r\n                    product={value}\r\n                    key={`ProductItem_${value.id}`}\r\n                />) || <ProductItem\r\n                    key={`ProductItem_${value.id}`}\r\n                    product={value}/>)}\r\n              </ListBox>\r\n            </>\r\n        )\r\n        }\r\n\r\n      </Box>\r\n    </BScroller>\r\n  </div>\r\n}\r\n"]},"metadata":{},"sourceType":"module"}