{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport ArrowForwardIosIcon from '@material-ui/icons/ArrowForwardIos';\nimport { HeaderTitle } from '../../../../components/HeaderTitle/HeaderTitle';\nimport { Button, ButtonBase, Tab, Tabs } from '@material-ui/core';\nimport { ls } from '../../../../tools/dealKey';\nimport { modelFactory } from '../../../../ModelAction/modelUtil';\nimport { useStoreModel } from '../../../../ModelAction/useStore';\nimport { dealMoney, formatDate, fpMergePre } from '../../../../tools/utils';\nimport { doc } from '../../../../graphqlTypes/doc';\nimport { BScroller } from '../../../../components/BScroll/BScroller';\nimport styled from 'styled-components';\nimport { grey } from '@material-ui/core/colors';\nimport { dealImgUrl } from '../../../../tools/img';\nimport { mpStyle } from '../../../../style/common';\nimport { OrderState, orderStateToString } from '../../../../ss_common/enum';\nimport { useRouter } from 'next/router';\nvar orderHistoryModel = modelFactory('orderHistoryModel', {\n  state: 0,\n  orderList: []\n}, {\n  changeState: function changeState(value, option) {\n    option.setData(fpMergePre({\n      state: value\n    }));\n  },\n  getList: function () {\n    var _getList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.orderList, {\n                data: {\n                  state: option.data.state\n                }\n              });\n\n            case 2:\n              res = _context.sent;\n              option.setData(fpMergePre({\n                orderList: res === null || res === void 0 ? void 0 : res.orderList\n              }));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getList(_x, _x2) {\n      return _getList.apply(this, arguments);\n    }\n\n    return getList;\n  }()\n});\nvar Parting = styled.div.withConfig({\n  displayName: \"orderHistory__Parting\",\n  componentId: \"sc-1sicy9i-0\"\n})([\"height:18px;width:100%;background:\", \";\"], grey[100]);\nvar Item = styled('div').withConfig({\n  displayName: \"orderHistory__Item\",\n  componentId: \"sc-1sicy9i-1\"\n})([\"&&&{padding:20px;display:flex;flex-direction:column;align-items:stretch;> header{display:flex;justify-content:space-between;}> section{margin-top:10px;text-align:right;> span{color:\", \";}}> footer{text-align:right;margin-top:10px;}}\"], mpStyle.red);\nvar ImgList = styled(ButtonBase).withConfig({\n  displayName: \"orderHistory__ImgList\",\n  componentId: \"sc-1sicy9i-2\"\n})([\"&&&{display:grid;width:100%;grid-template-columns:repeat(4,1fr) 30px;grid-gap:10px;align-items:center;min-height:20vw;> img{max-width:16vw;border-radius:8px;}> aside{grid-area:1/5/2/6;justify-self:end;}}\"]);\nexport var OrderHistory = function OrderHistory() {\n  var _ohState$orderList$li;\n\n  var router = useRouter();\n\n  var _useStoreModel = useStoreModel(orderHistoryModel),\n      ohState = _useStoreModel.state,\n      ohActions = _useStoreModel.actions;\n\n  useEffect(function () {\n    ohActions.getList();\n  }, []);\n  return __jsx(\"div\", null, __jsx(HeaderTitle, {\n    title: '订单历史'\n  }), __jsx(Tabs, {\n    variant: 'fullWidth',\n    value: ohState.state,\n    onChange: function onChange(e, value) {\n      ohActions.changeState(value);\n      ohActions.getList();\n    }\n  }, __jsx(Tab, {\n    value: 0,\n    label: ls('全部')\n  }), __jsx(Tab, {\n    value: OrderState.Picking,\n    label: orderStateToString(OrderState.Picking)\n  }), __jsx(Tab, {\n    value: OrderState.Paid,\n    label: orderStateToString(OrderState.Paid)\n  })), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 108px)'\n  }, (_ohState$orderList$li = ohState.orderList.list) === null || _ohState$orderList$li === void 0 ? void 0 : _ohState$orderList$li.map(function (value) {\n    var _value$rOrderProduct, _value$rOrderProduct$, _value$rOrderProduct2;\n\n    return __jsx(React.Fragment, {\n      key: \"ohState.orderList_\".concat(value === null || value === void 0 ? void 0 : value.id)\n    }, __jsx(Parting, null), __jsx(Item, null, __jsx(\"header\", null, __jsx(\"span\", null, formatDate(value === null || value === void 0 ? void 0 : value.createTime, 'YYYY-MM-dd HH:mm')), __jsx(\"aside\", null, orderStateToString(value === null || value === void 0 ? void 0 : value.state))), __jsx(ImgList, {\n      onClick: function onClick() {\n        return router.push('/m/me/orderDetail/[id]', \"/m/me/orderDetail/\".concat(value === null || value === void 0 ? void 0 : value.id));\n      }\n    }, value === null || value === void 0 ? void 0 : (_value$rOrderProduct = value.rOrderProduct) === null || _value$rOrderProduct === void 0 ? void 0 : (_value$rOrderProduct$ = _value$rOrderProduct.filter(function (value) {\n      var _value$product, _value$product$img, _value$product$img$;\n\n      return value === null || value === void 0 ? void 0 : (_value$product = value.product) === null || _value$product === void 0 ? void 0 : (_value$product$img = _value$product.img) === null || _value$product$img === void 0 ? void 0 : (_value$product$img$ = _value$product$img[0]) === null || _value$product$img$ === void 0 ? void 0 : _value$product$img$.url;\n    })) === null || _value$rOrderProduct$ === void 0 ? void 0 : _value$rOrderProduct$.map(function (value1) {\n      var _value1$product, _value1$product$img, _value1$product$img$, _value1$product2, _value1$product2$img, _value1$product2$img$;\n\n      return __jsx(\"img\", {\n        key: \"url_\".concat(value1 === null || value1 === void 0 ? void 0 : (_value1$product = value1.product) === null || _value1$product === void 0 ? void 0 : (_value1$product$img = _value1$product.img) === null || _value1$product$img === void 0 ? void 0 : (_value1$product$img$ = _value1$product$img[0]) === null || _value1$product$img$ === void 0 ? void 0 : _value1$product$img$.url),\n        src: dealImgUrl(value1 === null || value1 === void 0 ? void 0 : (_value1$product2 = value1.product) === null || _value1$product2 === void 0 ? void 0 : (_value1$product2$img = _value1$product2.img) === null || _value1$product2$img === void 0 ? void 0 : (_value1$product2$img$ = _value1$product2$img[0]) === null || _value1$product2$img$ === void 0 ? void 0 : _value1$product2$img$.url),\n        alt: \"\"\n      });\n    }), __jsx(\"aside\", null, __jsx(ArrowForwardIosIcon, {\n      htmlColor: grey[400]\n    }))), __jsx(\"section\", null, \"\\u5171 \", value === null || value === void 0 ? void 0 : (_value$rOrderProduct2 = value.rOrderProduct) === null || _value$rOrderProduct2 === void 0 ? void 0 : _value$rOrderProduct2.reduce(function (pre, cur) {\n      var _cur$count;\n\n      return pre + ((_cur$count = cur === null || cur === void 0 ? void 0 : cur.count) !== null && _cur$count !== void 0 ? _cur$count : 0);\n    }, 0), \" \\u4EF6\\u5546\\u54C1, \\u5B9E\\u4ED8\", __jsx(\"span\", null, \" \", dealMoney(value === null || value === void 0 ? void 0 : value.actuallyPaid)), \",\"), __jsx(\"section\", null, ls('抵扣'), \" \", dealMoney(value === null || value === void 0 ? void 0 : value.deductCoin), \", \", ls('积攒'), \" \", dealMoney(value === null || value === void 0 ? void 0 : value.generateCoin), \",\"), __jsx(\"footer\", null, __jsx(Button, {\n      color: 'secondary',\n      variant: 'contained',\n      onClick: function onClick(e) {\n        e.stopPropagation();\n        router.push('/m/me/orderDetail/[id]', \"/m/me/orderDetail/\".concat(value === null || value === void 0 ? void 0 : value.id));\n      }\n    }, ls('查看详情')))));\n  }), __jsx(Parting, null)));\n};","map":null,"metadata":{},"sourceType":"module"}