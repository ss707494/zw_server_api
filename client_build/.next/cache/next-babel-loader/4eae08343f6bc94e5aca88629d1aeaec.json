{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport Router from 'next/router';\nimport { fpMergePre, fpSetPre } from '../../tools/utils';\nimport { setToken } from '../../tools/token';\nimport { showMessage } from '../../components/Message/Message';\nimport { doc } from '../../graphqlTypes/doc';\nimport { modelFactory } from '../../ModelAction/modelUtil';\nimport { ls } from '../../tools/dealKey';\nexport const registerModel = modelFactory('register', {\n  step: 0,\n  userForm: {\n    name: '1',\n    password: '123',\n    confirmPassword: '123',\n    userInfo: {\n      name: 'ss',\n      email: 'ss',\n      phone: 'ss'\n    }\n  }\n}, {\n  setStep: (value, option) => option.setData(fpMergePre({\n    step: value\n  })),\n  setUserForm: ([path, value], option) => {\n    option.setData(fpSetPre(`userForm.${path}`, value));\n  },\n  goNext: (value, option) => {\n    var _option$data, _option$data$userForm, _option$data2, _option$data2$userFor, _option$data3, _option$data3$userFor, _option$data4, _option$data4$userFor, _option$data5, _option$data5$userFor;\n\n    if (!((_option$data = option.data) === null || _option$data === void 0 ? void 0 : (_option$data$userForm = _option$data.userForm) === null || _option$data$userForm === void 0 ? void 0 : _option$data$userForm.name) || !((_option$data2 = option.data) === null || _option$data2 === void 0 ? void 0 : (_option$data2$userFor = _option$data2.userForm) === null || _option$data2$userFor === void 0 ? void 0 : _option$data2$userFor.password) || !((_option$data3 = option.data) === null || _option$data3 === void 0 ? void 0 : (_option$data3$userFor = _option$data3.userForm) === null || _option$data3$userFor === void 0 ? void 0 : _option$data3$userFor.confirmPassword)) {\n      showMessage(ls('请填写表单'));\n      return;\n    }\n\n    if (((_option$data4 = option.data) === null || _option$data4 === void 0 ? void 0 : (_option$data4$userFor = _option$data4.userForm) === null || _option$data4$userFor === void 0 ? void 0 : _option$data4$userFor.password) !== ((_option$data5 = option.data) === null || _option$data5 === void 0 ? void 0 : (_option$data5$userFor = _option$data5.userForm) === null || _option$data5$userFor === void 0 ? void 0 : _option$data5$userFor.confirmPassword)) {\n      showMessage(ls('两次密码输入不一致'));\n      return;\n    }\n\n    option.setData(fpMergePre({\n      step: 1\n    }));\n  },\n  submit: async (value, option) => {\n    var _option$data$userForm2, _registerUser$user;\n\n    const userInfo = ((_option$data$userForm2 = option.data.userForm) === null || _option$data$userForm2 === void 0 ? void 0 : _option$data$userForm2.userInfo) || {};\n\n    if (!userInfo.name || !userInfo.phone || !userInfo.email) {\n      showMessage(ls('请填写表单'));\n      return;\n    }\n\n    const _option$data$userForm3 = option.data.userForm,\n          {\n      confirmPassword\n    } = _option$data$userForm3,\n          params = _objectWithoutProperties(_option$data$userForm3, [\"confirmPassword\"]);\n\n    const res = await option.mutate(doc.registerUser, {\n      data: _objectSpread({}, params)\n    });\n    const registerUser = res === null || res === void 0 ? void 0 : res.registerUser;\n\n    if (registerUser === null || registerUser === void 0 ? void 0 : (_registerUser$user = registerUser.user) === null || _registerUser$user === void 0 ? void 0 : _registerUser$user.id) {\n      showMessage(ls('注册成功,即将登录'));\n      setToken(registerUser.token);\n      setToken(registerUser.refreshtoken, 'refreshtoken');\n      await Router.replace(`/home`, ``, {\n        shallow: true\n      });\n    }\n  },\n  goToSignup: (value, option) => {\n    Router.push('/login');\n  }\n});","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/register/model.ts"],"names":["Router","fpMergePre","fpSetPre","setToken","showMessage","doc","modelFactory","ls","registerModel","step","userForm","name","password","confirmPassword","userInfo","email","phone","setStep","value","option","setData","setUserForm","path","goNext","data","submit","params","res","mutate","registerUser","user","id","token","refreshtoken","replace","shallow","goToSignup","push"],"mappings":"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","sourcesContent":["import Router from 'next/router'\r\nimport {fpMergePre, fpSetPre} from '../../tools/utils'\r\nimport {User, UserInRegister} from '../../graphqlTypes/types'\r\nimport {setToken} from '../../tools/token'\r\nimport {showMessage} from '../../components/Message/Message'\r\nimport {doc} from '../../graphqlTypes/doc'\r\nimport {modelFactory} from '../../ModelAction/modelUtil'\r\nimport { ls } from '../../tools/dealKey'\r\n\r\nexport const registerModel = modelFactory('register', {\r\n  step: 0,\r\n  userForm: {\r\n    name: '1',\r\n    password: '123',\r\n    confirmPassword: '123',\r\n    userInfo: {\r\n      name: 'ss',\r\n      email: 'ss',\r\n      phone: 'ss',\r\n    },\r\n  } as User & { confirmPassword?: string },\r\n}, {\r\n  setStep: (value: number, option) => option.setData(fpMergePre({step: value})),\r\n  setUserForm: ([path, value], option) => {\r\n    option.setData(fpSetPre(`userForm.${path}`, value))\r\n  },\r\n  goNext: (value, option) => {\r\n    if (!option.data?.userForm?.name || !option.data?.userForm?.password || !option.data?.userForm?.confirmPassword) {\r\n      showMessage(ls('请填写表单'))\r\n      return\r\n    }\r\n    if (option.data?.userForm?.password !== option.data?.userForm?.confirmPassword) {\r\n      showMessage(ls('两次密码输入不一致'))\r\n      return\r\n    }\r\n    option.setData(fpMergePre({\r\n      step: 1,\r\n    }))\r\n  },\r\n  submit: async (value, option) => {\r\n    const userInfo = option.data.userForm?.userInfo || {}\r\n    if (!userInfo.name || !userInfo.phone || !userInfo.email) {\r\n      showMessage(ls('请填写表单'))\r\n      return\r\n    }\r\n    const {confirmPassword, ...params} = option.data.userForm\r\n    const res = await option.mutate(doc.registerUser, {\r\n      data: {\r\n        ...params,\r\n      },\r\n    })\r\n    const registerUser = res?.registerUser as UserInRegister\r\n    if (registerUser?.user?.id) {\r\n      showMessage(ls('注册成功,即将登录'))\r\n      setToken(registerUser.token as string)\r\n      setToken(registerUser.refreshtoken as string, 'refreshtoken')\r\n      await Router.replace(`/home`, ``, {shallow: true})\r\n    }\r\n  },\r\n  goToSignup: (value, option) => {\r\n    Router.push('/login')\r\n  },\r\n})\r\n"]},"metadata":{},"sourceType":"module"}