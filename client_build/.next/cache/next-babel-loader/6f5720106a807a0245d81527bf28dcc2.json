{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport SortIcon from '@material-ui/icons/Sort';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport { useRouter } from 'next/router';\nimport { fpMergePre } from '../../../tools/utils';\nimport { doc } from '../../../graphqlTypes/doc';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { HeaderTitle } from '../../../components/HeaderTitle/HeaderTitle';\nimport styled from 'styled-components';\nimport { Button } from '@material-ui/core';\nimport { ls } from '../../../tools/dealKey';\nimport { GroupProductItem, ProductItem } from '../../../components/ProductItem/ProductItem';\nimport { BScroller } from '../../../components/BScroll/BScroller';\nimport { SortDrawer } from './SortDrawer';\nimport { FilterDrawer } from './FilterDrawer';\nimport { HomeType } from '../home/appModule';\nimport { homeTabsModel } from '../home/components/Tabs/Tabs';\nimport { UpdateShopCart } from '../../../components/ProductItem/UpdateShopCart';\nexport var sortTypeEnum = {\n  nomalSort: 'nomalSort',\n  highestSales: 'highestSales',\n  \"new\": 'new',\n  priceAsc: 'priceAsc',\n  priceDesc: 'priceDesc'\n};\nexport var dealSortSql = function dealSortSql(type) {\n  var _sql = {\n    nomalSort: [['id', 'asc'], ['createTime', 'asc']],\n    highestSales: [],\n    \"new\": [['createTime', 'desc']],\n    priceAsc: [['priceOut', 'asc']],\n    priceDesc: [['priceOut', 'desc']]\n  };\n  return _sql[type] || [];\n};\nexport var sortTypeLabel = {\n  nomalSort: '综合排序',\n  highestSales: '销量最高',\n  \"new\": '最新上架',\n  priceAsc: '价格由低到高',\n  priceDesc: '价格由高到低'\n};\nexport var productListModel = modelFactory('productListModel', {\n  category: {},\n  productList: [],\n  sortShow: false,\n  params: {\n    sortType: sortTypeEnum.nomalSort\n  },\n  filterShow: false,\n  onResolve: function () {}\n}, {\n  getCategory: function () {\n    var _getCategory = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var _res$oneCategory;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.oneCategory, {\n                data: value\n              });\n\n            case 2:\n              res = _context.sent;\n              option.setData(fpMergePre({\n                category: (_res$oneCategory = res === null || res === void 0 ? void 0 : res.oneCategory) !== null && _res$oneCategory !== void 0 ? _res$oneCategory : {}\n              }));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getCategory(_x, _x2) {\n      return _getCategory.apply(this, arguments);\n    }\n\n    return getCategory;\n  }(),\n  getData: function () {\n    var _getData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value, option) {\n      var _res$productList$list, _res$productList;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return option.query(doc.productList, {\n                productInput: value,\n                orderByInput: {\n                  orderByObject: dealSortSql(option.data.params.sortType)\n                }\n              });\n\n            case 2:\n              res = _context2.sent;\n              option.setData(fpMergePre({\n                productList: (_res$productList$list = res === null || res === void 0 ? void 0 : (_res$productList = res.productList) === null || _res$productList === void 0 ? void 0 : _res$productList.list) !== null && _res$productList$list !== void 0 ? _res$productList$list : []\n              }));\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function getData(_x3, _x4) {\n      return _getData.apply(this, arguments);\n    }\n\n    return getData;\n  }(),\n  openSort: function openSort(value, option) {\n    return new Promise(function (resolve) {\n      option.setData(fpMergePre({\n        sortShow: true,\n        onResolve: resolve\n      }));\n    });\n  },\n  closeSort: function closeSort(value, option) {\n    option.setData(fpMergePre({\n      sortShow: false\n    }));\n    option.data.onResolve(value);\n  },\n  changeSort: function () {\n    var _changeSort = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value, option) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              option.setData(fpMergePre({\n                params: {\n                  sortType: value\n                }\n              }));\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function changeSort(_x5, _x6) {\n      return _changeSort.apply(this, arguments);\n    }\n\n    return changeSort;\n  }(),\n  openFilter: function openFilter(value, option) {\n    return new Promise(function (resolve) {\n      option.setData(fpMergePre({\n        filterShow: true,\n        onResolve: resolve\n      }));\n    });\n  },\n  closeFilter: function closeFilter(value, option) {\n    option.setData(fpMergePre({\n      filterShow: false\n    }));\n    option.data.onResolve(value);\n  }\n});\nvar HeaderTab = styled.div.withConfig({\n  displayName: \"id__HeaderTab\",\n  componentId: \"sc-13j64as-0\"\n})([\"display:flex;justify-content:space-evenly;\"]);\nvar ListBox = styled.div.withConfig({\n  displayName: \"id__ListBox\",\n  componentId: \"sc-13j64as-1\"\n})([\"padding:20px;display:grid;grid-template-columns:repeat(\", \",1fr);grid-gap:16px;\"], function (props) {\n  return props.columns || 2;\n});\nexport var ProductList = function ProductList() {\n  var _ref, _router$query, _statePLM$category;\n\n  var router = useRouter();\n  var id = (_ref = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id) !== null && _ref !== void 0 ? _ref : '';\n\n  var _useStoreModel = useStoreModel(productListModel),\n      actionsPLM = _useStoreModel.actions,\n      statePLM = _useStoreModel.state;\n\n  var _useStoreModel2 = useStoreModel(homeTabsModel),\n      stateHomeTabs = _useStoreModel2.state,\n      actionsHomeTabs = _useStoreModel2.actions;\n\n  useEffect(function () {\n    var _ref2;\n\n    actionsHomeTabs.setHomeType((_ref2 = router.query.homeType) !== null && _ref2 !== void 0 ? _ref2 : HomeType.home);\n  }, [router.query.homeType]);\n  useEffect(function () {\n    if (!!id) {\n      actionsPLM.getCategory({\n        id: id\n      });\n      actionsPLM.getData({\n        isGroup: router.query.homeType === HomeType.group ? 1 : 0,\n        category: {\n          id: id\n        }\n      });\n    }\n  }, [id]);\n  return __jsx(\"div\", null, __jsx(HeaderTitle, {\n    title: (_statePLM$category = statePLM.category) === null || _statePLM$category === void 0 ? void 0 : _statePLM$category.name,\n    showCart: router.query.homeType === HomeType.home\n  }), __jsx(HeaderTab, null, __jsx(Button, {\n    fullWidth: true,\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return actionsPLM.openSort();\n\n            case 2:\n              actionsPLM.getData({\n                isGroup: router.query.homeType === HomeType.group ? 1 : 0,\n                category: {\n                  id: id\n                }\n              });\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }))\n  }, ls('排序'), __jsx(SortIcon, null)), __jsx(Button, {\n    fullWidth: true,\n    onClick: function onClick() {\n      return actionsPLM.openFilter();\n    }\n  }, ls('筛选'), __jsx(FilterListIcon, null))), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 100px)'\n  }, __jsx(ListBox, {\n    columns: stateHomeTabs.homeType === HomeType.group ? 1 : 2\n  }, statePLM.productList.map(function (value) {\n    return stateHomeTabs.homeType === HomeType.group && __jsx(GroupProductItem, {\n      product: value,\n      key: \"ProductItem_\".concat(value.id)\n    }) || __jsx(ProductItem, {\n      key: \"ProductItem_\".concat(value.id),\n      product: value\n    });\n  }))), __jsx(SortDrawer, null), __jsx(FilterDrawer, null), __jsx(UpdateShopCart, null));\n};","map":null,"metadata":{},"sourceType":"module"}