{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { HeaderTitle } from '../../../components/HeaderTitle/HeaderTitle';\nimport { ll } from '../../../tools/dealKey';\nimport { FootBar } from '../../../components/FootBar/FootBar';\nimport { Button, Card, Tab, Tabs } from '@material-ui/core';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport { PromoCodeTypeEnum } from '../../../ss_common/enum';\nimport { doc } from '../../../graphqlTypes/doc';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { formatDate, fpMergePre } from '../../../tools/utils';\nimport styled from 'styled-components';\nimport { dealImgUrl } from '../../../tools/img';\nimport { grey } from '@material-ui/core/colors';\nimport { BScroller } from '../../../components/BScroll/BScroller';\nimport { Space } from '../../../components/Box/Box';\nimport { showMessage } from '../../../components/Message/Message';\nexport var cardModel = modelFactory('cardModel', {\n  promoCodeList: [],\n  user: {}\n}, {\n  getList: function () {\n    var _getList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var _res$promoCodeList, _user$oneUser;\n\n      var res, user;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.promoCodeList, {\n                promoCodeItemInput: {\n                  isDisable: 0\n                }\n              });\n\n            case 2:\n              res = _context.sent;\n              _context.next = 5;\n              return option.query(doc.oneUser);\n\n            case 5:\n              user = _context.sent;\n              option.setData(fpMergePre({\n                promoCodeList: (_res$promoCodeList = res === null || res === void 0 ? void 0 : res.promoCodeList) !== null && _res$promoCodeList !== void 0 ? _res$promoCodeList : [],\n                user: (_user$oneUser = user.oneUser) !== null && _user$oneUser !== void 0 ? _user$oneUser : {}\n              }));\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getList(_x, _x2) {\n      return _getList.apply(this, arguments);\n    }\n\n    return getList;\n  }()\n});\nvar MainBox = styled.div.withConfig({\n  displayName: \"type__MainBox\",\n  componentId: \"hycsb4-0\"\n})([\"padding:24px 24px 80px;\"]);\nvar CardBox = styled(Card).withConfig({\n  displayName: \"type__CardBox\",\n  componentId: \"hycsb4-1\"\n})([\"&&&{margin-bottom:16px;display:grid;padding:16px;grid-template-rows:24px 40px 20px max-content 1fr;grid-column-gap:8px;grid-template-columns:120px 1fr;align-items:center;> aside{grid-area:1/1/6/2;> img{width:120px;height:120px;}}}\"]);\nvar Title = styled.div.withConfig({\n  displayName: \"type__Title\",\n  componentId: \"hycsb4-2\"\n})([\"font-weight:bold;\"]);\nvar Remark = styled.div.withConfig({\n  displayName: \"type__Remark\",\n  componentId: \"hycsb4-3\"\n})([\"\"]);\nvar Number = styled.div.withConfig({\n  displayName: \"type__Number\",\n  componentId: \"hycsb4-4\"\n})([\"font-size:14px;color:\", \";\"], grey[500]);\nvar Time = styled.div.withConfig({\n  displayName: \"type__Time\",\n  componentId: \"hycsb4-5\"\n})([\"font-size:14px;color:\", \";\"], grey[500]);\nvar Action = styled.div.withConfig({\n  displayName: \"type__Action\",\n  componentId: \"hycsb4-6\"\n})([\"padding-top:8px;\"]);\nvar CardBoxPromoCode = styled(Card).withConfig({\n  displayName: \"type__CardBoxPromoCode\",\n  componentId: \"hycsb4-7\"\n})([\"&&&{padding:24px;margin-bottom:24px;background-image:url(\\\"\", \"\\\");background-color:\", \";box-shadow:inset 0 0 0 1000px rgba(0,0,0,.3);background-size:100% 100%;background-position:0 0;color:white;}\", \"{color:white;}\", \"{color:white;}\"], function (p) {\n  return p.background;\n}, grey[200], Number, Time);\nvar CodeBox = styled.div.withConfig({\n  displayName: \"type__CodeBox\",\n  componentId: \"hycsb4-8\"\n})([\"\"]);\nexport var getPromoCodeItem = function getPromoCodeItem(item, user) {\n  return item.promoCodeType === PromoCodeTypeEnum.DarenCard ? __jsx(CardBox, {\n    key: \"CardBox_\".concat(item.id)\n  }, __jsx(\"aside\", null, __jsx(\"img\", {\n    src: dealImgUrl(item.imgUrl),\n    alt: \"\"\n  })), __jsx(Title, null, item.title), __jsx(Remark, null, item.remark), __jsx(CodeBox, null, ll('优惠码'), \": \", item.code), __jsx(Time, null, ll('使用时间'), \": \", formatDate(item.effectiveDateStart, 'YYYY/MM/dd'), \" - \", formatDate(item.effectiveDateEnd, 'YYYY/MM/dd')), __jsx(Action, null, __jsx(Button, {\n    color: 'secondary',\n    variant: 'contained',\n    fullWidth: true,\n    onClick: function onClick() {\n      if (item === null || item === void 0 ? void 0 : item.code) {\n        var _item$code;\n\n        localStorage.setItem(\"promoCode_\".concat(user.id), \"\".concat((_item$code = item === null || item === void 0 ? void 0 : item.code) !== null && _item$code !== void 0 ? _item$code : ''));\n        showMessage('操作成功');\n      }\n    }\n  }, ll('应用到购物车')))) : __jsx(CardBoxPromoCode, {\n    key: \"CardBoxPromoCode_\".concat(item.id),\n    background: dealImgUrl(item === null || item === void 0 ? void 0 : item.imgUrl)\n  }, __jsx(Title, null, item.title), __jsx(Space, {\n    h: 8\n  }), __jsx(Remark, null, item.remark), __jsx(Space, {\n    h: 8\n  }), __jsx(Time, null, ll('使用时间'), \": \", formatDate(item.effectiveDateStart, 'YYYY/MM/dd'), \" - \", formatDate(item.effectiveDateEnd, 'YYYY/MM/dd')), __jsx(Space, {\n    h: 8\n  }), __jsx(CodeBox, null, ll('优惠码'), \": \", item.code), __jsx(Space, {\n    h: 8\n  }), __jsx(Action, null, __jsx(Button, {\n    color: 'secondary',\n    variant: 'contained',\n    fullWidth: true,\n    onClick: function onClick() {\n      if (item === null || item === void 0 ? void 0 : item.code) {\n        var _item$code2;\n\n        localStorage.setItem(\"promoCode_\".concat(user.id), \"\".concat((_item$code2 = item === null || item === void 0 ? void 0 : item.code) !== null && _item$code2 !== void 0 ? _item$code2 : ''));\n        showMessage('操作成功');\n      }\n    }\n  }, ll('应用到购物车'))));\n};\nexport var CardType = function CardType() {\n  var router = useRouter();\n  var promoCodeType = router.query.type;\n\n  var _useStoreModel = useStoreModel(cardModel),\n      stateCardModel = _useStoreModel.state,\n      actionsCardModel = _useStoreModel.actions;\n\n  useEffect(function () {\n    actionsCardModel.getList(\"\".concat(promoCodeType !== null && promoCodeType !== void 0 ? promoCodeType : ''));\n  }, [promoCodeType]);\n  return __jsx(\"div\", null, __jsx(HeaderTitle, {\n    title: ll('达人专区'),\n    showCart: true,\n    hideLeft: true,\n    showSearch: true\n  }), __jsx(Tabs, {\n    variant: 'fullWidth',\n    value: promoCodeType !== null && promoCodeType !== void 0 ? promoCodeType : PromoCodeTypeEnum.DarenCard,\n    onChange: function onChange(event, value) {\n      return router.push('/m/card/[type]', \"/m/card/\".concat(value));\n    }\n  }, __jsx(Tab, {\n    value: PromoCodeTypeEnum.DarenCard,\n    label: ll('我的达人卡')\n  }), __jsx(Tab, {\n    value: PromoCodeTypeEnum.PromoCode,\n    label: ll('当前优惠促销')\n  })), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 188px)'\n  }, __jsx(MainBox, null, stateCardModel.promoCodeList.filter(function (v) {\n    return v.promoCodeType === promoCodeType;\n  }).map(function (v) {\n    return getPromoCodeItem(v, stateCardModel.user);\n  }))), __jsx(FootBar, null));\n};","map":null,"metadata":{},"sourceType":"module"}