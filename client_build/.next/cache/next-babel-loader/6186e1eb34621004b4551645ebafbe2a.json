{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\code\\\\zw\\\\zw_client_web\\\\utils\\\\view\\\\m\\\\groupProduct\\\\groupOrderPage.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect } from 'react';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport styled from 'styled-components';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { dealMaybeNumber, dealMoney, dealUrlQuery, fpMerge, fpMergePre } from '../../../tools/utils';\nimport { dealGroupNumbers, groupProductModel } from './[id]';\nimport { ShopCartProductBox } from '../cart/CartProduct';\nimport { dealImgUrl } from '../../../tools/img';\nimport { ProductPrice } from '../../../components/ProductItem/ProductItem';\nimport { IconButton, MenuItem, TextField } from '@material-ui/core';\nimport { ll } from '../../../tools/dealKey';\nimport { Space } from '../../../components/Box/Box';\nimport { getPickUpTypeName, PickUpTypeEnum } from '../../../ss_common/enum';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport { AddressBox, CardBox, FooterFit, ShopTitle, ShopTotal } from '../cart/orderPage';\nimport { shopCartModel } from '../cart';\nimport { SelectAddress, selectAddressModel } from '../cart/components/SelectAddress';\nimport { SelectCard, selectCardModel } from '../cart/components/SelectCard';\nimport { ButtonLoad } from '../../../components/ButtonLoad/ButtonLoad';\nimport { mpStyle } from '../../../style/common';\nimport { showMessage } from '../../../components/Message/Message';\nimport { useRouter } from 'next/router';\nimport { HeaderTitle } from '../../../components/HeaderTitle/HeaderTitle';\nexport var groupOrderPageModel = modelFactory('orderPageModel', {\n  show: false\n}, {\n  open: function open(value, option) {\n    option.setData(fpMergePre({\n      show: true\n    }));\n  },\n  close: function close(value, option) {\n    option.setData(fpMergePre({\n      show: false\n    }));\n  }\n});\nvar OrderPageBox = styled.div.withConfig({\n  displayName: \"groupOrderPage__OrderPageBox\",\n  componentId: \"euzz55-0\"\n})([\"position:fixed;top:0;bottom:0;left:0;right:0;background:white;overflow-y:auto;> footer{position:fixed;bottom:0;box-sizing:border-box;box-shadow:\", \";width:100vw;text-align:right;}\"], mpStyle.shadow['1']);\n_c = OrderPageBox;\nexport var GroupOrderPage = function GroupOrderPage() {\n  _s();\n\n  var _stateSCM$payCardList, _product$priceOut, _stateSCM$form, _product$img, _product$img$, _stateSCM$userLevelLi;\n\n  var router = useRouter();\n\n  var _useStoreModel = useStoreModel(groupOrderPageModel),\n      stateOrderPageModel = _useStoreModel.state,\n      actionsOrderPageModel = _useStoreModel.actions;\n\n  var _useStoreModel2 = useStoreModel(groupProductModel),\n      actionsGroupProduct = _useStoreModel2.actions,\n      stateGroupProduct = _useStoreModel2.state;\n\n  var product = stateGroupProduct.product;\n\n  var _useStoreModel3 = useStoreModel(shopCartModel),\n      stateSCM = _useStoreModel3.state,\n      actionsSCM = _useStoreModel3.actions;\n\n  useEffect(function () {\n    if (!stateSCM.user.id) {\n      actionsSCM.getOrderInfo();\n    }\n  }, []);\n\n  var _useStoreModel4 = useStoreModel(selectAddressModel),\n      actionsSAM = _useStoreModel4.actions;\n\n  var _useStoreModel5 = useStoreModel(selectCardModel),\n      actionsSelectCard = _useStoreModel5.actions;\n\n  var addressData = stateSCM.dealAddressData(stateSCM);\n  var cardData = ((_stateSCM$payCardList = stateSCM.payCardList) === null || _stateSCM$payCardList === void 0 ? void 0 : _stateSCM$payCardList.find(function (v) {\n    return v.id === stateSCM.form.paymentMethodCardId;\n  })) || {};\n  var productTotal = ((_product$priceOut = product.priceOut) !== null && _product$priceOut !== void 0 ? _product$priceOut : 0) * dealGroupNumbers(product) * stateGroupProduct.selectNum;\n  var transportationCosts = stateSCM.dealTransportationCosts(stateSCM, productTotal);\n  var actuallyPaid = stateGroupProduct.dealDiscountAmount(stateGroupProduct) + transportationCosts + dealMaybeNumber(stateSCM.form.saleTax) - dealMaybeNumber((_stateSCM$form = stateSCM.form) === null || _stateSCM$form === void 0 ? void 0 : _stateSCM$form.deductCoin);\n  var generateCoin = actuallyPaid * 0.01;\n  useEffect(function () {\n    if (stateOrderPageModel.show) {\n      window.history.pushState(null, '', document.URL);\n      window.addEventListener('popstate', function (state) {\n        // 监听到返回事件，注意，只有触发了返回才会执行这个方法\n        actionsOrderPageModel.close();\n      }, false);\n    }\n\n    return function () {\n      window.removeEventListener('popstate', function (state) {\n        actionsOrderPageModel.close();\n      });\n    };\n  }, [stateOrderPageModel.show]);\n  return stateOrderPageModel.show && __jsx(React.Fragment, null, __jsx(OrderPageBox, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 5\n    }\n  }, __jsx(HeaderTitle, {\n    title: '订单支付',\n    backCall: function backCall() {\n      actionsOrderPageModel.close();\n      return true;\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }), __jsx(ShopCartProductBox, {\n    style: {\n      padding: '20px'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }\n  }, __jsx(\"img\", {\n    src: dealImgUrl(product === null || product === void 0 ? void 0 : (_product$img = product.img) === null || _product$img === void 0 ? void 0 : (_product$img$ = _product$img[0]) === null || _product$img$ === void 0 ? void 0 : _product$img$.url),\n    alt: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  }), __jsx(\"main\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, product === null || product === void 0 ? void 0 : product.name, product === null || product === void 0 ? void 0 : product.weight, product === null || product === void 0 ? void 0 : product.unit), __jsx(\"section\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }\n  }, product === null || product === void 0 ? void 0 : product.remark), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, __jsx(ProductPrice, {\n    priceOutTip: ll('基准价'),\n    product: product,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 11\n    }\n  }), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 11\n    }\n  }, dealGroupNumbers(product) * stateGroupProduct.selectNum, product.groupAmountUnitString, \"/\", stateGroupProduct.selectNum, ll('份')))), __jsx(TextField, {\n    style: {\n      margin: '16px',\n      width: 'calc(100vw - 32px)'\n    },\n    fullWidth: true,\n    label: ll('运送方式'),\n    select: true,\n    value: stateSCM.form.pickUpType,\n    onChange: function onChange(event) {\n      actionsSCM.setForm(['pickUpType', event.target.value]);\n      actionsSCM.setForm(['addressId', stateSCM.initAddressId(fpMerge(stateSCM, {\n        form: {\n          pickUpType: event.target.value\n        }\n      }))]);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, __jsx(MenuItem, {\n    value: PickUpTypeEnum.Self,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  }, ll(getPickUpTypeName(PickUpTypeEnum.Self))), __jsx(MenuItem, {\n    value: PickUpTypeEnum.Delivery,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 9\n    }\n  }, ll(getPickUpTypeName(PickUpTypeEnum.Delivery)))), __jsx(AddressBox, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }\n  }, __jsx(\"main\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 9\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 11\n    }\n  }, \"\".concat(addressData.combineAddress)), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 11\n    }\n  }, \"\".concat(addressData.name, \" \").concat(addressData.contactInformation))), __jsx(\"aside\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 9\n    }\n  }, __jsx(IconButton, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return actionsSAM.openClick();\n\n            case 2:\n              res = _context.sent;\n\n              if (res) {\n                actionsSCM.setForm(['addressId', res]);\n              }\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 11\n    }\n  }, __jsx(ChevronRightIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }\n  })))), __jsx(ShopTitle, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  }), ll('付款方式')), __jsx(CardBox, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 9\n    }\n  }, cardData.name), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 9\n    }\n  }, cardData.number), __jsx(\"aside\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 9\n    }\n  }, __jsx(IconButton, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return actionsSelectCard.openClick();\n\n            case 2:\n              res = _context2.sent;\n\n              if (res) {\n                actionsSCM.setForm(['paymentMethodCardId', res]);\n              }\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 11\n    }\n  }, __jsx(ChevronRightIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  })))), __jsx(SelectAddress, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }\n  }), __jsx(SelectCard, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }), __jsx(ShopTitle, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 9\n    }\n  }), ll('使用达人币'), __jsx(Space, {\n    w: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }\n  }), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }\n  }, ll('当月可用余额'), dealMoney(stateSCM.user.orderCoinCurrentMonth))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 9\n    }\n  }), __jsx(TextField, {\n    style: {\n      marginTop: '8px',\n      marginBottom: '24px'\n    },\n    label: ll(''),\n    value: stateSCM.form.deductCoin,\n    onChange: function onChange(e) {\n      actionsSCM.setForm(['deductCoin', e.target.value]);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }\n  })), __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }\n  }, ll('购物车总计')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 9\n    }\n  }, dealMoney(productTotal))), __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 9\n    }\n  }, ll('份数折扣')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 9\n    }\n  }, stateGroupProduct.numDiscount)), __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }\n  }, ll('成团折上折')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, stateGroupProduct.groupDiscount)), transportationCosts > 0 && __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 35\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 9\n    }\n  }, ll('运费')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 9\n    }\n  }, dealMoney(transportationCosts))), __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 9\n    }\n  }, ll('达人币抵扣')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 9\n    }\n  }, dealMoney(stateSCM.form.deductCoin, '-'))), __jsx(ShopTotal, {\n    style: {\n      fontSize: '18px'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }\n  }, ll('订单总额')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 9\n    }\n  }, dealMoney(actuallyPaid))), __jsx(Space, {\n    h: 120,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }\n  }), __jsx(FooterFit, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 9\n    }\n  }, ll('本次订单'), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 11\n    }\n  }, ll((_stateSCM$userLevelLi = stateSCM.userLevelList.find(function (v) {\n    var _stateSCM$user$userIn;\n\n    return v.code === ((_stateSCM$user$userIn = stateSCM.user.userInfo) === null || _stateSCM$user$userIn === void 0 ? void 0 : _stateSCM$user$userIn.userLevel);\n  })) === null || _stateSCM$userLevelLi === void 0 ? void 0 : _stateSCM$userLevelLi.name))), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 9\n    }\n  }, ll('将获得下月使用达人币 '), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 11\n    }\n  }, dealMoney(generateCoin))), __jsx(\"aside\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 9\n    }\n  }, __jsx(ButtonLoad, {\n    variant: 'contained',\n    color: 'secondary',\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var _stateSCM$user, _stateSCM$user$userIn2, _res$saveGroupOrder;\n\n      var res, _res$saveGroupOrder2, _query;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(dealMaybeNumber((_stateSCM$user = stateSCM.user) === null || _stateSCM$user === void 0 ? void 0 : _stateSCM$user.orderCoinCurrentMonth) < dealMaybeNumber(stateSCM.form.deductCoin))) {\n                _context3.next = 3;\n                break;\n              }\n\n              showMessage(ll('达人币余额不足'));\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              _context3.next = 5;\n              return actionsGroupProduct.submit({\n                orderInfoItemInput: _objectSpread(_objectSpread({}, stateSCM.form), {}, {\n                  generateCoin: generateCoin,\n                  actuallyPaid: actuallyPaid,\n                  transportationCosts: transportationCosts,\n                  subtotal: productTotal,\n                  currentUserLevel: (_stateSCM$user$userIn2 = stateSCM.user.userInfo) === null || _stateSCM$user$userIn2 === void 0 ? void 0 : _stateSCM$user$userIn2.userLevel,\n                  rOrderProduct: [{\n                    count: stateGroupProduct.selectNum,\n                    productId: product === null || product === void 0 ? void 0 : product.id,\n                    product: product\n                  }]\n                })\n              });\n\n            case 5:\n              res = _context3.sent;\n\n              if (!(res === null || res === void 0 ? void 0 : (_res$saveGroupOrder = res.saveGroupOrder) === null || _res$saveGroupOrder === void 0 ? void 0 : _res$saveGroupOrder.id)) {\n                _context3.next = 15;\n                break;\n              }\n\n              showMessage('操作成功 将前往付款');\n              _query = dealUrlQuery({\n                orderId: res === null || res === void 0 ? void 0 : (_res$saveGroupOrder2 = res.saveGroupOrder) === null || _res$saveGroupOrder2 === void 0 ? void 0 : _res$saveGroupOrder2.id\n              });\n              _context3.next = 11;\n              return router.replace(\"/m/pay\".concat(_query), \"/m/pay\".concat(_query));\n\n            case 11:\n              actionsSCM.clearData();\n              actionsSCM.getList();\n              actionsGroupProduct.clearData();\n              actionsOrderPageModel.close();\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    })),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 11\n    }\n  }, ll('提交订单')))))) || null;\n};\n\n_s(GroupOrderPage, \"MClJbrz3o55m0yTJI2NS5bR7BvE=\", false, function () {\n  return [useRouter, useStoreModel, useStoreModel, useStoreModel, useStoreModel, useStoreModel];\n});\n\n_c2 = GroupOrderPage;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"OrderPageBox\");\n$RefreshReg$(_c2, \"GroupOrderPage\");","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/m/groupProduct/groupOrderPage.tsx"],"names":["React","useEffect","modelFactory","styled","useStoreModel","dealMaybeNumber","dealMoney","dealUrlQuery","fpMerge","fpMergePre","dealGroupNumbers","groupProductModel","ShopCartProductBox","dealImgUrl","ProductPrice","IconButton","MenuItem","TextField","ll","Space","getPickUpTypeName","PickUpTypeEnum","ChevronRightIcon","AddressBox","CardBox","FooterFit","ShopTitle","ShopTotal","shopCartModel","SelectAddress","selectAddressModel","SelectCard","selectCardModel","ButtonLoad","mpStyle","showMessage","useRouter","HeaderTitle","groupOrderPageModel","show","open","value","option","setData","close","OrderPageBox","div","shadow","GroupOrderPage","router","stateOrderPageModel","state","actionsOrderPageModel","actions","actionsGroupProduct","stateGroupProduct","product","stateSCM","actionsSCM","user","id","getOrderInfo","actionsSAM","actionsSelectCard","addressData","dealAddressData","cardData","payCardList","find","v","form","paymentMethodCardId","productTotal","priceOut","selectNum","transportationCosts","dealTransportationCosts","actuallyPaid","dealDiscountAmount","saleTax","deductCoin","generateCoin","window","history","pushState","document","URL","addEventListener","removeEventListener","padding","img","url","name","weight","unit","remark","groupAmountUnitString","margin","width","pickUpType","event","setForm","target","initAddressId","Self","Delivery","combineAddress","contactInformation","openClick","res","number","orderCoinCurrentMonth","marginTop","marginBottom","e","numDiscount","groupDiscount","fontSize","userLevelList","code","userInfo","userLevel","submit","orderInfoItemInput","subtotal","currentUserLevel","rOrderProduct","count","productId","saveGroupOrder","_query","orderId","replace","clearData","getList"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport {modelFactory} from '../../../ModelAction/modelUtil'\r\nimport styled from 'styled-components'\r\nimport {useStoreModel} from '../../../ModelAction/useStore'\r\nimport {dealMaybeNumber, dealMoney, dealUrlQuery, fpMerge, fpMergePre} from '../../../tools/utils'\r\nimport {dealGroupNumbers, groupProductModel} from './[id]'\r\nimport {ShopCartProductBox} from '../cart/CartProduct'\r\nimport {dealImgUrl} from '../../../tools/img'\r\nimport {ProductPrice} from '../../../components/ProductItem/ProductItem'\r\nimport {IconButton, MenuItem, TextField} from '@material-ui/core'\r\nimport {ll} from '../../../tools/dealKey'\r\nimport {Space} from '../../../components/Box/Box'\r\nimport {getPickUpTypeName, PickUpTypeEnum} from '../../../ss_common/enum'\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\r\nimport {AddressBox, CardBox, FooterFit, ShopTitle, ShopTotal} from '../cart/orderPage'\r\nimport {shopCartModel} from '../cart'\r\nimport {SelectAddress, selectAddressModel} from '../cart/components/SelectAddress'\r\nimport {SelectCard, selectCardModel} from '../cart/components/SelectCard'\r\nimport {ButtonLoad} from '../../../components/ButtonLoad/ButtonLoad'\r\nimport {mpStyle} from '../../../style/common'\r\nimport {showMessage} from '../../../components/Message/Message'\r\nimport {useRouter} from 'next/router'\r\nimport {HeaderTitle} from '../../../components/HeaderTitle/HeaderTitle'\r\n\r\nexport const groupOrderPageModel = modelFactory('orderPageModel', {\r\n  show: false,\r\n}, {\r\n  open: (value, option) => {\r\n    option.setData(fpMergePre({\r\n      show: true,\r\n    }))\r\n  },\r\n  close: (value, option) => {\r\n    option.setData(fpMergePre({\r\n      show: false,\r\n    }))\r\n  },\r\n})\r\n\r\nconst OrderPageBox = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  background: white;\r\n  overflow-y: auto;\r\n  > footer {\r\n    position: fixed;\r\n    bottom: 0;\r\n    box-sizing: border-box;\r\n    box-shadow: ${mpStyle.shadow['1']};\r\n    width: 100vw;\r\n    text-align: right;\r\n  }\r\n`\r\n\r\nexport const GroupOrderPage = () => {\r\n  const router = useRouter()\r\n  const {state: stateOrderPageModel, actions: actionsOrderPageModel} = useStoreModel(groupOrderPageModel)\r\n  const {actions: actionsGroupProduct, state: stateGroupProduct} = useStoreModel(groupProductModel)\r\n  const product = stateGroupProduct.product\r\n  const {state: stateSCM, actions: actionsSCM} = useStoreModel(shopCartModel)\r\n  useEffect(() => {\r\n    if (!stateSCM.user.id) {\r\n      actionsSCM.getOrderInfo()\r\n    }\r\n  }, [])\r\n  const {actions: actionsSAM} = useStoreModel(selectAddressModel)\r\n  const {actions: actionsSelectCard} = useStoreModel(selectCardModel)\r\n\r\n  const addressData = stateSCM.dealAddressData(stateSCM)\r\n  const cardData = stateSCM.payCardList?.find(v => v.id === stateSCM.form.paymentMethodCardId) || {}\r\n  const productTotal = (product.priceOut ?? 0) * dealGroupNumbers(product) * stateGroupProduct.selectNum\r\n  const transportationCosts = stateSCM.dealTransportationCosts(stateSCM, productTotal)\r\n  const actuallyPaid = (stateGroupProduct.dealDiscountAmount(stateGroupProduct)) + transportationCosts + dealMaybeNumber(stateSCM.form.saleTax) - dealMaybeNumber(stateSCM.form?.deductCoin)\r\n  const generateCoin = actuallyPaid * 0.01\r\n\r\n  useEffect(() => {\r\n    if (stateOrderPageModel.show) {\r\n      window.history.pushState(null, '', document.URL)\r\n      window.addEventListener('popstate', (state) => {\r\n        // 监听到返回事件，注意，只有触发了返回才会执行这个方法\r\n        actionsOrderPageModel.close()\r\n      }, false)\r\n    }\r\n    return () => {\r\n      window.removeEventListener('popstate', (state) => {\r\n        actionsOrderPageModel.close()\r\n      })\r\n    }\r\n  }, [stateOrderPageModel.show])\r\n\r\n  return stateOrderPageModel.show && <>\r\n    <OrderPageBox>\r\n      <HeaderTitle\r\n          title={'订单支付'}\r\n          backCall={() => {\r\n            actionsOrderPageModel.close()\r\n            return true\r\n          }}\r\n      />\r\n      <ShopCartProductBox style={{padding: '20px'}}>\r\n        <img src={dealImgUrl(product?.img?.[0]?.url)}\r\n             alt=\"\"/>\r\n        <main>{product?.name}{product?.weight}{product?.unit}</main>\r\n        <section>{product?.remark}</section>\r\n        <footer>\r\n          <ProductPrice\r\n              priceOutTip={ll('基准价')}\r\n              product={product}/>\r\n          <span>{dealGroupNumbers(product) * stateGroupProduct.selectNum}{product.groupAmountUnitString}/{stateGroupProduct.selectNum}{ll('份')}</span>\r\n        </footer>\r\n      </ShopCartProductBox>\r\n      <TextField\r\n          style={{margin: '16px', width: 'calc(100vw - 32px)'}}\r\n          fullWidth={true}\r\n          label={ll('运送方式')}\r\n          select={true}\r\n          value={stateSCM.form.pickUpType}\r\n          onChange={event => {\r\n            actionsSCM.setForm(['pickUpType', event.target.value])\r\n            actionsSCM.setForm(['addressId', stateSCM.initAddressId(fpMerge(stateSCM, {\r\n              form: {\r\n                pickUpType: event.target.value,\r\n              },\r\n            }))])\r\n          }}\r\n      >\r\n        <MenuItem\r\n            value={PickUpTypeEnum.Self}\r\n        >{ll(getPickUpTypeName(PickUpTypeEnum.Self))}</MenuItem>\r\n        <MenuItem\r\n            value={PickUpTypeEnum.Delivery}\r\n        >{ll(getPickUpTypeName(PickUpTypeEnum.Delivery))}</MenuItem>\r\n      </TextField>\r\n      <AddressBox>\r\n        <main>\r\n          <header>\r\n            {`${addressData.combineAddress}`}\r\n          </header>\r\n          <footer>\r\n            {`${addressData.name} ${addressData.contactInformation}`}\r\n          </footer>\r\n        </main>\r\n        <aside>\r\n          <IconButton\r\n              onClick={async () => {\r\n                const res = await actionsSAM.openClick()\r\n                if (res) {\r\n                  actionsSCM.setForm(['addressId', res])\r\n                }\r\n              }}\r\n          >\r\n            <ChevronRightIcon/>\r\n          </IconButton>\r\n        </aside>\r\n      </AddressBox>\r\n      <ShopTitle>\r\n        <Space w={20}/>\r\n        {ll('付款方式')}\r\n      </ShopTitle>\r\n      <CardBox>\r\n        <header>{cardData.name}</header>\r\n        <footer>{cardData.number}</footer>\r\n        <aside>\r\n          <IconButton\r\n              onClick={async () => {\r\n                const res = await actionsSelectCard.openClick()\r\n                if (res) {\r\n                  actionsSCM.setForm(['paymentMethodCardId', res])\r\n                }\r\n              }}\r\n          >\r\n            <ChevronRightIcon/>\r\n          </IconButton>\r\n        </aside>\r\n      </CardBox>\r\n      <SelectAddress/>\r\n      <SelectCard/>\r\n      <ShopTitle>\r\n        <Space w={20}/>\r\n        {ll('使用达人币')}\r\n        <Space w={16}/>\r\n        <footer>{ll('当月可用余额')}{dealMoney(stateSCM.user.orderCoinCurrentMonth)}</footer>\r\n      </ShopTitle>\r\n      <div>\r\n        <Space w={20}/>\r\n        <TextField\r\n            style={{marginTop: '8px', marginBottom: '24px'}}\r\n            label={ll('')}\r\n            value={stateSCM.form.deductCoin}\r\n            onChange={e => {\r\n              actionsSCM.setForm(['deductCoin', e.target.value])\r\n            }}\r\n        />\r\n      </div>\r\n      <ShopTotal>\r\n        <header>{ll('购物车总计')}</header>\r\n        <footer>{dealMoney(productTotal)}</footer>\r\n      </ShopTotal>\r\n      <ShopTotal>\r\n        <header>{ll('份数折扣')}</header>\r\n        <footer>{stateGroupProduct.numDiscount}</footer>\r\n      </ShopTotal>\r\n      <ShopTotal>\r\n        <header>{ll('成团折上折')}</header>\r\n        <footer>{stateGroupProduct.groupDiscount}</footer>\r\n      </ShopTotal>\r\n      {transportationCosts > 0 && <ShopTotal>\r\n        <header>{ll('运费')}</header>\r\n        <footer>{dealMoney(transportationCosts)}</footer>\r\n      </ShopTotal>}\r\n      <ShopTotal>\r\n        <header>{ll('达人币抵扣')}</header>\r\n        <footer>{dealMoney(stateSCM.form.deductCoin, '-')}</footer>\r\n      </ShopTotal>\r\n      <ShopTotal\r\n          style={{fontSize: '18px'}}\r\n      >\r\n        <header>{ll('订单总额')}</header>\r\n        <footer>{dealMoney(actuallyPaid)}</footer>\r\n      </ShopTotal>\r\n      <Space h={120}/>\r\n      <FooterFit>\r\n        <header>{ll('本次订单')}\r\n          <span>{ll(stateSCM.userLevelList.find(v => v.code === stateSCM.user.userInfo?.userLevel)?.name)}</span>\r\n        </header>\r\n        <footer>{ll('将获得下月使用达人币 ')}\r\n          <span>{dealMoney(generateCoin)}</span>\r\n        </footer>\r\n        <aside>\r\n          {/*<Button*/}\r\n          {/*    style={{marginRight: '8px'}}*/}\r\n          {/*    variant={'contained'}*/}\r\n          {/*    onClick={() => {*/}\r\n          {/*      actionsOrderPageModel.close()*/}\r\n          {/*    }}*/}\r\n          {/*>{ls('取消')}</Button>*/}\r\n          <ButtonLoad\r\n              variant={'contained'}\r\n              color={'secondary'}\r\n              onClick={async () => {\r\n                if (dealMaybeNumber(stateSCM.user?.orderCoinCurrentMonth) < dealMaybeNumber(stateSCM.form.deductCoin)) {\r\n                  showMessage(ll('达人币余额不足'))\r\n                  return\r\n                }\r\n                const res = await actionsGroupProduct.submit({\r\n                  orderInfoItemInput: {\r\n                    ...stateSCM.form,\r\n                    generateCoin,\r\n                    actuallyPaid,\r\n                    transportationCosts,\r\n                    subtotal: productTotal,\r\n                    currentUserLevel: stateSCM.user.userInfo?.userLevel,\r\n                    rOrderProduct: [{\r\n                      count: stateGroupProduct.selectNum,\r\n                      productId: product?.id,\r\n                      product,\r\n                    }],\r\n                  },\r\n                })\r\n                if (res?.saveGroupOrder?.id) {\r\n                  showMessage('操作成功 将前往付款')\r\n                  const _query = dealUrlQuery({orderId: res?.saveGroupOrder?.id})\r\n                  await router.replace(`/m/pay${_query}`, `/m/pay${_query}`)\r\n                  actionsSCM.clearData()\r\n                  actionsSCM.getList()\r\n                  actionsGroupProduct.clearData()\r\n                  actionsOrderPageModel.close()\r\n                }\r\n              }}\r\n          >{ll('提交订单')}</ButtonLoad>\r\n        </aside>\r\n      </FooterFit>\r\n    </OrderPageBox>\r\n  </> || null\r\n}\r\n"]},"metadata":{},"sourceType":"module"}