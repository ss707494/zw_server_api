{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$(),\n    _this = this,\n    _jsxFileName = \"D:\\\\code\\\\zw\\\\zw_client_web\\\\utils\\\\view\\\\m\\\\cart\\\\orderPage.tsx\",\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect } from 'react';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport { HeaderTitle } from '../../../components/HeaderTitle/HeaderTitle';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { pageTypeEnum, shopCartModel } from './index';\nimport styled from 'styled-components';\nimport { ll } from '../../../tools/dealKey';\nimport { PickUpTypeEnum } from '../../../ss_common/enum';\nimport { doc } from '../../../graphqlTypes/doc';\nimport { IconButton, LinearProgress, TextField } from '@material-ui/core';\nimport { BScroller } from '../../../components/BScroll/BScroller';\nimport { Space } from '../../../components/Box/Box';\nimport { SelectAddress, selectAddressModel } from './components/SelectAddress';\nimport { grey } from '@material-ui/core/colors';\nimport { SelectCard, selectCardModel } from './components/SelectCard';\nimport { dealLastNumber, dealMaybeNumber, dealMoney, dealUrlQuery } from '../../../tools/utils';\nimport { mpStyle } from '../../../style/common';\nimport { ButtonLoad } from '../../../components/ButtonLoad/ButtonLoad';\nimport { showMessage } from '../../../components/Message/Message';\nimport { useRouter } from 'next/router';\nexport var ShopTitle = styled.div.withConfig({\n  displayName: \"orderPage__ShopTitle\",\n  componentId: \"sc-1cg2p58-0\"\n})([\"font-size:18px;font-weight:bold;display:flex;align-items:flex-end;> footer{font-size:14px;color:\", \";}\"], mpStyle.red);\n_c = ShopTitle;\nexport var AddressBox = styled.div.withConfig({\n  displayName: \"orderPage__AddressBox\",\n  componentId: \"sc-1cg2p58-1\"\n})([\"padding:20px;display:flex;align-items:center;> main{flex-grow:1;> header{font-size:16px;font-weight:bold;margin-bottom:8px;}}\"]);\n_c2 = AddressBox;\nexport var CardBox = styled.div.withConfig({\n  displayName: \"orderPage__CardBox\",\n  componentId: \"sc-1cg2p58-2\"\n})([\"padding:16px 20px;display:grid;grid-template-columns:1fr min-content;grid-template-rows:repeat(2,1fr);> header{font-size:16px;font-weight:bold;margin-bottom:8px;}> aside{grid-area:1/2/3/3;}\"]);\n_c3 = CardBox;\nexport var ShopTotal = styled.div.withConfig({\n  displayName: \"orderPage__ShopTotal\",\n  componentId: \"sc-1cg2p58-3\"\n})([\"padding:0 20px;display:flex;justify-content:space-between;margin-bottom:16px;\"]);\n_c4 = ShopTotal;\nexport var FooterFit = styled.div.withConfig({\n  displayName: \"orderPage__FooterFit\",\n  componentId: \"sc-1cg2p58-4\"\n})([\"position:fixed;box-sizing:border-box;background:white;bottom:0;width:100vw;padding:16px 24px;display:grid;grid-template-rows:repeat(2,1fr);grid-template-columns:1fr max-content;grid-row-gap:8px;box-shadow:\", \";> header{> span{font-size:12px;margin-left:8px;}}> aside{grid-area:1/2/3/3;}\"], mpStyle.shadow['1']);\n_c5 = FooterFit;\nexport var useOrderPageHooks = function useOrderPageHooks() {\n  _s();\n\n  var _stateShopCartModel$p, _stateShopCartModel$f;\n\n  var _useStoreModel = useStoreModel(shopCartModel),\n      stateShopCartModel = _useStoreModel.state,\n      actionsShopCartModel = _useStoreModel.actions,\n      getLoad = _useStoreModel.getLoad;\n\n  useEffect(function () {\n    actionsShopCartModel.getOrderInfo();\n  }, [actionsShopCartModel]);\n  var addressData = stateShopCartModel.dealAddressData(stateShopCartModel);\n  var cardData = ((_stateShopCartModel$p = stateShopCartModel.payCardList) === null || _stateShopCartModel$p === void 0 ? void 0 : _stateShopCartModel$p.find(function (v) {\n    return v.id === stateShopCartModel.form.paymentMethodCardId;\n  })) || {};\n  var productTotal = stateShopCartModel.dealProductTotal(stateShopCartModel);\n  var transportationCosts = stateShopCartModel.dealTransportationCosts(stateShopCartModel, productTotal);\n  var actuallyPaid = productTotal + transportationCosts - dealMaybeNumber(stateShopCartModel.form.deductCoin) + dealMaybeNumber(stateShopCartModel.form.saleTax) - dealMaybeNumber((_stateShopCartModel$f = stateShopCartModel.form) === null || _stateShopCartModel$f === void 0 ? void 0 : _stateShopCartModel$f.couponDiscount);\n  var generateCoin = actuallyPaid * 0.01;\n  return {\n    stateShopCartModel: stateShopCartModel,\n    actionsShopCartModel: actionsShopCartModel,\n    getLoad: getLoad,\n    addressData: addressData,\n    cardData: cardData,\n    productTotal: productTotal,\n    transportationCosts: transportationCosts,\n    actuallyPaid: actuallyPaid,\n    generateCoin: generateCoin\n  };\n};\n\n_s(useOrderPageHooks, \"pzozDPAxyb/NfHUOWvMoMMo9vZA=\", false, function () {\n  return [useStoreModel];\n});\n\nexport var OrderPage = function OrderPage() {\n  _s2();\n\n  var _addressData$fullName, _addressData$streetAd, _addressData$city, _addressData$province, _addressData$zip, _addressData$name, _addressData$address, _addressData$city2, _addressData$province2, _addressData$zip2, _stateShopCartModel$f2, _stateShopCartModel$f3, _stateShopCartModel$u;\n\n  var router = useRouter();\n\n  var _useOrderPageHooks = useOrderPageHooks(),\n      stateShopCartModel = _useOrderPageHooks.stateShopCartModel,\n      actionsShopCartModel = _useOrderPageHooks.actionsShopCartModel,\n      getLoad = _useOrderPageHooks.getLoad,\n      addressData = _useOrderPageHooks.addressData,\n      cardData = _useOrderPageHooks.cardData,\n      productTotal = _useOrderPageHooks.productTotal,\n      transportationCosts = _useOrderPageHooks.transportationCosts,\n      actuallyPaid = _useOrderPageHooks.actuallyPaid,\n      generateCoin = _useOrderPageHooks.generateCoin;\n\n  var _useStoreModel2 = useStoreModel(selectAddressModel),\n      actionsSelectAddressModel = _useStoreModel2.actions;\n\n  var _useStoreModel3 = useStoreModel(selectCardModel),\n      actionsSelectCardModel = _useStoreModel3.actions;\n\n  useEffect(function () {\n    if (stateShopCartModel.pageType === pageTypeEnum.order) {\n      window.history.pushState(null, '', document.URL);\n      window.addEventListener('popstate', function (state) {\n        // 监听到返回事件，注意，只有触发了返回才会执行这个方法\n        actionsShopCartModel.updatePageType(pageTypeEnum.shopCart);\n      }, false);\n    }\n\n    return function () {\n      window.removeEventListener('popstate', function (state) {\n        actionsShopCartModel.updatePageType(pageTypeEnum.shopCart);\n      });\n    };\n  }, [actionsShopCartModel, stateShopCartModel.pageType]);\n  return __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 10\n    }\n  }, __jsx(HeaderTitle, {\n    title: '订单支付',\n    backCall: function backCall() {\n      actionsShopCartModel.updatePageType(pageTypeEnum.shopCart);\n      return true;\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 5\n    }\n  }), !!getLoad(doc.orderConfirmInfo) && __jsx(LinearProgress, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 42\n    }\n  }) || __jsx(\"div\", {\n    style: {\n      height: '4px'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 64\n    }\n  }), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 135px)',\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 5\n    }\n  }, __jsx(Space, {\n    h: 10,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }\n  }), __jsx(ShopTitle, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  }), ll(stateShopCartModel.form.pickUpType === PickUpTypeEnum.Self && '自取地址' || '送货地址')), __jsx(AddressBox, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }\n  }, stateShopCartModel.form.pickUpType === PickUpTypeEnum.Self && __jsx(\"main\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 73\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 11\n    }\n  }, \"\".concat((_addressData$fullName = addressData.fullName) !== null && _addressData$fullName !== void 0 ? _addressData$fullName : '')), __jsx(\"section\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, (_addressData$streetAd = addressData.streetAddress) !== null && _addressData$streetAd !== void 0 ? _addressData$streetAd : ''), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 11\n    }\n  }, \"\".concat((_addressData$city = addressData.city) !== null && _addressData$city !== void 0 ? _addressData$city : '', \" \").concat((_addressData$province = addressData.province) !== null && _addressData$province !== void 0 ? _addressData$province : '', \" \").concat((_addressData$zip = addressData.zip) !== null && _addressData$zip !== void 0 ? _addressData$zip : ''))) || __jsx(\"main\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 21\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 11\n    }\n  }, \"\".concat((_addressData$name = addressData.name) !== null && _addressData$name !== void 0 ? _addressData$name : '')), __jsx(\"section\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 11\n    }\n  }, (_addressData$address = addressData.address) !== null && _addressData$address !== void 0 ? _addressData$address : ''), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 11\n    }\n  }, \"\".concat((_addressData$city2 = addressData.city) !== null && _addressData$city2 !== void 0 ? _addressData$city2 : '', \" \").concat((_addressData$province2 = addressData.province) !== null && _addressData$province2 !== void 0 ? _addressData$province2 : '', \" \").concat((_addressData$zip2 = addressData.zip) !== null && _addressData$zip2 !== void 0 ? _addressData$zip2 : ''))), __jsx(\"aside\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 9\n    }\n  }, __jsx(IconButton, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return actionsSelectAddressModel.openClick();\n\n            case 2:\n              res = _context.sent;\n\n              if (res) {\n                actionsShopCartModel.setForm(['addressId', res]);\n              }\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 11\n    }\n  }, __jsx(ChevronRightIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }\n  })))), __jsx(Space, {\n    c: grey[200],\n    h: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }\n  }), __jsx(Space, {\n    h: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }\n  }), __jsx(ShopTitle, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }\n  }), ll('付款方式')), __jsx(CardBox, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }, cardData.name), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 9\n    }\n  }, dealLastNumber(cardData.number)), __jsx(\"aside\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 9\n    }\n  }, __jsx(IconButton, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return actionsSelectCardModel.openClick();\n\n            case 2:\n              res = _context2.sent;\n\n              if (res) {\n                actionsShopCartModel.setForm(['paymentMethodCardId', res]);\n              }\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 11\n    }\n  }, __jsx(ChevronRightIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 13\n    }\n  })))), __jsx(Space, {\n    c: grey[200],\n    h: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 7\n    }\n  }), __jsx(Space, {\n    h: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }\n  }), __jsx(ShopTitle, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }\n  }), ll('使用达人币'), __jsx(Space, {\n    w: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 9\n    }\n  }), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 9\n    }\n  }, ll('当月可用余额'), dealMoney(stateShopCartModel.user.orderCoinCurrentMonth))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 9\n    }\n  }), __jsx(TextField, {\n    style: {\n      marginTop: '8px',\n      marginBottom: '24px'\n    },\n    label: ll(''),\n    value: stateShopCartModel.form.deductCoin,\n    onChange: function onChange(e) {\n      actionsShopCartModel.setForm(['deductCoin', e.target.value]);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }\n  })), __jsx(Space, {\n    c: grey[200],\n    h: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }\n  }), __jsx(Space, {\n    h: 16,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 7\n    }\n  }), __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 9\n    }\n  }, ll('购物车总计')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 9\n    }\n  }, dealMoney(productTotal - ((_stateShopCartModel$f2 = (_stateShopCartModel$f3 = stateShopCartModel.form) === null || _stateShopCartModel$f3 === void 0 ? void 0 : _stateShopCartModel$f3.couponDiscount) !== null && _stateShopCartModel$f2 !== void 0 ? _stateShopCartModel$f2 : 0)))), transportationCosts > 0 && __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 35\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 9\n    }\n  }, ll('运费')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 9\n    }\n  }, dealMoney(transportationCosts))), __jsx(ShopTotal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 9\n    }\n  }, ll('达人币抵扣')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 9\n    }\n  }, dealMoney(stateShopCartModel.form.deductCoin, '-'))), __jsx(ShopTotal, {\n    style: {\n      fontSize: '18px'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 9\n    }\n  }, ll('订单总额')), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 9\n    }\n  }, dealMoney(actuallyPaid))), __jsx(Space, {\n    h: 30,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 7\n    }\n  })), __jsx(FooterFit, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 5\n    }\n  }, __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }\n  }, ll('本次订单'), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 9\n    }\n  }, ll((_stateShopCartModel$u = stateShopCartModel.userLevelList.find(function (v) {\n    var _stateShopCartModel$u2;\n\n    return v.code === ((_stateShopCartModel$u2 = stateShopCartModel.user.userInfo) === null || _stateShopCartModel$u2 === void 0 ? void 0 : _stateShopCartModel$u2.userLevel);\n  })) === null || _stateShopCartModel$u === void 0 ? void 0 : _stateShopCartModel$u.name))), __jsx(\"footer\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 7\n    }\n  }, ll('将获得下月使用达人币 '), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 9\n    }\n  }, dealMoney(generateCoin))), __jsx(\"aside\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 7\n    }\n  }, __jsx(ButtonLoad, {\n    loading: getLoad(doc.saveOrder),\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var _stateShopCartModel$u3, _stateShopCartModel$u4, _res$saveOrder;\n\n      var submitData, res, _res$saveOrder2, _query;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(dealMaybeNumber((_stateShopCartModel$u3 = stateShopCartModel.user) === null || _stateShopCartModel$u3 === void 0 ? void 0 : _stateShopCartModel$u3.orderCoinCurrentMonth) < dealMaybeNumber(stateShopCartModel.form.deductCoin))) {\n                _context3.next = 3;\n                break;\n              }\n\n              showMessage(ll('达人币余额不足'));\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              if (!(!stateShopCartModel.form.addressId || !addressData.city)) {\n                _context3.next = 6;\n                break;\n              }\n\n              showMessage(ll('请选择送货地址'));\n              return _context3.abrupt(\"return\");\n\n            case 6:\n              if (cardData.number) {\n                _context3.next = 9;\n                break;\n              }\n\n              showMessage(ll('请选择信用卡'));\n              return _context3.abrupt(\"return\");\n\n            case 9:\n              submitData = _objectSpread(_objectSpread({}, stateShopCartModel.form), {}, {\n                generateCoin: generateCoin,\n                actuallyPaid: actuallyPaid,\n                transportationCosts: transportationCosts,\n                subtotal: productTotal,\n                currentUserLevel: (_stateShopCartModel$u4 = stateShopCartModel.user.userInfo) === null || _stateShopCartModel$u4 === void 0 ? void 0 : _stateShopCartModel$u4.userLevel,\n                rOrderProduct: stateShopCartModel.shopCartList.map(function (v) {\n                  var _v$product;\n\n                  return {\n                    count: v.number,\n                    productId: (_v$product = v.product) === null || _v$product === void 0 ? void 0 : _v$product.id,\n                    product: v.product\n                  };\n                })\n              });\n              _context3.next = 12;\n              return actionsShopCartModel.submit(_objectSpread({}, submitData));\n\n            case 12:\n              res = _context3.sent;\n\n              if (!(res === null || res === void 0 ? void 0 : (_res$saveOrder = res.saveOrder) === null || _res$saveOrder === void 0 ? void 0 : _res$saveOrder.id)) {\n                _context3.next = 20;\n                break;\n              }\n\n              showMessage('操作成功 将前往付款');\n              _query = dealUrlQuery({\n                orderId: res === null || res === void 0 ? void 0 : (_res$saveOrder2 = res.saveOrder) === null || _res$saveOrder2 === void 0 ? void 0 : _res$saveOrder2.id\n              });\n              _context3.next = 18;\n              return router.replace(\"/m/pay\".concat(_query), \"/m/pay\".concat(_query));\n\n            case 18:\n              actionsShopCartModel.clearData();\n              actionsShopCartModel.getList();\n\n            case 20:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    })),\n    variant: 'contained',\n    color: 'secondary',\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 9\n    }\n  }, ll('提交订单')))), __jsx(SelectAddress, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 5\n    }\n  }), __jsx(SelectCard, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 5\n    }\n  }));\n};\n\n_s2(OrderPage, \"4rt0FI4AqxnxjtuE9OQn1mUrWJk=\", false, function () {\n  return [useRouter, useOrderPageHooks, useStoreModel, useStoreModel];\n});\n\n_c6 = OrderPage;\n\nvar _c, _c2, _c3, _c4, _c5, _c6;\n\n$RefreshReg$(_c, \"ShopTitle\");\n$RefreshReg$(_c2, \"AddressBox\");\n$RefreshReg$(_c3, \"CardBox\");\n$RefreshReg$(_c4, \"ShopTotal\");\n$RefreshReg$(_c5, \"FooterFit\");\n$RefreshReg$(_c6, \"OrderPage\");","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/m/cart/orderPage.tsx"],"names":["React","useEffect","ChevronRightIcon","HeaderTitle","useStoreModel","pageTypeEnum","shopCartModel","styled","ll","PickUpTypeEnum","doc","IconButton","LinearProgress","TextField","BScroller","Space","SelectAddress","selectAddressModel","grey","SelectCard","selectCardModel","dealLastNumber","dealMaybeNumber","dealMoney","dealUrlQuery","mpStyle","ButtonLoad","showMessage","useRouter","ShopTitle","div","red","AddressBox","CardBox","ShopTotal","FooterFit","shadow","useOrderPageHooks","stateShopCartModel","state","actionsShopCartModel","actions","getLoad","getOrderInfo","addressData","dealAddressData","cardData","payCardList","find","v","id","form","paymentMethodCardId","productTotal","dealProductTotal","transportationCosts","dealTransportationCosts","actuallyPaid","deductCoin","saleTax","couponDiscount","generateCoin","OrderPage","router","actionsSelectAddressModel","actionsSelectCardModel","pageType","order","window","history","pushState","document","URL","addEventListener","updatePageType","shopCart","removeEventListener","orderConfirmInfo","height","pickUpType","Self","fullName","streetAddress","city","province","zip","name","address","openClick","res","setForm","number","user","orderCoinCurrentMonth","marginTop","marginBottom","e","target","value","fontSize","userLevelList","code","userInfo","userLevel","saveOrder","addressId","submitData","subtotal","currentUserLevel","rOrderProduct","shopCartList","map","count","productId","product","submit","_query","orderId","replace","clearData","getList"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\r\nimport {HeaderTitle} from '../../../components/HeaderTitle/HeaderTitle'\r\nimport {useStoreModel} from '../../../ModelAction/useStore'\r\nimport {pageTypeEnum, shopCartModel} from './index'\r\nimport styled from 'styled-components'\r\nimport {ll} from '../../../tools/dealKey'\r\nimport {PickUpTypeEnum} from '../../../ss_common/enum'\r\nimport {doc} from '../../../graphqlTypes/doc'\r\nimport {IconButton, LinearProgress, TextField} from '@material-ui/core'\r\nimport {BScroller} from '../../../components/BScroll/BScroller'\r\nimport {Space} from '../../../components/Box/Box'\r\nimport {SelectAddress, selectAddressModel} from './components/SelectAddress'\r\nimport {grey} from '@material-ui/core/colors'\r\nimport {SelectCard, selectCardModel} from './components/SelectCard'\r\nimport {dealLastNumber, dealMaybeNumber, dealMoney, dealUrlQuery} from '../../../tools/utils'\r\nimport {mpStyle} from '../../../style/common'\r\nimport {ButtonLoad} from '../../../components/ButtonLoad/ButtonLoad'\r\nimport {showMessage} from '../../../components/Message/Message'\r\nimport {useRouter} from 'next/router'\r\n\r\nexport const ShopTitle = styled.div`\r\n  font-size: 18px;\r\n  font-weight: bold;\r\n  display: flex;\r\n  align-items: flex-end;\r\n  > footer {\r\n    font-size: 14px;\r\n    color: ${mpStyle.red};\r\n  }\r\n`\r\nexport const AddressBox = styled.div`\r\n  padding: 20px;\r\n  display: flex;\r\n  align-items: center;\r\n  > main {\r\n    flex-grow: 1;\r\n    > header {\r\n      font-size: 16px;\r\n      font-weight: bold;\r\n      margin-bottom: 8px;\r\n    }\r\n  }\r\n`\r\nexport const CardBox = styled.div`\r\n  padding: 16px 20px;\r\n  display: grid;\r\n  grid-template-columns: 1fr min-content;\r\n  grid-template-rows: repeat(2, 1fr);\r\n  > header {\r\n    font-size: 16px;\r\n    font-weight: bold;\r\n    margin-bottom: 8px;\r\n  }\r\n  > aside {\r\n    grid-area: 1/2/3/3;\r\n  }\r\n`\r\nexport const ShopTotal = styled.div`\r\n  padding: 0 20px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 16px;\r\n`\r\nexport const FooterFit = styled.div`\r\n  position: fixed;\r\n  box-sizing: border-box;\r\n  background: white;\r\n  bottom: 0;\r\n  width: 100vw;\r\n  padding: 16px 24px;\r\n  display: grid;\r\n  grid-template-rows: repeat(2, 1fr);\r\n  grid-template-columns: 1fr max-content;\r\n  grid-row-gap: 8px;\r\n  box-shadow: ${mpStyle.shadow['1']};\r\n  > header {\r\n    > span {\r\n      font-size: 12px;\r\n      margin-left: 8px;\r\n    }\r\n  }\r\n  > aside {\r\n    grid-area: 1/2/3/3;\r\n  }\r\n`\r\n\r\nexport const useOrderPageHooks = () => {\r\n  const {state: stateShopCartModel, actions: actionsShopCartModel, getLoad} = useStoreModel(shopCartModel)\r\n\r\n  useEffect(() => {\r\n    actionsShopCartModel.getOrderInfo()\r\n  }, [actionsShopCartModel])\r\n\r\n  const addressData = stateShopCartModel.dealAddressData(stateShopCartModel)\r\n  const cardData = stateShopCartModel.payCardList?.find(v => v.id === stateShopCartModel.form.paymentMethodCardId) || {}\r\n  const productTotal = stateShopCartModel.dealProductTotal(stateShopCartModel)\r\n  const transportationCosts = stateShopCartModel.dealTransportationCosts(stateShopCartModel, productTotal)\r\n  const actuallyPaid = productTotal + transportationCosts - dealMaybeNumber(stateShopCartModel.form.deductCoin) + dealMaybeNumber(stateShopCartModel.form.saleTax) - dealMaybeNumber(stateShopCartModel.form?.couponDiscount)\r\n  const generateCoin = actuallyPaid * 0.01\r\n\r\n  return {\r\n    stateShopCartModel,\r\n    actionsShopCartModel,\r\n    getLoad,\r\n    addressData,\r\n    cardData,\r\n    productTotal,\r\n    transportationCosts,\r\n    actuallyPaid,\r\n    generateCoin,\r\n  }\r\n}\r\n\r\nexport const OrderPage = () => {\r\n  const router = useRouter()\r\n  const {\r\n    stateShopCartModel,\r\n    actionsShopCartModel,\r\n    getLoad,\r\n    addressData,\r\n    cardData,\r\n    productTotal,\r\n    transportationCosts,\r\n    actuallyPaid,\r\n    generateCoin,\r\n  } = useOrderPageHooks()\r\n  const {actions: actionsSelectAddressModel} = useStoreModel(selectAddressModel)\r\n  const {actions: actionsSelectCardModel} = useStoreModel(selectCardModel)\r\n\r\n  useEffect(() => {\r\n    if (stateShopCartModel.pageType === pageTypeEnum.order) {\r\n      window.history.pushState(null, '', document.URL)\r\n      window.addEventListener('popstate', (state) => {\r\n        // 监听到返回事件，注意，只有触发了返回才会执行这个方法\r\n        actionsShopCartModel.updatePageType(pageTypeEnum.shopCart)\r\n      }, false)\r\n    }\r\n    return () => {\r\n      window.removeEventListener('popstate', (state) => {\r\n        actionsShopCartModel.updatePageType(pageTypeEnum.shopCart)\r\n      })\r\n    }\r\n  }, [actionsShopCartModel, stateShopCartModel.pageType])\r\n\r\n  return <div>\r\n    <HeaderTitle\r\n        title={'订单支付'}\r\n        backCall={() => {\r\n          actionsShopCartModel.updatePageType(pageTypeEnum.shopCart)\r\n          return true\r\n        }}\r\n    />\r\n    {(!!getLoad(doc.orderConfirmInfo) && <LinearProgress/>) || <div style={{height: '4px'}}/>}\r\n    <BScroller\r\n        boxHeight={'calc(100vh - 135px)'}\r\n    >\r\n      <Space h={10}/>\r\n      <ShopTitle>\r\n        <Space w={20}/>\r\n        {ll((stateShopCartModel.form.pickUpType === PickUpTypeEnum.Self && '自取地址') || '送货地址')}\r\n      </ShopTitle>\r\n      <AddressBox>\r\n        {(stateShopCartModel.form.pickUpType === PickUpTypeEnum.Self && <main>\r\n          <header>\r\n            {`${addressData.fullName ?? ''}`}\r\n          </header>\r\n          <section>{addressData.streetAddress ?? ''}</section>\r\n          <footer>\r\n            {`${addressData.city ?? ''} ${addressData.province ?? ''} ${addressData.zip ?? ''}`}\r\n          </footer>\r\n        </main>) || <main>\r\n          <header>\r\n            {`${addressData.name ?? ''}`}\r\n          </header>\r\n          <section>{addressData.address ?? ''}</section>\r\n          <footer>\r\n            {`${addressData.city ?? ''} ${addressData.province ?? ''} ${addressData.zip ?? ''}`}\r\n          </footer>\r\n        </main>}\r\n        <aside>\r\n          <IconButton\r\n              onClick={async () => {\r\n                const res = await actionsSelectAddressModel.openClick()\r\n                if (res) {\r\n                  actionsShopCartModel.setForm(['addressId', res])\r\n                }\r\n              }}\r\n          >\r\n            <ChevronRightIcon/>\r\n          </IconButton>\r\n        </aside>\r\n      </AddressBox>\r\n      <Space c={grey[200]}\r\n             h={16}/>\r\n      <Space h={16}/>\r\n      <ShopTitle>\r\n        <Space w={20}/>\r\n        {ll('付款方式')}\r\n      </ShopTitle>\r\n      <CardBox>\r\n        <header>{cardData.name}</header>\r\n        <footer>{dealLastNumber(cardData.number)}</footer>\r\n        <aside>\r\n          <IconButton\r\n              onClick={async () => {\r\n                const res = await actionsSelectCardModel.openClick()\r\n                if (res) {\r\n                  actionsShopCartModel.setForm(['paymentMethodCardId', res])\r\n                }\r\n              }}\r\n          >\r\n            <ChevronRightIcon/>\r\n          </IconButton>\r\n        </aside>\r\n      </CardBox>\r\n      <Space c={grey[200]}\r\n             h={16}/>\r\n      <Space h={16}/>\r\n      <ShopTitle>\r\n        <Space w={20}/>\r\n        {ll('使用达人币')}\r\n        <Space w={16}/>\r\n        <footer>{ll('当月可用余额')}{dealMoney(stateShopCartModel.user.orderCoinCurrentMonth)}</footer>\r\n      </ShopTitle>\r\n      <div>\r\n        <Space w={20}/>\r\n        <TextField\r\n            style={{marginTop: '8px', marginBottom: '24px'}}\r\n            label={ll('')}\r\n            value={stateShopCartModel.form.deductCoin}\r\n            onChange={e => {\r\n              actionsShopCartModel.setForm(['deductCoin', e.target.value])\r\n            }}\r\n        />\r\n      </div>\r\n      <Space\r\n          c={grey[200]}\r\n          h={16}/>\r\n      <Space h={16}/>\r\n      <ShopTotal>\r\n        <header>{ll('购物车总计')}</header>\r\n        <footer>{dealMoney(productTotal - (stateShopCartModel.form?.couponDiscount ?? 0))}</footer>\r\n      </ShopTotal>\r\n      {/*{dealMaybeNumber(stateShopCartModel.form?.couponDiscount) > 0 && <ShopTotal>*/}\r\n      {/*  <header>{ls('优惠折扣')}</header>*/}\r\n      {/*  <footer>{dealMoney(stateShopCartModel.form?.couponDiscount)}</footer>*/}\r\n      {/*</ShopTotal>}*/}\r\n      {transportationCosts > 0 && <ShopTotal>\r\n        <header>{ll('运费')}</header>\r\n        <footer>{dealMoney(transportationCosts)}</footer>\r\n      </ShopTotal>}\r\n      <ShopTotal>\r\n        <header>{ll('达人币抵扣')}</header>\r\n        <footer>{dealMoney(stateShopCartModel.form.deductCoin, '-')}</footer>\r\n      </ShopTotal>\r\n      {/*<ShopTotal>*/}\r\n      {/*  <header>{ls('消费税')}</header>*/}\r\n      {/*  <footer>{dealMoney(stateShopCartModel.form.saleTax)}</footer>*/}\r\n      {/*</ShopTotal>*/}\r\n      <ShopTotal\r\n          style={{fontSize: '18px'}}\r\n      >\r\n        <header>{ll('订单总额')}</header>\r\n        <footer>{dealMoney(actuallyPaid)}</footer>\r\n      </ShopTotal>\r\n      <Space h={30}/>\r\n    </BScroller>\r\n    <FooterFit>\r\n      <header>{ll('本次订单')}\r\n        <span>{ll(stateShopCartModel.userLevelList.find(v => v.code === stateShopCartModel.user.userInfo?.userLevel)?.name)}</span>\r\n      </header>\r\n      <footer>{ll('将获得下月使用达人币 ')}\r\n        <span>{dealMoney(generateCoin)}</span>\r\n      </footer>\r\n      <aside>\r\n        <ButtonLoad\r\n            loading={getLoad(doc.saveOrder)}\r\n            onClick={async () => {\r\n              if (dealMaybeNumber(stateShopCartModel.user?.orderCoinCurrentMonth) < dealMaybeNumber(stateShopCartModel.form.deductCoin)) {\r\n                showMessage(ll('达人币余额不足'))\r\n                return\r\n              }\r\n              if (!stateShopCartModel.form.addressId || !addressData.city) {\r\n                showMessage(ll('请选择送货地址'))\r\n                return\r\n              }\r\n              if (!cardData.number) {\r\n                showMessage(ll('请选择信用卡'))\r\n                return\r\n              }\r\n\r\n              const submitData = {\r\n                ...stateShopCartModel.form,\r\n                generateCoin,\r\n                actuallyPaid,\r\n                transportationCosts,\r\n                subtotal: productTotal,\r\n                currentUserLevel: stateShopCartModel.user.userInfo?.userLevel,\r\n                rOrderProduct: stateShopCartModel.shopCartList.map(v => ({\r\n                  count: v.number,\r\n                  productId: v.product?.id,\r\n                  product: v.product,\r\n                })),\r\n              }\r\n              const res = await actionsShopCartModel.submit({\r\n                ...submitData,\r\n              })\r\n              if (res?.saveOrder?.id) {\r\n                showMessage('操作成功 将前往付款')\r\n                const _query = dealUrlQuery({orderId: res?.saveOrder?.id})\r\n                await router.replace(`/m/pay${_query}`, `/m/pay${_query}`)\r\n                actionsShopCartModel.clearData()\r\n                actionsShopCartModel.getList()\r\n              }\r\n            }}\r\n            variant={'contained'}\r\n            color={'secondary'}\r\n        >{ll('提交订单')}</ButtonLoad>\r\n      </aside>\r\n    </FooterFit>\r\n    <SelectAddress/>\r\n    <SelectCard/>\r\n  </div>\r\n}\r\n"]},"metadata":{},"sourceType":"module"}