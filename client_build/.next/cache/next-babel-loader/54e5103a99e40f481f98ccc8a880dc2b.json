{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { KeyboardArrowRight } from '@material-ui/icons';\nimport { Breadcrumbs, ButtonBase, LinearProgress, Link, Typography } from '@material-ui/core';\nimport { dealUrlQuery, fpMergePre } from '../../../tools/utils';\nimport { HeaderTitle } from '../../../components/HeaderTitle/HeaderTitle';\nimport { doc } from '../../../graphqlTypes/doc';\nimport { BScroller } from '../../../components/BScroll/BScroller';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport styled from 'styled-components';\nimport { grey } from '@material-ui/core/colors';\nimport { dealImgUrl } from '../../../tools/img';\nimport { GroupProductItem, ProductItem } from '../../../components/ProductItem/ProductItem';\nimport { ls } from '../../../tools/dealKey';\nimport { NoData } from '../../../components/NoData/NoData';\nimport { CategoryRootName } from '../../../ss_common/enum';\nimport { UpdateShopCart } from '../../../components/ProductItem/UpdateShopCart';\nimport { HomeType } from '../home/appModule';\nimport { homeTabsModel } from '../home/components/Tabs/Tabs';\nexport var CategoryPageModel = modelFactory('CategoryPage', {\n  productList: [],\n  categoryList: []\n}, {\n  getProductList: function () {\n    var _getProductList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var _res$productsInCatego, _res$productsInCatego2, _res$categoryList$lis, _res$categoryList;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.productsInCategory, {\n                data: value.categoryItemInput,\n                productItemInput: value.productItemInput\n              });\n\n            case 2:\n              res = _context.sent;\n              option.setData(fpMergePre({\n                productList: (_res$productsInCatego = res === null || res === void 0 ? void 0 : (_res$productsInCatego2 = res.productsInCategory) === null || _res$productsInCatego2 === void 0 ? void 0 : _res$productsInCatego2.list) !== null && _res$productsInCatego !== void 0 ? _res$productsInCatego : [],\n                categoryList: _toConsumableArray((_res$categoryList$lis = res === null || res === void 0 ? void 0 : (_res$categoryList = res.categoryList) === null || _res$categoryList === void 0 ? void 0 : _res$categoryList.list) !== null && _res$categoryList$lis !== void 0 ? _res$categoryList$lis : [])\n              }));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getProductList(_x, _x2) {\n      return _getProductList.apply(this, arguments);\n    }\n\n    return getProductList;\n  }()\n});\nvar Box = styled('div').withConfig({\n  displayName: \"id__Box\",\n  componentId: \"qp4xb8-0\"\n})([\"padding:18px 20px 0;> header{font-size:18px;font-weight:bold;margin:10px 0;}\"]);\nvar CategoryItemStyle = styled(ButtonBase).withConfig({\n  displayName: \"id__CategoryItemStyle\",\n  componentId: \"qp4xb8-1\"\n})([\"&&&{width:100%;height:60px;display:flex;border-radius:8px;overflow:hidden;margin-bottom:10px;background:\", \";> img{height:100%;width:70%;}> span{flex:1;color:#fff;display:flex;align-items:center;justify-content:center;}}\"], grey[700]);\nvar categoryItemModel = modelFactory('categoryItemModel', {\n  test: '',\n  category: {}\n}, {\n  getLevel: function () {\n    var _getLevel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value, option) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return option.query(doc.categoryLevel, {\n                data: value\n              });\n\n            case 2:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function getLevel(_x3, _x4) {\n      return _getLevel.apply(this, arguments);\n    }\n\n    return getLevel;\n  }(),\n  getCategory: function () {\n    var _getCategory = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value, option) {\n      var _res$oneCategory;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return option.query(doc.oneCategory, {\n                data: value\n              });\n\n            case 2:\n              res = _context3.sent;\n              option.setData(fpMergePre({\n                category: (_res$oneCategory = res === null || res === void 0 ? void 0 : res.oneCategory) !== null && _res$oneCategory !== void 0 ? _res$oneCategory : {}\n              }));\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function getCategory(_x5, _x6) {\n      return _getCategory.apply(this, arguments);\n    }\n\n    return getCategory;\n  }()\n});\nvar ListBox = styled.div.withConfig({\n  displayName: \"id__ListBox\",\n  componentId: \"qp4xb8-2\"\n})([\"display:grid;grid-template-columns:repeat(\", \",1fr);grid-gap:16px;\"], function (props) {\n  return props.columns || 2;\n});\nexport var CategoryPage = function CategoryPage() {\n  var _ref, _router$query, _stateCategoryItemMod, _stateCategoryItemMod2, _stateCategoryItemMod3;\n\n  var router = useRouter();\n  var id = (_ref = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id) !== null && _ref !== void 0 ? _ref : '';\n\n  var _useStoreModel = useStoreModel(CategoryPageModel),\n      stateCPM = _useStoreModel.state,\n      actionsCPM = _useStoreModel.actions,\n      getLoad = _useStoreModel.getLoad;\n\n  var _useStoreModel2 = useStoreModel(categoryItemModel),\n      actionsCI = _useStoreModel2.actions,\n      stateCategoryItemModel = _useStoreModel2.state;\n\n  var _useStoreModel3 = useStoreModel(homeTabsModel),\n      stateHomeTabs = _useStoreModel3.state,\n      actionsHomeTabs = _useStoreModel3.actions;\n\n  useEffect(function () {\n    var _ref2;\n\n    actionsHomeTabs.setHomeType((_ref2 = router.query.homeType) !== null && _ref2 !== void 0 ? _ref2 : HomeType.home);\n  }, [router.query.homeType]);\n\n  var CategoryItem = function CategoryItem(v) {\n    return __jsx(CategoryItemStyle, {\n      key: \"CategoryItem_\".concat(v.id),\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var _yield$actionsCI$getL;\n\n        var _query;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _query = dealUrlQuery({\n                  homeType: router.query.homeType\n                });\n                _context4.next = 3;\n                return actionsCI.getLevel({\n                  id: v.id\n                });\n\n              case 3:\n                _context4.t1 = _yield$actionsCI$getL = _context4.sent;\n                _context4.t0 = _context4.t1 === null;\n\n                if (_context4.t0) {\n                  _context4.next = 7;\n                  break;\n                }\n\n                _context4.t0 = _yield$actionsCI$getL === void 0;\n\n              case 7:\n                if (!_context4.t0) {\n                  _context4.next = 11;\n                  break;\n                }\n\n                _context4.t2 = void 0;\n                _context4.next = 12;\n                break;\n\n              case 11:\n                _context4.t2 = _yield$actionsCI$getL.categoryLevel;\n\n              case 12:\n                _context4.t3 = _context4.t2;\n\n                if (!(_context4.t3 === 3)) {\n                  _context4.next = 18;\n                  break;\n                }\n\n                _context4.next = 16;\n                return Router.push(\"/m/productList/[id]\".concat(_query), \"/m/productList/\".concat(v.id).concat(_query));\n\n              case 16:\n                _context4.next = 20;\n                break;\n\n              case 18:\n                _context4.next = 20;\n                return Router.push(\"/m/category/[id]\".concat(_query), \"/m/category/\".concat(v.id).concat(_query));\n\n              case 20:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))\n    }, __jsx(\"img\", {\n      src: dealImgUrl(v.imgUrl),\n      alt: \"\"\n    }), __jsx(\"span\", null, v.name, __jsx(KeyboardArrowRight, null)));\n  };\n\n  useEffect(function () {\n    if (id) {\n      actionsCPM.getProductList({\n        categoryItemInput: {\n          id: id\n        },\n        productItemInput: {\n          isGroup: router.query.homeType === HomeType.group ? 1 : 0\n        }\n      });\n      actionsCI.getCategory({\n        id: id\n      });\n    }\n  }, [id]);\n  return __jsx(\"div\", null, __jsx(HeaderTitle, {\n    title: '',\n    showCart: router.query.homeType === HomeType.home,\n    showSearch: true\n  }), !!getLoad(doc.productsInCategory) && __jsx(LinearProgress, null), __jsx(Breadcrumbs, {\n    style: {\n      margin: '8px 0 0 8px'\n    },\n    separator: \"\\u203A\",\n    \"aria-label\": \"breadcrumb\"\n  }, [(_stateCategoryItemMod = stateCategoryItemModel.category) === null || _stateCategoryItemMod === void 0 ? void 0 : (_stateCategoryItemMod2 = _stateCategoryItemMod.parentCategory) === null || _stateCategoryItemMod2 === void 0 ? void 0 : _stateCategoryItemMod2.parentCategory, (_stateCategoryItemMod3 = stateCategoryItemModel.category) === null || _stateCategoryItemMod3 === void 0 ? void 0 : _stateCategoryItemMod3.parentCategory].filter(function (v) {\n    return !!(v === null || v === void 0 ? void 0 : v.name) && (v === null || v === void 0 ? void 0 : v.name) !== CategoryRootName;\n  }).map(function (e) {\n    return __jsx(Link, {\n      key: \"Breadcrumbs\".concat(e === null || e === void 0 ? void 0 : e.id),\n      color: \"inherit\",\n      href: \"#\",\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var _query;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _query = dealUrlQuery({\n                  homeType: router.query.homeType\n                });\n                _context5.next = 3;\n                return Router.push(\"/m/category/[id]\".concat(_query), \"/m/category/\".concat(e === null || e === void 0 ? void 0 : e.id).concat(_query));\n\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }))\n    }, e === null || e === void 0 ? void 0 : e.name);\n  }), __jsx(Typography, {\n    color: \"textPrimary\"\n  }, stateCategoryItemModel.category.name)), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 60px)'\n  }, __jsx(Box, null, stateCPM.categoryList.length === 0 && stateCPM.productList.length === 0 && __jsx(NoData, null) || __jsx(React.Fragment, null, stateCPM.categoryList.map(function (value) {\n    return CategoryItem(value);\n  }), __jsx(\"header\", null, ls('热门推荐')), stateCPM.productList.length === 0 && __jsx(NoData, null), __jsx(ListBox, {\n    columns: stateHomeTabs.homeType === HomeType.group ? 1 : 2\n  }, stateCPM.productList.map(function (value) {\n    return stateHomeTabs.homeType === HomeType.group && __jsx(GroupProductItem, {\n      product: value,\n      key: \"ProductItem_\".concat(value.id)\n    }) || __jsx(ProductItem, {\n      key: \"ProductItem_\".concat(value.id),\n      product: value\n    });\n  }))))), __jsx(UpdateShopCart, null));\n};","map":null,"metadata":{},"sourceType":"module"}