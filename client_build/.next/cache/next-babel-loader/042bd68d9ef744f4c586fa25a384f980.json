{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport styled from 'styled-components';\nimport StarRoundedIcon from '@material-ui/icons/StarRounded';\nimport StarBorderRoundedIcon from '@material-ui/icons/StarBorderRounded';\nimport AddCircleOutlineIcon from '@material-ui/icons/AddCircleOutline';\nimport ShoppingCartIcon from '@material-ui/icons/ShoppingCart';\nimport React, { useEffect } from 'react';\nimport { dealImgUrl } from '../../tools/img';\nimport { Button, Card, IconButton } from '@material-ui/core';\nimport { dealMoney } from '../../tools/utils';\nimport { mpStyle } from '../../style/common';\nimport { modelFactory } from '../../ModelAction/modelUtil';\nimport { useStoreModel } from '../../ModelAction/useStore';\nimport { meModel } from '../../view/m/me/model';\nimport { doc } from '../../graphqlTypes/doc';\nimport { showMessage } from '../Message/Message';\nimport { ls } from '../../tools/dealKey';\nimport { grey } from '@material-ui/core/colors';\nimport { shopCartModel } from '../../view/m/cart';\nimport { useRouter } from 'next/router';\nimport { updateShopCartModel } from './UpdateShopCart';\nimport { Space } from '../Box/Box';\nexport var productModel = modelFactory('productModel', {}, {\n  updateNumShopCart: function () {\n    var _updateNumShopCart = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.mutate(doc.updateNumShopCart, _objectSpread({\n                shopCart: value\n              }, value.number ? {\n                updateNum: value.number\n              } : {}));\n\n            case 2:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function updateNumShopCart(_x, _x2) {\n      return _updateNumShopCart.apply(this, arguments);\n    }\n\n    return updateNumShopCart;\n  }(),\n  updateShopCart: function () {\n    var _updateShopCart = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value, option) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return option.mutate(doc.updateShopCart, {\n                shopCart: value\n              });\n\n            case 2:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function updateShopCart(_x3, _x4) {\n      return _updateShopCart.apply(this, arguments);\n    }\n\n    return updateShopCart;\n  }()\n});\nvar Box = styled(Card).withConfig({\n  displayName: \"ProductItem__Box\",\n  componentId: \"sc-1cef71f-0\"\n})([\"padding:10px 10px 0;> header{width:100%;height:40vw;> img{border-radius:8px;width:100%;height:40vw;}}> main{margin-top:10px;line-height:22px;\", \";}> footer{margin-top:4px;display:flex;align-items:center;> main{flex-grow:1;}> .MuiButtonBase-root{padding:5px;}}\"], mpStyle.ellipsis);\nexport var ProductPrice = function ProductPrice(_ref) {\n  var product = _ref.product,\n      priceOutTip = _ref.priceOutTip;\n  return __jsx(React.Fragment, null, __jsx(\"aside\", {\n    style: {\n      display: 'inline-block',\n      fontSize: '12px',\n      textDecoration: 'line-through',\n      flexShrink: 0\n    }\n  }, dealMoney(product === null || product === void 0 ? void 0 : product.priceMarket)), __jsx(\"main\", {\n    style: {\n      display: 'inline-block',\n      fontSize: '14px',\n      marginLeft: '6px',\n      color: mpStyle.red,\n      flexShrink: 0\n    }\n  }, priceOutTip !== null && priceOutTip !== void 0 ? priceOutTip : '', dealMoney(product === null || product === void 0 ? void 0 : product.priceOut)));\n};\nexport var ProductItem = function ProductItem(_ref2) {\n  var _product$img, _product$img$, _stateMe$user;\n\n  var product = _ref2.product;\n\n  var _useStoreModel = useStoreModel(updateShopCartModel),\n      actionsUpdateShopCartModel = _useStoreModel.actions;\n\n  var _useStoreModel2 = useStoreModel(shopCartModel),\n      actionsShopCart = _useStoreModel2.actions;\n\n  var _useStoreModel3 = useStoreModel(meModel),\n      stateMe = _useStoreModel3.state,\n      actionsMe = _useStoreModel3.actions;\n\n  useEffect(function () {\n    if (!stateMe.user.id) {\n      actionsMe.getLoginUser();\n    }\n  }, []);\n\n  var _useStoreModel4 = useStoreModel(productModel),\n      actionsPM = _useStoreModel4.actions;\n\n  return __jsx(Box, null, __jsx(\"header\", null, __jsx(\"img\", {\n    src: dealImgUrl(product === null || product === void 0 ? void 0 : (_product$img = product.img) === null || _product$img === void 0 ? void 0 : (_product$img$ = _product$img[0]) === null || _product$img$ === void 0 ? void 0 : _product$img$.url),\n    alt: \"\"\n  })), __jsx(\"main\", null, product.name, \" \", product.weight, product.unit, \" \", product.packingUnitString), __jsx(\"footer\", null, __jsx(ProductPrice, {\n    product: product\n  }), ((_stateMe$user = stateMe.user) === null || _stateMe$user === void 0 ? void 0 : _stateMe$user.id) && __jsx(IconButton, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var res, _yield$actionsPM$upda, _yield$actionsPM$upda2;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return actionsUpdateShopCartModel.openClick();\n\n            case 2:\n              res = _context3.sent;\n\n              if (!((res === null || res === void 0 ? void 0 : res.num) > 0)) {\n                _context3.next = 18;\n                break;\n              }\n\n              _context3.next = 6;\n              return actionsPM.updateNumShopCart({\n                product: product,\n                number: ~~(res === null || res === void 0 ? void 0 : res.num)\n              });\n\n            case 6:\n              _context3.t1 = _yield$actionsPM$upda = _context3.sent;\n              _context3.t0 = _context3.t1 === null;\n\n              if (_context3.t0) {\n                _context3.next = 10;\n                break;\n              }\n\n              _context3.t0 = _yield$actionsPM$upda === void 0;\n\n            case 10:\n              if (!_context3.t0) {\n                _context3.next = 14;\n                break;\n              }\n\n              _context3.t2 = void 0;\n              _context3.next = 15;\n              break;\n\n            case 14:\n              _context3.t2 = (_yield$actionsPM$upda2 = _yield$actionsPM$upda.updateNumShopCart) === null || _yield$actionsPM$upda2 === void 0 ? void 0 : _yield$actionsPM$upda2.id;\n\n            case 15:\n              if (!_context3.t2) {\n                _context3.next = 18;\n                break;\n              }\n\n              showMessage('操作成功');\n              actionsShopCart.getList();\n\n            case 18:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))\n  }, __jsx(ShoppingCartIcon, {\n    color: 'secondary'\n  }))));\n};\nvar RowBox = styled.div.withConfig({\n  displayName: \"ProductItem__RowBox\",\n  componentId: \"sc-1cef71f-1\"\n})([\"display:flex;padding:8px;box-shadow:\", \";border-radius:8px;margin-bottom:8px;\"], mpStyle.shadow['1']);\nvar Img = styled.div.withConfig({\n  displayName: \"ProductItem__Img\",\n  componentId: \"sc-1cef71f-2\"\n})([\"width:35vw;height:35vw;margin-right:8px;> img{width:35vw;height:35vw;}\"]);\nvar LeftBox = styled.div.withConfig({\n  displayName: \"ProductItem__LeftBox\",\n  componentId: \"sc-1cef71f-3\"\n})([\"display:flex;flex-direction:column;flex-grow:1;width:0;> main{line-height:22px;\", \";}\"], mpStyle.ellipsis);\nvar Tip = styled.div.withConfig({\n  displayName: \"ProductItem__Tip\",\n  componentId: \"sc-1cef71f-4\"\n})([\"margin-top:16px;border-radius:8px;padding:2px 6px;background:\", \";color:white;width:max-content;\"], grey[800]);\nvar Price = styled.div.withConfig({\n  displayName: \"ProductItem__Price\",\n  componentId: \"sc-1cef71f-5\"\n})([\"margin-top:16px;flex-grow:1;\"]);\nvar Bun = styled.div.withConfig({\n  displayName: \"ProductItem__Bun\",\n  componentId: \"sc-1cef71f-6\"\n})([\"&&&{.MuiButtonBase-root{padding:4px 0;}}\"]);\nexport var ProductItemOneRow = function ProductItemOneRow(_ref4) {\n  var _product$img2, _product$img2$, _stateMe$user2;\n\n  var product = _ref4.product,\n      _ref4$sumOrderTip = _ref4.sumOrderTip,\n      sumOrderTip = _ref4$sumOrderTip === void 0 ? '' : _ref4$sumOrderTip,\n      _ref4$hideAction = _ref4.hideAction,\n      hideAction = _ref4$hideAction === void 0 ? false : _ref4$hideAction,\n      _ref4$showSumOrder = _ref4.showSumOrder,\n      showSumOrder = _ref4$showSumOrder === void 0 ? false : _ref4$showSumOrder;\n\n  var _useStoreModel5 = useStoreModel(updateShopCartModel),\n      actionsUpdateShopCartModel = _useStoreModel5.actions;\n\n  var _useStoreModel6 = useStoreModel(meModel),\n      stateMe = _useStoreModel6.state,\n      actionsMe = _useStoreModel6.actions;\n\n  var _useStoreModel7 = useStoreModel(productModel),\n      actionsPM = _useStoreModel7.actions;\n\n  var _useStoreModel8 = useStoreModel(shopCartModel),\n      actionsShopCart = _useStoreModel8.actions;\n\n  useEffect(function () {\n    if (!stateMe.user.id) {\n      actionsMe.getLoginUser();\n    }\n  }, []);\n  return __jsx(RowBox, {\n    key: \"ProductItemOneRow_\".concat(product.id)\n  }, __jsx(Img, null, __jsx(\"img\", {\n    src: dealImgUrl(product === null || product === void 0 ? void 0 : (_product$img2 = product.img) === null || _product$img2 === void 0 ? void 0 : (_product$img2$ = _product$img2[0]) === null || _product$img2$ === void 0 ? void 0 : _product$img2$.url),\n    alt: \"\"\n  })), __jsx(LeftBox, null, __jsx(\"main\", null, product.name, \" \", product.weight, product.unit, \" \", product.packingUnitString), showSumOrder && __jsx(Tip, null, sumOrderTip, ls('销量'), \": \", product.sumOrder), __jsx(Price, null, __jsx(ProductPrice, {\n    product: product\n  })), !hideAction && ((_stateMe$user2 = stateMe.user) === null || _stateMe$user2 === void 0 ? void 0 : _stateMe$user2.id) && __jsx(Bun, null, __jsx(Button, {\n    fullWidth: true,\n    color: 'secondary',\n    variant: 'contained',\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var res, _yield$actionsPM$upda3, _yield$actionsPM$upda4;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return actionsUpdateShopCartModel.openClick();\n\n            case 2:\n              res = _context4.sent;\n\n              if (!((res === null || res === void 0 ? void 0 : res.num) > 0)) {\n                _context4.next = 18;\n                break;\n              }\n\n              _context4.next = 6;\n              return actionsPM.updateNumShopCart({\n                product: product,\n                number: ~~(res === null || res === void 0 ? void 0 : res.num)\n              });\n\n            case 6:\n              _context4.t1 = _yield$actionsPM$upda3 = _context4.sent;\n              _context4.t0 = _context4.t1 === null;\n\n              if (_context4.t0) {\n                _context4.next = 10;\n                break;\n              }\n\n              _context4.t0 = _yield$actionsPM$upda3 === void 0;\n\n            case 10:\n              if (!_context4.t0) {\n                _context4.next = 14;\n                break;\n              }\n\n              _context4.t2 = void 0;\n              _context4.next = 15;\n              break;\n\n            case 14:\n              _context4.t2 = (_yield$actionsPM$upda4 = _yield$actionsPM$upda3.updateNumShopCart) === null || _yield$actionsPM$upda4 === void 0 ? void 0 : _yield$actionsPM$upda4.id;\n\n            case 15:\n              if (!_context4.t2) {\n                _context4.next = 18;\n                break;\n              }\n\n              showMessage('操作成功');\n              actionsShopCart.getList();\n\n            case 18:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }))\n  }, __jsx(ShoppingCartIcon, null), ls('加入购物车')))));\n};\nvar GroupBox = styled.div.withConfig({\n  displayName: \"ProductItem__GroupBox\",\n  componentId: \"sc-1cef71f-7\"\n})([\"display:flex;\"]);\nvar GroupImg = styled.div.withConfig({\n  displayName: \"ProductItem__GroupImg\",\n  componentId: \"sc-1cef71f-8\"\n})([\"width:35vw;height:35vw;margin-right:16px;> img{width:35vw;height:35vw;border-radius:8px;}\"]);\nvar RightBox = styled.div.withConfig({\n  displayName: \"ProductItem__RightBox\",\n  componentId: \"sc-1cef71f-9\"\n})([\"display:flex;flex-grow:1;flex-direction:column;\"]);\nvar Title = styled.div.withConfig({\n  displayName: \"ProductItem__Title\",\n  componentId: \"sc-1cef71f-10\"\n})([\"font-weight:bold;display:flex;\"]);\nvar MarketPrice = styled.div.withConfig({\n  displayName: \"ProductItem__MarketPrice\",\n  componentId: \"sc-1cef71f-11\"\n})([\"margin-top:8px;color:\", \";> span{text-decoration:line-through;}\"], grey[700]);\nvar OutPrice = styled.div.withConfig({\n  displayName: \"ProductItem__OutPrice\",\n  componentId: \"sc-1cef71f-12\"\n})([\"margin-top:8px;color:\", \";\"], mpStyle.red);\nvar Star = styled.div.withConfig({\n  displayName: \"ProductItem__Star\",\n  componentId: \"sc-1cef71f-13\"\n})([\"flex-grow:1;\"]);\nvar Action = styled.div.withConfig({\n  displayName: \"ProductItem__Action\",\n  componentId: \"sc-1cef71f-14\"\n})([\"\"]);\nvar OrderTip = styled.div.withConfig({\n  displayName: \"ProductItem__OrderTip\",\n  componentId: \"sc-1cef71f-15\"\n})([\"margin-top:16px;border-radius:8px;padding:2px 6px;background:\", \";color:white;width:max-content;\"], grey[800]);\nexport var GroupProductItem = function GroupProductItem(_ref6) {\n  var _product$img3, _product$img3$;\n\n  var product = _ref6.product,\n      groupQueue = _ref6.groupQueue,\n      _ref6$sumOrderTip = _ref6.sumOrderTip,\n      sumOrderTip = _ref6$sumOrderTip === void 0 ? '' : _ref6$sumOrderTip,\n      _ref6$showSumOrder = _ref6.showSumOrder,\n      showSumOrder = _ref6$showSumOrder === void 0 ? false : _ref6$showSumOrder;\n\n  var _useStoreModel9 = useStoreModel(meModel),\n      stateMe = _useStoreModel9.state,\n      actionsMe = _useStoreModel9.actions;\n\n  var router = useRouter();\n  useEffect(function () {\n    if (!stateMe.user.id) {\n      actionsMe.getLoginUser();\n    }\n  }, []);\n  return __jsx(GroupBox, {\n    key: \"GroupBox_\".concat(product.id)\n  }, __jsx(GroupImg, null, __jsx(\"img\", {\n    src: dealImgUrl(product === null || product === void 0 ? void 0 : (_product$img3 = product.img) === null || _product$img3 === void 0 ? void 0 : (_product$img3$ = _product$img3[0]) === null || _product$img3$ === void 0 ? void 0 : _product$img3$.url),\n    alt: \"\"\n  })), __jsx(RightBox, null, __jsx(Title, null, product.name, \"(\", product.groupRemark, \"/\", product.groupAmount, product.groupAmountUnitString, \"/\", product.groupPrecisionString, \")\"), showSumOrder && __jsx(OrderTip, null, sumOrderTip, ls('拼团达人数'), \": \", product.sumOrder), __jsx(MarketPrice, null, ls('市场价'), __jsx(\"span\", null, dealMoney(product.priceMarket))), __jsx(OutPrice, null, ls('基准价格'), __jsx(\"span\", null, dealMoney(product.priceOut))), __jsx(Star, null, (groupQueue === null || groupQueue === void 0 ? void 0 : groupQueue.id) && __jsx(\"div\", null, __jsx(Space, {\n    h: 8\n  }), _toConsumableArray(Array(product.groupPrecision)).map(function (v, i) {\n    return i;\n  }).map(function (value) {\n    var _groupQueue$sumFillAm;\n\n    return value + 1 > ((_groupQueue$sumFillAm = groupQueue.sumFillAmount) !== null && _groupQueue$sumFillAm !== void 0 ? _groupQueue$sumFillAm : 0) ? __jsx(StarBorderRoundedIcon, {\n      key: \"clickStar\".concat(value),\n      fontSize: 'small',\n      style: {\n        color: grey[700]\n      }\n    }) : __jsx(StarRoundedIcon, {\n      key: \"clickStar\".concat(value),\n      style: {\n        color: '#FDD334'\n      },\n      fontSize: 'small'\n    });\n  }))), __jsx(Action, null, __jsx(Button, {\n    variant: 'contained',\n    color: 'secondary',\n    fullWidth: true,\n    onClick: function onClick() {\n      router.push(\"/m/groupProduct/[id]\", \"/m/groupProduct/\".concat(product.id));\n    }\n  }, __jsx(AddCircleOutlineIcon, null), ls('拼一个')))));\n};","map":null,"metadata":{},"sourceType":"module"}