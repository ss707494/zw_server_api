{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport { PcHeader } from '../pcComponents/header/header';\nimport { PcContentBox } from '../home/pcHome';\nimport { TopAction } from '../pcComponents/topAction/topAction';\nimport { HeaderTab } from '../home/components/headerTab';\nimport { Space } from '../../../components/Box/Box';\nimport styled from 'styled-components';\nimport { mpStyle } from '../../../style/common';\nimport { ll } from '../../../tools/dealKey';\nimport { Button } from '@material-ui/core';\nimport { shopCartModel } from '../../m/cart';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { getPickUpTypeName, PickUpTypeEnum } from '../../../ss_common/enum';\nimport { dealMaybeNumber, dealMoney, fpMerge } from '../../../tools/utils';\nimport { InputPromoCodeDialog, inputPromoCodeModel } from '../../m/cart/components/InputPromoCode';\nimport { CartProductTable } from './components/cartProductTable';\nimport { ProductItemBox } from '../pcComponents/productItemBox/productItemBox';\nimport { MainBox } from '../pcComponents/mainBox/mainBox';\nimport { useRouter } from 'next/router';\nvar Title = styled.div.withConfig({\n  displayName: \"cartPage__Title\",\n  componentId: \"sc-1bfnhon-0\"\n})([\"\", \";color:\", \";\"], mpStyle.fontType.l, mpStyle.red);\nvar PickUpType = styled.div.withConfig({\n  displayName: \"cartPage__PickUpType\",\n  componentId: \"sc-1bfnhon-1\"\n})([\"display:grid;grid-auto-flow:column;grid-auto-columns:max-content;align-items:center;> section{\", \"}\"], mpStyle.fontType.n);\nvar PromoCode = styled.div.withConfig({\n  displayName: \"cartPage__PromoCode\",\n  componentId: \"sc-1bfnhon-2\"\n})([\"> main{display:flex;> aside{display:flex;align-items:center;background:\", \";border-radius:\", \";padding-left:\", \";width:200px;}}\"], mpStyle.greyLite, mpStyle.spacePx.xxs, mpStyle.spacePx.xxs);\nvar ProductBox = styled.div.withConfig({\n  displayName: \"cartPage__ProductBox\",\n  componentId: \"sc-1bfnhon-3\"\n})([\"border:1px solid \", \";border-radius:4px;\"], mpStyle.greyLite);\nvar ProductHeader = styled.div.withConfig({\n  displayName: \"cartPage__ProductHeader\",\n  componentId: \"sc-1bfnhon-4\"\n})([\"\", \";padding:\", \";background:\", \";\"], mpStyle.fontType.n, mpStyle.spacePx.xs, mpStyle.greyLite);\nvar ProductFooter = styled.div.withConfig({\n  displayName: \"cartPage__ProductFooter\",\n  componentId: \"sc-1bfnhon-5\"\n})([\"background:\", \";display:flex;align-items:center;> section{flex-grow:1;}\"], mpStyle.greyLite);\nvar Money = styled.div.withConfig({\n  displayName: \"cartPage__Money\",\n  componentId: \"sc-1bfnhon-6\"\n})([\"\"]);\nvar NextBox = styled.div.withConfig({\n  displayName: \"cartPage__NextBox\",\n  componentId: \"sc-1bfnhon-7\"\n})([\"> header{\", \"}> main{height:160px;}\"], mpStyle.fontType.n);\n\nvar PickUpButton = function PickUpButton(_ref) {\n  var pickUpType = _ref.pickUpType;\n\n  var _useStoreModel = useStoreModel(shopCartModel),\n      actionsShopCartModel = _useStoreModel.actions,\n      stateShopCartModel = _useStoreModel.state;\n\n  var isActPickUpType = function isActPickUpType(type) {\n    return type === stateShopCartModel.form.pickUpType;\n  };\n\n  return __jsx(Button, {\n    variant: isActPickUpType(pickUpType) ? 'contained' : 'outlined',\n    color: isActPickUpType(pickUpType) ? 'secondary' : 'default',\n    onClick: function onClick() {\n      actionsShopCartModel.setForm(['pickUpType', pickUpType]);\n      actionsShopCartModel.setForm(['addressId', stateShopCartModel.initAddressId(fpMerge(stateShopCartModel, {\n        form: {\n          pickUpType: pickUpType\n        }\n      }))]);\n    }\n  }, ll(getPickUpTypeName(pickUpType)));\n};\n\nexport var CartPage = function CartPage() {\n  var router = useRouter();\n\n  var _useStoreModel2 = useStoreModel(shopCartModel),\n      actionsShopCartModel = _useStoreModel2.actions,\n      stateShopCartModel = _useStoreModel2.state;\n\n  var _useStoreModel3 = useStoreModel(inputPromoCodeModel),\n      actionsInputPromoCodeModel = _useStoreModel3.actions;\n\n  useEffect(function () {\n    if (stateShopCartModel.shopCartList.length === 0) {\n      actionsShopCartModel.getList();\n    }\n  }, []);\n  useEffect(function () {\n    if (stateShopCartModel.user.id && localStorage.getItem(\"promoCode_\".concat(stateShopCartModel.user.id))) {\n      actionsShopCartModel.dealPromoCode(\"\".concat(localStorage.getItem(\"promoCode_\".concat(stateShopCartModel.user.id))));\n    }\n  }, [stateShopCartModel.user.id]);\n  var productNumber = stateShopCartModel.dealProductNumber(stateShopCartModel);\n  var allTotal = stateShopCartModel.dealProductTotal(stateShopCartModel) - dealMaybeNumber(stateShopCartModel.form.couponDiscount);\n  var productSubtotal = dealMoney(stateShopCartModel.dealProductTotal(stateShopCartModel));\n  return __jsx(MainBox, null, __jsx(PcHeader, null), __jsx(PcContentBox, null, __jsx(TopAction, null), __jsx(HeaderTab, null), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(Title, null, ll('我的购物车')), __jsx(Space, {\n    h: mpStyle.space.xs\n  }), __jsx(PickUpType, null, __jsx(\"section\", null, ll('送货方式')), __jsx(Space, {\n    w: mpStyle.space.s\n  }), __jsx(PickUpButton, {\n    pickUpType: PickUpTypeEnum.Self\n  }), __jsx(Space, {\n    w: mpStyle.space.xs\n  }), __jsx(PickUpButton, {\n    pickUpType: PickUpTypeEnum.Delivery\n  })), __jsx(Space, {\n    h: mpStyle.space.xs\n  }), __jsx(PromoCode, null, __jsx(\"header\", null, ll('达人卡和优惠券')), __jsx(Space, {\n    h: mpStyle.space.xxs\n  }), __jsx(\"main\", null, __jsx(\"aside\", null, stateShopCartModel.promoCode.code), __jsx(Space, {\n    w: mpStyle.space.xxs\n  }), __jsx(Button, {\n    variant: 'outlined',\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return actionsInputPromoCodeModel.openClick(function (promoCode) {\n                return actionsShopCartModel.dealPromoCode(promoCode);\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))\n  }, ll(stateShopCartModel.promoCode.code ? '重新输入' : '输入验证码'))), __jsx(InputPromoCodeDialog, null)), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(ProductBox, null, __jsx(ProductHeader, null, productNumber, ll('件商品')), __jsx(CartProductTable, null), __jsx(ProductFooter, null, __jsx(\"section\", {\n    style: {\n      flexGrow: 1\n    }\n  }), __jsx(Money, null, __jsx(\"aside\", null, ll('小计')), __jsx(\"main\", null, productSubtotal)), __jsx(Space, {\n    w: mpStyle.space.s\n  }), __jsx(Money, null, __jsx(\"aside\", null, ll('折扣')), __jsx(\"main\", null, dealMoney(stateShopCartModel.form.couponDiscount))), __jsx(Space, {\n    w: mpStyle.space.s\n  }), __jsx(Money, null, __jsx(\"aside\", null, ll('总计')), __jsx(\"main\", null, dealMoney(allTotal))), __jsx(Space, {\n    w: mpStyle.space.s\n  }), __jsx(Button, {\n    style: {\n      height: mpStyle.spacePx.xxl\n    },\n    variant: 'contained',\n    color: 'secondary',\n    onClick: function onClick() {\n      router.push('/pc/cart/orderPage');\n    }\n  }, ll('去结算')))), __jsx(NextBox, null, __jsx(Space, {\n    h: mpStyle.space.n\n  }), __jsx(\"header\", null, ll('下次购买的商品')), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(\"main\", null, stateShopCartModel.shopCartListNext.map(function (shopCart) {\n    var _shopCart$product;\n\n    return __jsx(ProductItemBox, {\n      key: \"stateShopCartModel.shopCartListNext\".concat((_shopCart$product = shopCart.product) === null || _shopCart$product === void 0 ? void 0 : _shopCart$product.id),\n      product: shopCart.product || {},\n      width: 240\n    });\n  }))), __jsx(Space, {\n    h: mpStyle.space.xxl\n  })));\n};","map":null,"metadata":{},"sourceType":"module"}