{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport { HeaderTitle } from '../../../../components/HeaderTitle/HeaderTitle';\nimport { BScroller } from '../../../../components/BScroll/BScroller';\nimport styled from 'styled-components';\nimport { modelFactory } from '../../../../ModelAction/modelUtil';\nimport { doc } from '../../../../graphqlTypes/doc';\nimport { dealMoney, formatDate, fpMergePre, getLastNumber } from '../../../../tools/utils';\nimport { useStoreModel } from '../../../../ModelAction/useStore';\nimport { useRouter } from 'next/router';\nimport { ll } from '../../../../tools/dealKey';\nimport { orderStateToString, PickUpTypeEnum } from '../../../../ss_common/enum';\nimport { mpStyle } from '../../../../style/common';\nimport { grey } from '@material-ui/core/colors';\nimport { dealImgUrl } from '../../../../tools/img';\nimport { Space } from '../../../../components/Box/Box';\nexport const orderDetailModel = modelFactory('orderDetail', {\n  orderInfo: {},\n  selfAddress: []\n}, {\n  getDetail: async (value, option) => {\n    var _res$selfAddress, _res$selfAddress$valu;\n\n    const res = await option.query(doc.orderDetail, {\n      id: value\n    });\n    option.setData(fpMergePre({\n      orderInfo: (res === null || res === void 0 ? void 0 : res.orderDetail) || {},\n      selfAddress: (res === null || res === void 0 ? void 0 : (_res$selfAddress = res.selfAddress) === null || _res$selfAddress === void 0 ? void 0 : (_res$selfAddress$valu = _res$selfAddress.value) === null || _res$selfAddress$valu === void 0 ? void 0 : _res$selfAddress$valu.list) || []\n    }));\n  },\n  updateOrder: async (value, option) => {\n    return await option.mutate(doc.updateOrder, {\n      orderInfoItemInput: value\n    });\n  }\n});\nconst Box = styled.div.withConfig({\n  displayName: \"orderDetail__Box\",\n  componentId: \"sc-11dm5lg-0\"\n})([\"padding:0 20px;\"]);\nconst Top = styled.div.withConfig({\n  displayName: \"orderDetail__Top\",\n  componentId: \"sc-11dm5lg-1\"\n})([\"margin-top:10px;font-size:18px;display:flex;> aside{margin-left:20px;color:\", \";}\"], mpStyle.red);\nconst InfoLabel = styled.div.withConfig({\n  displayName: \"orderDetail__InfoLabel\",\n  componentId: \"sc-11dm5lg-2\"\n})([\"display:flex;margin-top:16px;> section{> *{margin-bottom:4px;}}> aside{color:\", \";width:80px;}\"], grey[600]);\nconst GreyPart = styled.div.withConfig({\n  displayName: \"orderDetail__GreyPart\",\n  componentId: \"sc-11dm5lg-3\"\n})([\"margin-top:12px;position:relative;left:-20px;width:100vw;height:12px;background:\", \";\"], grey[200]);\nexport const ProductBox = styled.div.withConfig({\n  displayName: \"orderDetail__ProductBox\",\n  componentId: \"sc-11dm5lg-4\"\n})([\"display:grid;padding-top:4vw;margin-bottom:10px;grid-template-columns:min-content 1fr 20vw;> img{grid-area:1/1/4/2;width:20vw;height:20vw;margin-right:14px;}> section{grid-area:1/2/2/4;font-size:20px;> span{font-size:16px;color:\", \";}}> main{padding:10px 0;grid-area:2/2/3/4;font-size:14px;color:\", \";}> footer{display:flex;> aside{text-decoration:line-through;}> span{margin-left:5px;color:\", \";font-size:17px;}}> aside{justify-self:end;> button{border-radius:10px;padding:2px 14px;}}\"], mpStyle.grey, grey[500], mpStyle.red);\nconst Sum = styled.div.withConfig({\n  displayName: \"orderDetail__Sum\",\n  componentId: \"sc-11dm5lg-5\"\n})([\"display:flex;justify-content:space-between;margin-bottom:12px;\"]);\nexport const OrderDetail = () => {\n  var _orderInfo$userAddres, _orderInfo$userAddres2, _orderInfo$userAddres3, _orderInfo$userAddres4, _orderInfo$userAddres5, _orderInfo$userPayCar, _orderInfo$userPayCar2, _orderInfo$rOrderProd;\n\n  const router = useRouter();\n  const {\n    state: stateOrderDetailModel,\n    actions: actionsOrderDetailModel\n  } = useStoreModel(orderDetailModel);\n  const orderInfo = stateOrderDetailModel.orderInfo;\n  useEffect(() => {\n    var _stateOrderDetailMode;\n\n    if (router.query.id && !((_stateOrderDetailMode = stateOrderDetailModel.orderInfo) === null || _stateOrderDetailMode === void 0 ? void 0 : _stateOrderDetailMode.id)) {\n      var _router$query;\n\n      actionsOrderDetailModel.getDetail(`${(_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id}`);\n    }\n  }, [router.query.id, stateOrderDetailModel.orderInfo]);\n  return __jsx(\"div\", null, __jsx(HeaderTitle, {\n    title: '订单详情'\n  }), !(orderInfo === null || orderInfo === void 0 ? void 0 : orderInfo.id) ? __jsx(\"div\", null) : __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 60px)'\n  }, __jsx(Box, null, __jsx(Space, {\n    h: 16\n  }), __jsx(Top, null, __jsx(\"section\", null, formatDate(orderInfo.createTime, 'YYYY/MM/dd')), __jsx(\"aside\", null, orderStateToString(orderInfo === null || orderInfo === void 0 ? void 0 : orderInfo.state))), __jsx(InfoLabel, null, __jsx(\"aside\", null, ll('订单编号'), \" :\"), __jsx(\"section\", null, orderInfo.number)), __jsx(InfoLabel, null, __jsx(\"aside\", null, ll('送货地址'), \" :\"), __jsx(\"section\", null, orderInfo.pickUpType === PickUpTypeEnum.Self && (v => __jsx(React.Fragment, null, __jsx(\"main\", null, v.fullName), __jsx(\"header\", null, v.streetAddress), __jsx(\"footer\", null, v.city, \" \", v.province, \" \", v.zip)))(stateOrderDetailModel.selfAddress.find(v => v.id === orderInfo.selfAddressId)) || __jsx(React.Fragment, null, __jsx(\"main\", null, (_orderInfo$userAddres = orderInfo.userAddress) === null || _orderInfo$userAddres === void 0 ? void 0 : _orderInfo$userAddres.name), __jsx(\"header\", null, (_orderInfo$userAddres2 = orderInfo.userAddress) === null || _orderInfo$userAddres2 === void 0 ? void 0 : _orderInfo$userAddres2.address), __jsx(\"footer\", null, (_orderInfo$userAddres3 = orderInfo.userAddress) === null || _orderInfo$userAddres3 === void 0 ? void 0 : _orderInfo$userAddres3.city, \" \", (_orderInfo$userAddres4 = orderInfo.userAddress) === null || _orderInfo$userAddres4 === void 0 ? void 0 : _orderInfo$userAddres4.province, \" \", (_orderInfo$userAddres5 = orderInfo.userAddress) === null || _orderInfo$userAddres5 === void 0 ? void 0 : _orderInfo$userAddres5.zip)))), __jsx(InfoLabel, null, __jsx(\"aside\", null, ll('支付方式'), \" :\"), __jsx(\"section\", null, __jsx(\"footer\", null, ll('卡号后四位'), \" \", getLastNumber(`${(_orderInfo$userPayCar = orderInfo.userPayCard) === null || _orderInfo$userPayCar === void 0 ? void 0 : _orderInfo$userPayCar.number}`)), __jsx(\"footer\", null, ll('持卡人'), \" \", orderInfo === null || orderInfo === void 0 ? void 0 : (_orderInfo$userPayCar2 = orderInfo.userPayCard) === null || _orderInfo$userPayCar2 === void 0 ? void 0 : _orderInfo$userPayCar2.userName))), __jsx(GreyPart, null), (_orderInfo$rOrderProd = orderInfo.rOrderProduct) === null || _orderInfo$rOrderProd === void 0 ? void 0 : _orderInfo$rOrderProd.map(rOrderProduct => {\n    var _rOrderProduct$produc, _rOrderProduct$produc2, _rOrderProduct$produc3, _rOrderProduct$produc4, _rOrderProduct$produc5, _rOrderProduct$produc6, _rOrderProduct$produc7, _rOrderProduct$produc8, _rOrderProduct$produc9, _rOrderProduct$produc10;\n\n    return __jsx(ProductBox, {\n      key: `ProductBox_${rOrderProduct.id}`\n    }, __jsx(\"img\", {\n      src: dealImgUrl((_rOrderProduct$produc = rOrderProduct.product) === null || _rOrderProduct$produc === void 0 ? void 0 : (_rOrderProduct$produc2 = _rOrderProduct$produc.img) === null || _rOrderProduct$produc2 === void 0 ? void 0 : (_rOrderProduct$produc3 = _rOrderProduct$produc2[0]) === null || _rOrderProduct$produc3 === void 0 ? void 0 : _rOrderProduct$produc3.url),\n      alt: \"\"\n    }), __jsx(\"section\", null, (_rOrderProduct$produc4 = rOrderProduct.product) === null || _rOrderProduct$produc4 === void 0 ? void 0 : _rOrderProduct$produc4.name, __jsx(Space, {\n      w: mpStyle.space.xxs\n    })), __jsx(\"main\", null, (_rOrderProduct$produc5 = rOrderProduct.product) === null || _rOrderProduct$produc5 === void 0 ? void 0 : _rOrderProduct$produc5.remark), __jsx(\"footer\", null, __jsx(\"aside\", null, dealMoney((_rOrderProduct$produc6 = rOrderProduct.product) === null || _rOrderProduct$produc6 === void 0 ? void 0 : _rOrderProduct$produc6.priceMarket)), __jsx(\"span\", null, dealMoney((_rOrderProduct$produc7 = rOrderProduct.product) === null || _rOrderProduct$produc7 === void 0 ? void 0 : _rOrderProduct$produc7.priceOut), \"/\", (_rOrderProduct$produc8 = (_rOrderProduct$produc9 = rOrderProduct.product) === null || _rOrderProduct$produc9 === void 0 ? void 0 : _rOrderProduct$produc9.packingUnitString) !== null && _rOrderProduct$produc8 !== void 0 ? _rOrderProduct$produc8 : ll('件'))), __jsx(\"aside\", null, __jsx(\"span\", null, \"x \", (_rOrderProduct$produc10 = rOrderProduct.product) === null || _rOrderProduct$produc10 === void 0 ? void 0 : _rOrderProduct$produc10.number)));\n  }), __jsx(\"div\", {\n    style: {\n      height: '26px',\n      width: '100%'\n    }\n  }), __jsx(Sum, null, __jsx(\"aside\", null, ll('小计')), __jsx(\"main\", null, dealMoney(orderInfo.subtotal))), __jsx(Sum, null, __jsx(\"aside\", null, ll('优惠券折扣')), __jsx(\"main\", null, dealMoney(0, '-'))), __jsx(Sum, null, __jsx(\"aside\", null, ll('运费')), __jsx(\"main\", null, dealMoney(orderInfo.transportationCosts))), __jsx(Sum, null, __jsx(\"aside\", null, ll('达人币抵扣')), __jsx(\"main\", null, dealMoney(orderInfo.deductCoin, '-'))), __jsx(Sum, null, __jsx(\"aside\", null, ll('实际支付')), __jsx(\"main\", null, dealMoney(orderInfo.actuallyPaid))), __jsx(Sum, null, __jsx(\"aside\", null, ll('获得达人币')), __jsx(\"main\", null, dealMoney(orderInfo.generateCoin))), __jsx(\"div\", {\n    style: {\n      height: '96px',\n      width: '100%'\n    }\n  }))));\n};","map":null,"metadata":{},"sourceType":"module"}