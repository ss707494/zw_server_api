{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\code\\\\zw\\\\zw_client_web\\\\utils\\\\view\\\\m\\\\category\\\\[id].tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport Router, { useRouter } from 'next/router';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { KeyboardArrowRight } from '@material-ui/icons';\nimport { Breadcrumbs, ButtonBase, LinearProgress, Link, Typography } from '@material-ui/core';\nimport { dealUrlQuery, fpMergePre } from '../../../tools/utils';\nimport { HeaderTitle } from '../../../components/HeaderTitle/HeaderTitle';\nimport { doc } from '../../../graphqlTypes/doc';\nimport { BScroller } from '../../../components/BScroll/BScroller';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport styled from 'styled-components';\nimport { grey } from '@material-ui/core/colors';\nimport { dealImgUrl } from '../../../tools/img';\nimport { GroupProductItem, ProductItem } from '../../../components/ProductItem/ProductItem';\nimport { ll } from '../../../tools/dealKey';\nimport { NoData } from '../../../components/NoData/NoData';\nimport { CategoryRootName } from '../../../ss_common/enum';\nimport { UpdateShopCart } from '../../../components/ProductItem/UpdateShopCart';\nimport { HomeType } from '../home/appModule';\nimport { homeTabsModel } from '../home/components/Tabs/Tabs';\nexport var CategoryPageModel = modelFactory('CategoryPage', {\n  productList: [],\n  categoryList: [],\n  actCatId: ''\n}, {\n  getProductList: function () {\n    var _getProductList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var _res$productsInCatego, _res$productsInCatego2, _res$categoryList$lis, _res$categoryList;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.productsInCategory, {\n                data: value.categoryItemInput,\n                productItemInput: value.productItemInput\n              });\n\n            case 2:\n              res = _context.sent;\n              option.setData(fpMergePre({\n                productList: (_res$productsInCatego = res === null || res === void 0 ? void 0 : (_res$productsInCatego2 = res.productsInCategory) === null || _res$productsInCatego2 === void 0 ? void 0 : _res$productsInCatego2.list) !== null && _res$productsInCatego !== void 0 ? _res$productsInCatego : [],\n                categoryList: _toConsumableArray((_res$categoryList$lis = res === null || res === void 0 ? void 0 : (_res$categoryList = res.categoryList) === null || _res$categoryList === void 0 ? void 0 : _res$categoryList.list) !== null && _res$categoryList$lis !== void 0 ? _res$categoryList$lis : [])\n              }));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getProductList(_x, _x2) {\n      return _getProductList.apply(this, arguments);\n    }\n\n    return getProductList;\n  }(),\n  changeActCatId: function () {\n    var _changeActCatId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value, option) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              option.setData(fpMergePre({\n                actCatId: value !== null && value !== void 0 ? value : ''\n              }));\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function changeActCatId(_x3, _x4) {\n      return _changeActCatId.apply(this, arguments);\n    }\n\n    return changeActCatId;\n  }()\n});\nvar Box = styled('div').withConfig({\n  displayName: \"id__Box\",\n  componentId: \"qp4xb8-0\"\n})([\"padding:18px 20px 0;> header{font-size:18px;font-weight:bold;margin:10px 0;}\"]);\n_c = Box;\nvar CategoryItemStyle = styled(ButtonBase).withConfig({\n  displayName: \"id__CategoryItemStyle\",\n  componentId: \"qp4xb8-1\"\n})([\"&&&{width:100%;height:60px;display:flex;border-radius:8px;overflow:hidden;margin-bottom:10px;background:\", \";> img{height:100%;width:70%;}> span{flex:1;color:#fff;display:flex;align-items:center;justify-content:center;}}\"], grey[700]);\n_c2 = CategoryItemStyle;\nexport var categoryItemModel = modelFactory('categoryItemModel', {\n  test: '',\n  category: {}\n}, {\n  calcCatLevel: function calcCatLevel(value, option) {\n    var _option$data;\n\n    var dealLevel = function dealLevel(obj) {\n      var _obj$parentCategory;\n\n      var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n      if (!(obj === null || obj === void 0 ? void 0 : obj.parentCategory) || (obj === null || obj === void 0 ? void 0 : (_obj$parentCategory = obj.parentCategory) === null || _obj$parentCategory === void 0 ? void 0 : _obj$parentCategory.id) === CategoryRootName) return level;\n      return dealLevel(obj === null || obj === void 0 ? void 0 : obj.parentCategory, level + 1);\n    };\n\n    return dealLevel((_option$data = option.data) === null || _option$data === void 0 ? void 0 : _option$data.category);\n  },\n  getLevel: function () {\n    var _getLevel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value, option) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return option.query(doc.categoryLevel, {\n                data: value\n              });\n\n            case 2:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function getLevel(_x5, _x6) {\n      return _getLevel.apply(this, arguments);\n    }\n\n    return getLevel;\n  }(),\n  getCategory: function () {\n    var _getCategory = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(value, option) {\n      var _res$categoryRootPare;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return option.query(doc.categoryRootParent, {\n                categoryItemInput: value\n              });\n\n            case 2:\n              res = _context4.sent;\n              option.setData(fpMergePre({\n                category: (_res$categoryRootPare = res === null || res === void 0 ? void 0 : res.categoryRootParent) !== null && _res$categoryRootPare !== void 0 ? _res$categoryRootPare : {}\n              }));\n              return _context4.abrupt(\"return\", res === null || res === void 0 ? void 0 : res.categoryRootParent);\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    function getCategory(_x7, _x8) {\n      return _getCategory.apply(this, arguments);\n    }\n\n    return getCategory;\n  }()\n});\nvar ListBox = styled.div.withConfig({\n  displayName: \"id__ListBox\",\n  componentId: \"qp4xb8-2\"\n})([\"display:grid;grid-template-columns:repeat(\", \",1fr);grid-gap:16px;\"], function (props) {\n  return props.columns || 2;\n});\n_c3 = ListBox;\nexport var CategoryPage = function CategoryPage() {\n  _s();\n\n  var _ref, _router$query, _stateCategoryItemMod, _stateCategoryItemMod2, _stateCategoryItemMod3;\n\n  var router = useRouter();\n  var id = (_ref = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id) !== null && _ref !== void 0 ? _ref : '';\n\n  var _useStoreModel = useStoreModel(CategoryPageModel),\n      stateCPM = _useStoreModel.state,\n      actionsCPM = _useStoreModel.actions,\n      getLoad = _useStoreModel.getLoad;\n\n  var _useStoreModel2 = useStoreModel(categoryItemModel),\n      actionsCI = _useStoreModel2.actions,\n      stateCategoryItemModel = _useStoreModel2.state;\n\n  var _useStoreModel3 = useStoreModel(homeTabsModel),\n      stateHomeTabs = _useStoreModel3.state,\n      actionsHomeTabs = _useStoreModel3.actions;\n\n  useEffect(function () {\n    var _ref2;\n\n    actionsHomeTabs.setHomeType((_ref2 = router.query.homeType) !== null && _ref2 !== void 0 ? _ref2 : HomeType.home);\n  }, [actionsHomeTabs, router.query.homeType]);\n\n  var CategoryItem = function CategoryItem(v) {\n    return __jsx(CategoryItemStyle, {\n      key: \"CategoryItem_\".concat(v.id),\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var _yield$actionsCI$getL;\n\n        var _query;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _query = dealUrlQuery({\n                  homeType: router.query.homeType\n                });\n                _context5.next = 3;\n                return actionsCI.getLevel({\n                  id: v.id\n                });\n\n              case 3:\n                _context5.t1 = _yield$actionsCI$getL = _context5.sent;\n                _context5.t0 = _context5.t1 === null;\n\n                if (_context5.t0) {\n                  _context5.next = 7;\n                  break;\n                }\n\n                _context5.t0 = _yield$actionsCI$getL === void 0;\n\n              case 7:\n                if (!_context5.t0) {\n                  _context5.next = 11;\n                  break;\n                }\n\n                _context5.t2 = void 0;\n                _context5.next = 12;\n                break;\n\n              case 11:\n                _context5.t2 = _yield$actionsCI$getL.categoryLevel;\n\n              case 12:\n                _context5.t3 = _context5.t2;\n\n                if (!(_context5.t3 === 3)) {\n                  _context5.next = 18;\n                  break;\n                }\n\n                _context5.next = 16;\n                return Router.push(\"/m/productList/[id]\".concat(_query), \"/m/productList/\".concat(v.id).concat(_query));\n\n              case 16:\n                _context5.next = 20;\n                break;\n\n              case 18:\n                _context5.next = 20;\n                return Router.push(\"/m/category/[id]\".concat(_query), \"/m/category/\".concat(v.id).concat(_query));\n\n              case 20:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      })),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 12\n      }\n    }, __jsx(\"img\", {\n      src: dealImgUrl(v.imgUrl),\n      alt: \"\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 7\n      }\n    }), __jsx(\"span\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 7\n      }\n    }, v.name, __jsx(KeyboardArrowRight, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 21\n      }\n    })));\n  };\n\n  useEffect(function () {\n    if (id) {\n      actionsCPM.getProductList({\n        categoryItemInput: {\n          id: id\n        },\n        productItemInput: {\n          isGroup: router.query.homeType === HomeType.group ? 1 : 0\n        }\n      });\n      actionsCI.getCategory({\n        id: id\n      });\n    }\n  }, [actionsCI, actionsCPM, id, router.query.homeType]);\n  return __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 10\n    }\n  }, __jsx(HeaderTitle, {\n    title: '',\n    showCart: router.query.homeType === HomeType.home,\n    showSearch: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }\n  }), !!getLoad(doc.productsInCategory) && __jsx(LinearProgress, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 43\n    }\n  }), __jsx(Breadcrumbs, {\n    style: {\n      margin: '8px 0 0 8px'\n    },\n    separator: \"\\u203A\",\n    \"aria-label\": \"breadcrumb\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 5\n    }\n  }, [(_stateCategoryItemMod = stateCategoryItemModel.category) === null || _stateCategoryItemMod === void 0 ? void 0 : (_stateCategoryItemMod2 = _stateCategoryItemMod.parentCategory) === null || _stateCategoryItemMod2 === void 0 ? void 0 : _stateCategoryItemMod2.parentCategory, (_stateCategoryItemMod3 = stateCategoryItemModel.category) === null || _stateCategoryItemMod3 === void 0 ? void 0 : _stateCategoryItemMod3.parentCategory].filter(function (v) {\n    return !!(v === null || v === void 0 ? void 0 : v.name) && (v === null || v === void 0 ? void 0 : v.name) !== CategoryRootName;\n  }).map(function (e) {\n    return __jsx(Link, {\n      key: \"Breadcrumbs\".concat(e === null || e === void 0 ? void 0 : e.id),\n      color: \"inherit\",\n      href: \"#\",\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var _query;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _query = dealUrlQuery({\n                  homeType: router.query.homeType\n                });\n                _context6.next = 3;\n                return Router.push(\"/m/category/[id]\".concat(_query), \"/m/category/\".concat(e === null || e === void 0 ? void 0 : e.id).concat(_query));\n\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      })),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 11\n      }\n    }, e === null || e === void 0 ? void 0 : e.name);\n  }), __jsx(Typography, {\n    color: \"textPrimary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, stateCategoryItemModel.category.name)), __jsx(BScroller, {\n    boxHeight: 'calc(100vh - 60px)',\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 5\n    }\n  }, __jsx(Box, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }\n  }, stateCPM.categoryList.length === 0 && stateCPM.productList.length === 0 && __jsx(NoData, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 88\n    }\n  }) || __jsx(React.Fragment, null, stateCPM.categoryList.map(function (value) {\n    return CategoryItem(value);\n  }), __jsx(\"header\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 15\n    }\n  }, ll('热门推荐')), stateCPM.productList.length === 0 && __jsx(NoData, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 55\n    }\n  }), __jsx(ListBox, {\n    columns: stateHomeTabs.homeType === HomeType.group ? 1 : 2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 15\n    }\n  }, stateCPM.productList.map(function (value) {\n    return stateHomeTabs.homeType === HomeType.group && __jsx(GroupProductItem, {\n      product: value,\n      key: \"ProductItem_\".concat(value.id),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 98\n      }\n    }) || __jsx(ProductItem, {\n      key: \"ProductItem_\".concat(value.id),\n      product: value,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 24\n      }\n    });\n  }))))), __jsx(UpdateShopCart, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 5\n    }\n  }));\n};\n\n_s(CategoryPage, \"oVKc5jraOYzYdSlgLpmAF2fkhYA=\", false, function () {\n  return [useRouter, useStoreModel, useStoreModel, useStoreModel];\n});\n\n_c4 = CategoryPage;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Box\");\n$RefreshReg$(_c2, \"CategoryItemStyle\");\n$RefreshReg$(_c3, \"ListBox\");\n$RefreshReg$(_c4, \"CategoryPage\");","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/m/category/[id].tsx"],"names":["React","useEffect","Router","useRouter","useStoreModel","KeyboardArrowRight","Breadcrumbs","ButtonBase","LinearProgress","Link","Typography","dealUrlQuery","fpMergePre","HeaderTitle","doc","BScroller","modelFactory","styled","grey","dealImgUrl","GroupProductItem","ProductItem","ll","NoData","CategoryRootName","UpdateShopCart","HomeType","homeTabsModel","CategoryPageModel","productList","categoryList","actCatId","getProductList","value","option","query","productsInCategory","data","categoryItemInput","productItemInput","res","setData","list","changeActCatId","Box","CategoryItemStyle","categoryItemModel","test","category","calcCatLevel","dealLevel","obj","level","parentCategory","id","getLevel","categoryLevel","getCategory","categoryRootParent","ListBox","div","props","columns","CategoryPage","router","stateCPM","state","actionsCPM","actions","getLoad","actionsCI","stateCategoryItemModel","stateHomeTabs","actionsHomeTabs","setHomeType","homeType","home","CategoryItem","v","_query","push","imgUrl","name","isGroup","group","margin","filter","map","e","length"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport Router, {useRouter} from 'next/router'\r\nimport {useStoreModel} from '../../../ModelAction/useStore'\r\nimport {Category, CategoryItemInput, Maybe, Product, ProductItemInput} from '../../../graphqlTypes/types'\r\nimport {KeyboardArrowRight} from '@material-ui/icons'\r\nimport {Breadcrumbs, ButtonBase, LinearProgress, Link, Typography} from '@material-ui/core'\r\nimport {dealUrlQuery, fpMergePre} from '../../../tools/utils'\r\nimport {HeaderTitle} from '../../../components/HeaderTitle/HeaderTitle'\r\nimport {doc} from '../../../graphqlTypes/doc'\r\nimport {BScroller} from '../../../components/BScroll/BScroller'\r\nimport {modelFactory} from '../../../ModelAction/modelUtil'\r\nimport styled from 'styled-components'\r\nimport {grey} from '@material-ui/core/colors'\r\nimport {dealImgUrl} from '../../../tools/img'\r\nimport {GroupProductItem, ProductItem} from '../../../components/ProductItem/ProductItem'\r\nimport {ll} from '../../../tools/dealKey'\r\nimport {NoData} from '../../../components/NoData/NoData'\r\nimport {CategoryRootName} from '../../../ss_common/enum'\r\nimport {UpdateShopCart} from '../../../components/ProductItem/UpdateShopCart'\r\nimport {HomeType} from '../home/appModule'\r\nimport {homeTabsModel} from '../home/components/Tabs/Tabs'\r\n\r\nexport const CategoryPageModel = modelFactory('CategoryPage', {\r\n  productList: [] as Product[],\r\n  categoryList: [] as Category[],\r\n  actCatId: '',\r\n}, {\r\n  getProductList: async (value: {\r\n    categoryItemInput?: CategoryItemInput,\r\n    productItemInput?: ProductItemInput,\r\n  }, option) => {\r\n    const res = await option.query(doc.productsInCategory, {\r\n      data: value.categoryItemInput,\r\n      productItemInput: value.productItemInput,\r\n    })\r\n    option.setData(fpMergePre({\r\n      productList: res?.productsInCategory?.list ?? [],\r\n      categoryList: [\r\n        ...res?.categoryList?.list ?? [],\r\n      ],\r\n    }))\r\n  },\r\n  changeActCatId: async (value: Maybe<string>, option) => {\r\n    option.setData(fpMergePre({\r\n      actCatId: value ?? '',\r\n    }))\r\n  },\r\n})\r\n\r\nconst Box = styled('div')`\r\n  padding: 18px 20px 0;\r\n  > header {\r\n    font-size: 18px;\r\n    font-weight: bold;\r\n    margin: 10px 0;\r\n  }\r\n`\r\n\r\nconst CategoryItemStyle = styled(ButtonBase)`\r\n  &&& {\r\n    width: 100%;\r\n    height: 60px;\r\n    display: flex;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n    margin-bottom: 10px;\r\n    background: ${grey[700]};\r\n    > img {\r\n      height: 100%;\r\n      width: 70%;\r\n    }\r\n    > span {\r\n      flex: 1;\r\n      color: #fff;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n  }\r\n`\r\n\r\nexport const categoryItemModel = modelFactory('categoryItemModel', {\r\n  test: '',\r\n  category: {} as Category,\r\n}, {\r\n  calcCatLevel: (value, option) => {\r\n    const dealLevel: (obj: Maybe<Category>, level?: number) => number = (obj, level = 1) => {\r\n      if (!obj?.parentCategory || obj?.parentCategory?.id === CategoryRootName) return level\r\n      return dealLevel(obj?.parentCategory, level + 1)\r\n    }\r\n    return dealLevel(option.data?.category)\r\n  },\r\n  getLevel: async (value: CategoryItemInput, option) => {\r\n    return await option.query(doc.categoryLevel, {\r\n      data: value,\r\n    })\r\n  },\r\n  getCategory: async (value: CategoryItemInput, option) => {\r\n    const res = await option.query(doc.categoryRootParent, {categoryItemInput: value})\r\n    option.setData(fpMergePre({\r\n      category: res?.categoryRootParent ?? {},\r\n    }))\r\n    return res?.categoryRootParent\r\n  },\r\n})\r\n\r\n\r\nconst ListBox = styled.div<React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> & { columns?: number }>`\r\n  display: grid;\r\n  grid-template-columns: repeat(${props => props.columns || 2}, 1fr);\r\n  grid-gap: 16px;\r\n`\r\n\r\nexport const CategoryPage = () => {\r\n  const router = useRouter()\r\n  const id = (router.query?.id as string) ?? ''\r\n  const {state: stateCPM, actions: actionsCPM, getLoad} = useStoreModel(CategoryPageModel)\r\n  const {actions: actionsCI, state: stateCategoryItemModel} = useStoreModel(categoryItemModel)\r\n  const {state: stateHomeTabs, actions: actionsHomeTabs} = useStoreModel(homeTabsModel)\r\n  useEffect(() => {\r\n    actionsHomeTabs.setHomeType((router.query.homeType as string) ?? HomeType.home)\r\n  }, [actionsHomeTabs, router.query.homeType])\r\n\r\n  const CategoryItem = (v: Category) => {\r\n    return <CategoryItemStyle\r\n        key={`CategoryItem_${v.id}`}\r\n        onClick={async () => {\r\n          const _query = dealUrlQuery({homeType: router.query.homeType})\r\n          if ((await actionsCI.getLevel({\r\n            id: v.id,\r\n          }))?.categoryLevel === 3) {\r\n            await Router.push(`/m/productList/[id]${_query}`, `/m/productList/${v.id}${_query}`)\r\n          } else {\r\n            await Router.push(`/m/category/[id]${_query}`, `/m/category/${v.id}${_query}`)\r\n          }\r\n        }}\r\n    >\r\n      <img\r\n          src={dealImgUrl(v.imgUrl)}\r\n          alt=''\r\n      />\r\n      <span>{v.name}<KeyboardArrowRight/></span>\r\n    </CategoryItemStyle>\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      actionsCPM.getProductList({\r\n        categoryItemInput: {id},\r\n        productItemInput: {\r\n          isGroup: router.query.homeType === HomeType.group ? 1 : 0,\r\n        },\r\n      })\r\n      actionsCI.getCategory({id})\r\n    }\r\n  }, [actionsCI, actionsCPM, id, router.query.homeType])\r\n\r\n  return <div>\r\n    <HeaderTitle\r\n        title={''}\r\n        showCart={router.query.homeType === HomeType.home}\r\n        showSearch={true}\r\n    />\r\n    {!!getLoad(doc.productsInCategory) && <LinearProgress/>}\r\n    <Breadcrumbs\r\n        style={{margin: '8px 0 0 8px'}}\r\n        separator=\"›\"\r\n        aria-label=\"breadcrumb\">\r\n      {[stateCategoryItemModel.category?.parentCategory?.parentCategory, stateCategoryItemModel.category?.parentCategory].filter(v => !!v?.name && v?.name !== CategoryRootName).map(e =>\r\n          <Link\r\n              key={`Breadcrumbs${e?.id}`}\r\n              color=\"inherit\"\r\n              href=\"#\"\r\n              onClick={async () => {\r\n                const _query = dealUrlQuery({homeType: router.query.homeType})\r\n                await Router.push(`/m/category/[id]${_query}`, `/m/category/${e?.id}${_query}`)\r\n              }}>\r\n            {e?.name}\r\n          </Link>)}\r\n      <Typography color=\"textPrimary\">{stateCategoryItemModel.category.name}</Typography>\r\n    </Breadcrumbs>\r\n    <BScroller boxHeight={'calc(100vh - 60px)'}>\r\n      <Box>\r\n        {((stateCPM.categoryList.length === 0 && stateCPM.productList.length === 0) && <NoData/>) ||\r\n        (\r\n            <>\r\n              {stateCPM.categoryList.map(value => CategoryItem(value))}\r\n              <header>{ll('热门推荐')}</header>\r\n              {(stateCPM.productList.length === 0) && <NoData/>}\r\n              <ListBox\r\n                  columns={stateHomeTabs.homeType === HomeType.group ? 1 : 2}\r\n              >\r\n                {stateCPM.productList.map(value => (stateHomeTabs.homeType === HomeType.group && <GroupProductItem\r\n                    product={value}\r\n                    key={`ProductItem_${value.id}`}\r\n                />) || <ProductItem\r\n                    key={`ProductItem_${value.id}`}\r\n                    product={value}/>)}\r\n              </ListBox>\r\n            </>\r\n        )\r\n        }\r\n\r\n      </Box>\r\n    </BScroller>\r\n    <UpdateShopCart/>\r\n  </div>\r\n}\r\n"]},"metadata":{},"sourceType":"module"}