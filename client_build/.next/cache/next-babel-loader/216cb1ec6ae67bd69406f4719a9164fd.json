{"ast":null,"code":"var _jsxFileName = \"D:\\\\code\\\\zw\\\\zw_client_web\\\\utils\\\\view\\\\groupProduct\\\\groupOrderPage.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect } from 'react';\nimport { modelFactory } from '../../ModelAction/modelUtil';\nimport styled from 'styled-components';\nimport { useStoreModel } from '../../ModelAction/useStore';\nimport { dealMaybeNumber, dealMoney, dealUrlQuery, fpMerge, fpMergePre } from '../../tools/utils';\nimport { groupProductModel } from './[id]';\nimport { ShopCartProductBox } from \"../cart/CartProduct\";\nimport { dealImgUrl } from \"../../tools/img\";\nimport { ProductPrice } from \"../../components/ProductItem/ProductItem\";\nimport { IconButton, MenuItem, TextField } from \"@material-ui/core\";\nimport { ls } from \"../../tools/dealKey\";\nimport { Space } from \"../../components/Box/Box\";\nimport { getPickUpTypeName, PickUpTypeEnum } from \"../../ss_common/enum\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport { AddressBox, CardBox, ShopTitle, ShopTotal } from \"../cart/orderPage\";\nimport { shopCartModel } from \"../cart\";\nimport { SelectAddress, selectAddressModel } from \"../cart/components/SelectAddress\";\nimport { SelectCard, selectCardModel } from \"../cart/components/SelectCard\";\nimport { ButtonLoad } from \"../../components/ButtonLoad/ButtonLoad\";\nimport { mpStyle } from \"../../style/common\";\nimport { showMessage } from '../../components/Message/Message';\nimport { useRouter } from 'next/router';\nexport const groupOrderPageModel = modelFactory('orderPageModel', {\n  show: false\n}, {\n  open: (value, option) => {\n    option.setData(fpMergePre({\n      show: true\n    }));\n  }\n});\nconst OrderPageBox = styled.div.withConfig({\n  displayName: \"groupOrderPage__OrderPageBox\",\n  componentId: \"bhof7w-0\"\n})([\"position:fixed;top:0;bottom:0;left:0;right:0;background:white;> footer{position:fixed;bottom:0;box-sizing:border-box;box-shadow:\", \";width:100vw;text-align:right;}\"], mpStyle.shadow[\"1\"]);\nexport const GroupOrderPage = () => {\n  var _stateSCM$payCardList, _product$priceOut, _stateSCM$freightConf, _product$img, _product$img$;\n\n  const router = useRouter();\n  const {\n    state: stateOrderPageModel\n  } = useStoreModel(groupOrderPageModel);\n  const {\n    actions: actionsGroupProduct,\n    state: stateGroupProduct\n  } = useStoreModel(groupProductModel);\n  const product = stateGroupProduct.product;\n  const {\n    state: stateSCM,\n    actions: actionsSCM\n  } = useStoreModel(shopCartModel);\n  useEffect(() => {\n    if (!stateSCM.user.id) {\n      actionsSCM.getOrderInfo();\n    }\n  }, []);\n  const {\n    actions: actionsSAM\n  } = useStoreModel(selectAddressModel);\n  const {\n    actions: actionsSelectCard\n  } = useStoreModel(selectCardModel);\n  const addressData = stateSCM.dealAddressData(stateSCM);\n  const cardData = ((_stateSCM$payCardList = stateSCM.payCardList) === null || _stateSCM$payCardList === void 0 ? void 0 : _stateSCM$payCardList.find(v => v.id === stateSCM.form.paymentMethodCardId)) || {};\n  const productTotal = ((_product$priceOut = product.priceOut) !== null && _product$priceOut !== void 0 ? _product$priceOut : 0) * stateGroupProduct.selectNum;\n  const transportationCosts = stateSCM.form.pickUpType === PickUpTypeEnum.Delivery && stateSCM.freightConfig.reduce((pre, cur) => {\n    if (pre > parseFloat(cur === null || cur === void 0 ? void 0 : cur.freightPay) && productTotal < parseFloat(cur === null || cur === void 0 ? void 0 : cur.orderMax)) {\n      return parseFloat(cur === null || cur === void 0 ? void 0 : cur.freightPay);\n    } else {\n      return pre;\n    }\n  }, parseFloat((_stateSCM$freightConf = stateSCM.freightConfig[stateSCM.freightConfig.length - 1]) === null || _stateSCM$freightConf === void 0 ? void 0 : _stateSCM$freightConf.freightPay)) || 0;\n  const actuallyPaid = productTotal + transportationCosts + dealMaybeNumber(stateSCM.form.saleTax);\n  const generateCoin = actuallyPaid * 0.01;\n  return stateOrderPageModel.show && __jsx(OrderPageBox, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 38\n    }\n  }, __jsx(ShopCartProductBox, {\n    style: {\n      padding: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, __jsx(\"img\", {\n    src: dealImgUrl(product === null || product === void 0 ? void 0 : (_product$img = product.img) === null || _product$img === void 0 ? void 0 : (_product$img$ = _product$img[0]) === null || _product$img$ === void 0 ? void 0 : _product$img$.url),\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }\n  }), __jsx(\"main\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }\n  }, product === null || product === void 0 ? void 0 : product.name, product === null || product === void 0 ? void 0 : product.weight, product === null || product === void 0 ? void 0 : product.unit), __jsx(\"section\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }, product === null || product === void 0 ? void 0 : product.remark), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }, __jsx(ProductPrice, {\n    product: product,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }\n  }, stateGroupProduct.selectNum, ls('份')))), __jsx(TextField, {\n    style: {\n      margin: '16px',\n      width: 'calc(100vw - 32px)'\n    },\n    fullWidth: true,\n    label: ls('运送方式'),\n    select: true,\n    value: stateSCM.form.pickUpType,\n    onChange: event => {\n      actionsSCM.setForm(['pickUpType', event.target.value]);\n      actionsSCM.setForm(['addressId', stateSCM.initAddressId(fpMerge(stateSCM, {\n        form: {\n          pickUpType: event.target.value\n        }\n      }))]);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 5\n    }\n  }, __jsx(MenuItem, {\n    value: PickUpTypeEnum.Self,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }, ls(getPickUpTypeName(PickUpTypeEnum.Self))), __jsx(MenuItem, {\n    value: PickUpTypeEnum.Delivery,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }\n  }, ls(getPickUpTypeName(PickUpTypeEnum.Delivery)))), __jsx(AddressBox, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 5\n    }\n  }, __jsx(\"main\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, `${addressData.combineAddress}`), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }\n  }, `${addressData.name} ${addressData.contactInformation}`)), __jsx(\"aside\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }\n  }, __jsx(IconButton, {\n    onClick: async () => {\n      const res = await actionsSAM.openClick();\n\n      if (res) {\n        actionsSCM.setForm(['addressId', res]);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 9\n    }\n  }, __jsx(ChevronRightIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 11\n    }\n  })))), __jsx(ShopTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 5\n    }\n  }, __jsx(Space, {\n    w: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }\n  }), ls('付款方式')), __jsx(CardBox, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 5\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }\n  }, cardData.name), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }\n  }, cardData.number), __jsx(\"aside\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, __jsx(IconButton, {\n    onClick: async () => {\n      const res = await actionsSelectCard.openClick();\n\n      if (res) {\n        actionsSCM.setForm(['paymentMethodCardId', res]);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }\n  }, __jsx(ChevronRightIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 11\n    }\n  })))), __jsx(SelectAddress, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 5\n    }\n  }), __jsx(SelectCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 5\n    }\n  }), __jsx(ShopTotal, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 5\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }, ls('购物车总计')), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }\n  }, dealMoney(productTotal))), transportationCosts > 0 && __jsx(ShopTotal, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 33\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }\n  }, ls('运费')), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }\n  }, dealMoney(transportationCosts))), __jsx(ShopTotal, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 5\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }\n  }, ls('份数折扣')), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }\n  }, stateGroupProduct.numDiscount)), __jsx(ShopTotal, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 5\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }\n  }, ls('成团折上折')), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }\n  }, stateGroupProduct.groupDiscount)), __jsx(ShopTotal, {\n    style: {\n      fontSize: '18px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 5\n    }\n  }, __jsx(\"header\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }\n  }, ls('订单总额')), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }\n  }, dealMoney(actuallyPaid))), __jsx(Space, {\n    h: 60,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 5\n    }\n  }), __jsx(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 5\n    }\n  }, __jsx(ButtonLoad, {\n    variant: 'contained',\n    color: 'secondary',\n    onClick: async () => {\n      var _stateSCM$user$userIn, _res$saveGroupOrder;\n\n      const res = await actionsGroupProduct.submit({\n        orderInfoItemInput: _objectSpread(_objectSpread({}, stateSCM.form), {}, {\n          generateCoin,\n          actuallyPaid,\n          transportationCosts,\n          subtotal: productTotal,\n          currentUserLevel: (_stateSCM$user$userIn = stateSCM.user.userInfo) === null || _stateSCM$user$userIn === void 0 ? void 0 : _stateSCM$user$userIn.userLevel,\n          rOrderProduct: [{\n            count: stateGroupProduct.selectNum,\n            productId: product === null || product === void 0 ? void 0 : product.id,\n            product\n          }]\n        })\n      });\n\n      if (res === null || res === void 0 ? void 0 : (_res$saveGroupOrder = res.saveGroupOrder) === null || _res$saveGroupOrder === void 0 ? void 0 : _res$saveGroupOrder.id) {\n        var _res$saveGroupOrder2;\n\n        showMessage('操作成功 将前往付款'); // await router.replace('/cart/result')\n\n        const _query = dealUrlQuery({\n          orderId: res === null || res === void 0 ? void 0 : (_res$saveGroupOrder2 = res.saveGroupOrder) === null || _res$saveGroupOrder2 === void 0 ? void 0 : _res$saveGroupOrder2.id\n        });\n\n        await router.replace(`/pay${_query}`, `/pay${_query}`);\n        actionsSCM.clearData();\n        actionsSCM.getList();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, ls('提交订单')))) || null;\n};","map":{"version":3,"sources":["D:/code/zw/zw_client_web/utils/view/groupProduct/groupOrderPage.tsx"],"names":["React","useEffect","modelFactory","styled","useStoreModel","dealMaybeNumber","dealMoney","dealUrlQuery","fpMerge","fpMergePre","groupProductModel","ShopCartProductBox","dealImgUrl","ProductPrice","IconButton","MenuItem","TextField","ls","Space","getPickUpTypeName","PickUpTypeEnum","ChevronRightIcon","AddressBox","CardBox","ShopTitle","ShopTotal","shopCartModel","SelectAddress","selectAddressModel","SelectCard","selectCardModel","ButtonLoad","mpStyle","showMessage","useRouter","groupOrderPageModel","show","open","value","option","setData","OrderPageBox","div","shadow","GroupOrderPage","router","state","stateOrderPageModel","actions","actionsGroupProduct","stateGroupProduct","product","stateSCM","actionsSCM","user","id","getOrderInfo","actionsSAM","actionsSelectCard","addressData","dealAddressData","cardData","payCardList","find","v","form","paymentMethodCardId","productTotal","priceOut","selectNum","transportationCosts","pickUpType","Delivery","freightConfig","reduce","pre","cur","parseFloat","freightPay","orderMax","length","actuallyPaid","saleTax","generateCoin","padding","img","url","name","weight","unit","remark","margin","width","event","setForm","target","initAddressId","Self","combineAddress","contactInformation","res","openClick","number","numDiscount","groupDiscount","fontSize","submit","orderInfoItemInput","subtotal","currentUserLevel","userInfo","userLevel","rOrderProduct","count","productId","saveGroupOrder","_query","orderId","replace","clearData","getList"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport {modelFactory} from '../../ModelAction/modelUtil'\r\nimport styled from 'styled-components'\r\nimport {useStoreModel} from '../../ModelAction/useStore'\r\nimport {dealMaybeNumber, dealMoney, dealUrlQuery, fpMerge, fpMergePre} from '../../tools/utils'\r\nimport {groupProductModel} from './[id]'\r\nimport {ShopCartProductBox} from \"../cart/CartProduct\";\r\nimport {dealImgUrl} from \"../../tools/img\";\r\nimport {ProductPrice} from \"../../components/ProductItem/ProductItem\";\r\nimport {IconButton, MenuItem, TextField} from \"@material-ui/core\";\r\nimport {ls} from \"../../tools/dealKey\";\r\nimport {Space} from \"../../components/Box/Box\";\r\nimport {getPickUpTypeName, PickUpTypeEnum} from \"../../ss_common/enum\";\r\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\r\nimport {AddressBox, CardBox, ShopTitle, ShopTotal} from \"../cart/orderPage\";\r\nimport {shopCartModel} from \"../cart\";\r\nimport {SelectAddress, selectAddressModel} from \"../cart/components/SelectAddress\";\r\nimport {SelectCard, selectCardModel} from \"../cart/components/SelectCard\";\r\nimport {ButtonLoad} from \"../../components/ButtonLoad/ButtonLoad\";\r\nimport {mpStyle} from \"../../style/common\";\r\nimport {showMessage} from '../../components/Message/Message'\r\nimport {useRouter} from 'next/router'\r\n\r\nexport const groupOrderPageModel = modelFactory('orderPageModel', {\r\n  show: false,\r\n}, {\r\n  open: (value, option) => {\r\n    option.setData(fpMergePre({\r\n      show: true,\r\n    }))\r\n  },\r\n})\r\n\r\nconst OrderPageBox = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  background: white;\r\n  > footer {\r\n    position: fixed;\r\n    bottom: 0;\r\n    box-sizing: border-box;\r\n    box-shadow: ${mpStyle.shadow[\"1\"]};\r\n    width: 100vw;\r\n    text-align: right;\r\n  }\r\n`\r\n\r\nexport const GroupOrderPage = () => {\r\n  const router = useRouter()\r\n  const {state: stateOrderPageModel} = useStoreModel(groupOrderPageModel)\r\n  const {actions: actionsGroupProduct, state: stateGroupProduct} = useStoreModel(groupProductModel)\r\n  const product = stateGroupProduct.product\r\n  const {state: stateSCM, actions: actionsSCM} = useStoreModel(shopCartModel)\r\n  useEffect(() => {\r\n    if (!stateSCM.user.id) {\r\n      actionsSCM.getOrderInfo()\r\n    }\r\n  }, [])\r\n  const {actions: actionsSAM} = useStoreModel(selectAddressModel)\r\n  const {actions: actionsSelectCard} = useStoreModel(selectCardModel)\r\n\r\n  const addressData = stateSCM.dealAddressData(stateSCM)\r\n  const cardData = stateSCM.payCardList?.find(v => v.id === stateSCM.form.paymentMethodCardId) || {}\r\n  const productTotal = (product.priceOut ?? 0) * stateGroupProduct.selectNum\r\n  const transportationCosts = (stateSCM.form.pickUpType === PickUpTypeEnum.Delivery && (stateSCM.freightConfig.reduce((pre, cur) => {\r\n    if (pre > parseFloat(cur?.freightPay) && productTotal < parseFloat(cur?.orderMax)) {\r\n      return parseFloat(cur?.freightPay)\r\n    } else {\r\n      return pre\r\n    }\r\n  }, parseFloat(stateSCM.freightConfig[stateSCM.freightConfig.length - 1]?.freightPay)))) || 0\r\n  const actuallyPaid = productTotal + transportationCosts + dealMaybeNumber(stateSCM.form.saleTax)\r\n  const generateCoin = actuallyPaid * 0.01\r\n\r\n  return stateOrderPageModel.show && <OrderPageBox\r\n  >\r\n    <ShopCartProductBox style={{padding: '20px'}}>\r\n      <img src={dealImgUrl(product?.img?.[0]?.url)}\r\n           alt=\"\"/>\r\n      <main>{product?.name}{product?.weight}{product?.unit}</main>\r\n      <section>{product?.remark}</section>\r\n      <footer>\r\n        <ProductPrice product={product}/>\r\n        <span>{stateGroupProduct.selectNum}{ls('份')}</span>\r\n      </footer>\r\n    </ShopCartProductBox>\r\n    <TextField\r\n        style={{margin: '16px', width: 'calc(100vw - 32px)'}}\r\n        fullWidth={true}\r\n        label={ls('运送方式')}\r\n        select={true}\r\n        value={stateSCM.form.pickUpType}\r\n        onChange={event => {\r\n          actionsSCM.setForm(['pickUpType', event.target.value])\r\n          actionsSCM.setForm(['addressId', stateSCM.initAddressId(fpMerge(stateSCM, {\r\n            form: {\r\n              pickUpType: event.target.value,\r\n            },\r\n          }))])\r\n        }}\r\n    >\r\n      <MenuItem\r\n          value={PickUpTypeEnum.Self}\r\n      >{ls(getPickUpTypeName(PickUpTypeEnum.Self))}</MenuItem>\r\n      <MenuItem\r\n          value={PickUpTypeEnum.Delivery}\r\n      >{ls(getPickUpTypeName(PickUpTypeEnum.Delivery))}</MenuItem>\r\n    </TextField>\r\n    <AddressBox>\r\n      <main>\r\n        <header>\r\n          {`${addressData.combineAddress}`}\r\n        </header>\r\n        <footer>\r\n          {`${addressData.name} ${addressData.contactInformation}`}\r\n        </footer>\r\n      </main>\r\n      <aside>\r\n        <IconButton\r\n            onClick={async () => {\r\n              const res = await actionsSAM.openClick()\r\n              if (res) {\r\n                actionsSCM.setForm(['addressId', res])\r\n              }\r\n            }}\r\n        >\r\n          <ChevronRightIcon/>\r\n        </IconButton>\r\n      </aside>\r\n    </AddressBox>\r\n    <ShopTitle>\r\n      <Space w={20}/>\r\n      {ls('付款方式')}\r\n    </ShopTitle>\r\n    <CardBox>\r\n      <header>{cardData.name}</header>\r\n      <footer>{cardData.number}</footer>\r\n      <aside>\r\n        <IconButton\r\n            onClick={async () => {\r\n              const res = await actionsSelectCard.openClick()\r\n              if (res) {\r\n                actionsSCM.setForm(['paymentMethodCardId', res])\r\n              }\r\n            }}\r\n        >\r\n          <ChevronRightIcon/>\r\n        </IconButton>\r\n      </aside>\r\n    </CardBox>\r\n    <SelectAddress/>\r\n    <SelectCard/>\r\n    <ShopTotal>\r\n      <header>{ls('购物车总计')}</header>\r\n      <footer>{dealMoney(productTotal)}</footer>\r\n    </ShopTotal>\r\n    {transportationCosts > 0 && <ShopTotal>\r\n      <header>{ls('运费')}</header>\r\n      <footer>{dealMoney(transportationCosts)}</footer>\r\n    </ShopTotal>}\r\n    <ShopTotal>\r\n      <header>{ls('份数折扣')}</header>\r\n      <footer>{stateGroupProduct.numDiscount}</footer>\r\n    </ShopTotal>\r\n    <ShopTotal>\r\n      <header>{ls('成团折上折')}</header>\r\n      <footer>{stateGroupProduct.groupDiscount}</footer>\r\n    </ShopTotal>\r\n    <ShopTotal\r\n        style={{fontSize: '18px'}}\r\n    >\r\n      <header>{ls('订单总额')}</header>\r\n      <footer>{dealMoney(actuallyPaid)}</footer>\r\n    </ShopTotal>\r\n    <Space h={60}/>\r\n    <footer>\r\n      <ButtonLoad\r\n          variant={'contained'}\r\n          color={'secondary'}\r\n          onClick={async () => {\r\n            const res = await actionsGroupProduct.submit({\r\n              orderInfoItemInput: {\r\n                ...stateSCM.form,\r\n                generateCoin,\r\n                actuallyPaid,\r\n                transportationCosts,\r\n                subtotal: productTotal,\r\n                currentUserLevel: stateSCM.user.userInfo?.userLevel,\r\n                rOrderProduct: [{\r\n                  count: stateGroupProduct.selectNum,\r\n                  productId: product?.id,\r\n                  product,\r\n                }],\r\n              }\r\n            })\r\n            if (res?.saveGroupOrder?.id) {\r\n              showMessage('操作成功 将前往付款')\r\n              // await router.replace('/cart/result')\r\n              const _query = dealUrlQuery({orderId: res?.saveGroupOrder?.id})\r\n              await router.replace(`/pay${_query}`, `/pay${_query}`)\r\n              actionsSCM.clearData()\r\n              actionsSCM.getList()\r\n            }\r\n          }}\r\n      >{ls('提交订单')}</ButtonLoad>\r\n    </footer>\r\n  </OrderPageBox> || null\r\n}\r\n"]},"metadata":{},"sourceType":"module"}