{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { MainBox } from '../pcComponents/mainBox/mainBox';\nimport { PcHeader } from '../pcComponents/header/header';\nimport { PcContentBox } from '../home/pcHome';\nimport styled from 'styled-components';\nimport { TopAction } from '../pcComponents/topAction/topAction';\nimport { HeaderTab } from '../home/components/headerTab';\nimport { Space } from '../../../components/Box/Box';\nimport { mpStyle, RedBox } from '../../../style/common';\nimport { ls } from '../../../tools/dealKey';\nimport { dealMaybeNumber, dealMoney, fpMergePre } from '../../../tools/utils';\nimport { useOrderPageHooks } from '../../m/cart/orderPage';\nimport { Button, ButtonBase, Divider, ExpansionPanel, ExpansionPanelDetails, ExpansionPanelSummary, TextField } from '@material-ui/core';\nimport { modelFactory } from '../../../ModelAction/modelUtil';\nimport { useStoreModel } from '../../../ModelAction/useStore';\nimport { useRouter } from 'next/router';\nimport { grey } from '@material-ui/core/colors';\nimport { showMessage } from '../../../components/Message/Message';\nvar OrderContentBox = styled.div.withConfig({\n  displayName: \"orderPage__OrderContentBox\",\n  componentId: \"l65kr3-0\"\n})([\"display:grid;grid-template-columns:1fr 450px;grid-gap:\", \";\"], mpStyle.spacePx.n);\nvar ModifyBox = styled.div.withConfig({\n  displayName: \"orderPage__ModifyBox\",\n  componentId: \"l65kr3-1\"\n})([\"&&&{.MuiExpansionPanelDetails-root{flex-direction:column;}}\"]);\nvar OrderDetailBox = styled.div.withConfig({\n  displayName: \"orderPage__OrderDetailBox\",\n  componentId: \"l65kr3-2\"\n})([\"padding:\", \";border:1px solid \", \";> header{\", \";}\"], mpStyle.spacePx.xs, mpStyle.greyLite, mpStyle.fontType.n);\nvar ShopTotal = styled.div.withConfig({\n  displayName: \"orderPage__ShopTotal\",\n  componentId: \"l65kr3-3\"\n})([\"display:flex;justify-content:space-between;margin-top:\", \";\"], mpStyle.spacePx.xs);\nvar RedSpan = styled.span.withConfig({\n  displayName: \"orderPage__RedSpan\",\n  componentId: \"l65kr3-4\"\n})([\"color:\", \";\"], mpStyle.red);\nvar FillInputBox = styled.div.withConfig({\n  displayName: \"orderPage__FillInputBox\",\n  componentId: \"l65kr3-5\"\n})([\"&&&{.MuiFilledInput-input{padding-top:10px;}}\"]);\nvar TabHeader = styled.div.withConfig({\n  displayName: \"orderPage__TabHeader\",\n  componentId: \"l65kr3-6\"\n})([\"\", \";display:flex;align-items:center;> aside{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;border:1px solid \", \";margin-right:\", \";\", \";}\"], mpStyle.fontType.n, mpStyle.grey, mpStyle.spacePx.xxs, function (props) {\n  return props.isAct && \"\\n      background: \".concat(mpStyle.red, \";\\n      border-color: \").concat(mpStyle.red, \";\\n      color: #fff;\\n    \");\n});\nvar ProductBox = styled.div.withConfig({\n  displayName: \"orderPage__ProductBox\",\n  componentId: \"l65kr3-7\"\n})([\"width:100%;border:1px solid \", \";border-radius:4px;\"], mpStyle.greyLite);\nvar ProductBoxHeader = styled.div.withConfig({\n  displayName: \"orderPage__ProductBoxHeader\",\n  componentId: \"l65kr3-8\"\n})([\"height:60px;background:\", \";display:flex;align-items:center;\"], mpStyle.greyLite);\nvar ProductRow = styled.div.withConfig({\n  displayName: \"orderPage__ProductRow\",\n  componentId: \"l65kr3-9\"\n})([\"margin:\", \" 0;display:grid;grid-template-columns:200px 1fr 200px;grid-template-rows:1fr 32px 32px;grid-template-areas:\\\"img a d\\\" \\\"img b d\\\" \\\"img c d\\\";> img{grid-area:img;justify-self:center;width:80px;height:120px;}> div{display:flex;}> section{grid-area:a;}> aside{grid-area:d;display:flex;flex-direction:column;justify-content:flex-end;> header{height:40px;flex-basis:70%;}\", \"{\", \";flex-grow:1;}}\"], mpStyle.spacePx.n, RedBox, mpStyle.fontType.n);\nvar ProductFooter = styled.div.withConfig({\n  displayName: \"orderPage__ProductFooter\",\n  componentId: \"l65kr3-10\"\n})([\"display:flex;justify-content:space-between;.MuiButton-root{width:45%;}\"]);\nvar AddressBox = styled.div.withConfig({\n  displayName: \"orderPage__AddressBox\",\n  componentId: \"l65kr3-11\"\n})([\"display:grid;grid-template-columns:repeat(3,1fr);grid-gap:\", \";\"], mpStyle.spacePx.xs);\nvar AddressBoxItem = styled(ButtonBase).withConfig({\n  displayName: \"orderPage__AddressBoxItem\",\n  componentId: \"l65kr3-12\"\n})([\"&&&{flex-direction:column;align-items:flex-start;border:1px solid \", \";border-radius:4px;padding:\", \";cursor:pointer;\", \";}\"], grey[800], mpStyle.spacePx.xxs, function (props) {\n  return props.isAct && \"\\n      background: \".concat(mpStyle.red, \";\\n      color: #fff;\\n      border: none;\\n    \");\n});\nvar ActStepEnum = {\n  product: 'product',\n  address: 'address',\n  payType: 'payType'\n};\nexport var PcOrderPageModel = modelFactory('PcOrderPageModel', {\n  actStep: ActStepEnum.product\n}, {\n  updateActStep: function () {\n    var _updateActStep = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              option.setData(fpMergePre({\n                actStep: value\n              }));\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function updateActStep(_x, _x2) {\n      return _updateActStep.apply(this, arguments);\n    }\n\n    return updateActStep;\n  }()\n});\nexport var OrderPage = function OrderPage() {\n  var _stateShopCartModel$f, _stateShopCartModel$f2, _stateShopCartModel$u, _stateShopCartModel$f3, _stateShopCartModel$f4;\n\n  var router = useRouter();\n\n  var _useOrderPageHooks = useOrderPageHooks(),\n      stateShopCartModel = _useOrderPageHooks.stateShopCartModel,\n      actionsShopCartModel = _useOrderPageHooks.actionsShopCartModel,\n      getLoad = _useOrderPageHooks.getLoad,\n      addressData = _useOrderPageHooks.addressData,\n      cardData = _useOrderPageHooks.cardData,\n      productTotal = _useOrderPageHooks.productTotal,\n      transportationCosts = _useOrderPageHooks.transportationCosts,\n      actuallyPaid = _useOrderPageHooks.actuallyPaid,\n      generateCoin = _useOrderPageHooks.generateCoin;\n\n  var _useStoreModel = useStoreModel(PcOrderPageModel),\n      actionsPcOrderPageModel = _useStoreModel.actions,\n      statePcOrderPageModel = _useStoreModel.state;\n\n  var addressList = stateShopCartModel.dealAddressList(stateShopCartModel);\n  console.log(addressList);\n  console.log(stateShopCartModel.form);\n  return __jsx(MainBox, null, __jsx(PcHeader, null), __jsx(PcContentBox, null, __jsx(TopAction, null), __jsx(HeaderTab, null), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(OrderContentBox, null, __jsx(ModifyBox, null, __jsx(ExpansionPanel, {\n    elevation: 0,\n    expanded: true\n  }, __jsx(ExpansionPanelSummary, null, __jsx(TabHeader, {\n    isAct: statePcOrderPageModel.actStep === ActStepEnum.address\n  }, __jsx(\"aside\", null, \"1\"), ls('选择地址'))), __jsx(ExpansionPanelDetails, null, __jsx(AddressBox, null, addressList.map(function (v) {\n    return __jsx(AddressBoxItem, {\n      key: \"addressList.map\".concat(v.id),\n      isAct: stateShopCartModel.form.addressId === v.id,\n      onClick: function onClick() {\n        actionsShopCartModel.setForm(['addressId', v.id]);\n      }\n    }, __jsx(\"header\", null, v.name), __jsx(\"main\", null, v.address), __jsx(\"footer\", null, \"\".concat(v.city, \" \").concat(v.province, \" \").concat(v.zip)));\n  })))), __jsx(ExpansionPanel, {\n    elevation: 0,\n    expanded: true\n  }, __jsx(ExpansionPanelSummary, null, __jsx(TabHeader, null, __jsx(\"aside\", null, \"2\"), ls('选择付款方式'))), __jsx(ExpansionPanelDetails, null, __jsx(AddressBox, null, stateShopCartModel.payCardList.map(function (v) {\n    return __jsx(AddressBoxItem, {\n      key: \"addressList.map\".concat(v.id),\n      isAct: stateShopCartModel.form.paymentMethodCardId === v.id,\n      onClick: function onClick() {\n        actionsShopCartModel.setForm(['paymentMethodCardId', v.id]);\n      }\n    }, __jsx(\"header\", null, v.name), __jsx(\"footer\", null, \"\".concat(v.number)));\n  }))))), __jsx(OrderDetailBox, null, __jsx(\"header\", null, ls('订单详情')), __jsx(ShopTotal, null, __jsx(\"header\", null, ls('购物车总计')), __jsx(\"footer\", null, dealMoney(productTotal - ((_stateShopCartModel$f = (_stateShopCartModel$f2 = stateShopCartModel.form) === null || _stateShopCartModel$f2 === void 0 ? void 0 : _stateShopCartModel$f2.couponDiscount) !== null && _stateShopCartModel$f !== void 0 ? _stateShopCartModel$f : 0)))), transportationCosts > 0 && __jsx(ShopTotal, null, __jsx(\"header\", null, ls('运费')), __jsx(\"footer\", null, dealMoney(transportationCosts))), __jsx(ShopTotal, null, __jsx(\"header\", null, ls('达人币抵扣')), __jsx(\"footer\", null, dealMoney(stateShopCartModel.form.deductCoin, '-'))), __jsx(Space, {\n    h: mpStyle.space.xs\n  }), __jsx(Divider, {\n    light: true\n  }), __jsx(ShopTotal, {\n    style: {\n      fontSize: '18px'\n    }\n  }, __jsx(\"header\", null, ls('订单总额')), __jsx(\"footer\", null, dealMoney(actuallyPaid))), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(\"div\", null, ls('使用达人币'), __jsx(RedSpan, null, ls('当月可用余额'), \" \", dealMoney((_stateShopCartModel$u = stateShopCartModel.user) === null || _stateShopCartModel$u === void 0 ? void 0 : _stateShopCartModel$u.orderCoinCurrentMonth))), __jsx(Space, {\n    h: mpStyle.space.xxs\n  }), __jsx(FillInputBox, null, __jsx(TextField, {\n    variant: 'filled',\n    label: ls(''),\n    value: stateShopCartModel.form.deductCoin,\n    onChange: function onChange(e) {\n      actionsShopCartModel.setForm(['deductCoin', e.target.value]);\n    }\n  })), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(ShopTotal, null, __jsx(\"header\", null, ls('购物车总计')), __jsx(\"footer\", null, dealMoney(productTotal - ((_stateShopCartModel$f3 = (_stateShopCartModel$f4 = stateShopCartModel.form) === null || _stateShopCartModel$f4 === void 0 ? void 0 : _stateShopCartModel$f4.couponDiscount) !== null && _stateShopCartModel$f3 !== void 0 ? _stateShopCartModel$f3 : 0)))), __jsx(Space, {\n    h: mpStyle.space.s\n  }), __jsx(Button, {\n    fullWidth: true,\n    variant: 'contained',\n    color: 'secondary',\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _stateShopCartModel$u2, _stateShopCartModel$u3, _res$saveOrder;\n\n      var submitData, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(dealMaybeNumber((_stateShopCartModel$u2 = stateShopCartModel.user) === null || _stateShopCartModel$u2 === void 0 ? void 0 : _stateShopCartModel$u2.orderCoinCurrentMonth) < dealMaybeNumber(stateShopCartModel.form.deductCoin))) {\n                _context2.next = 3;\n                break;\n              }\n\n              showMessage(ls('达人币余额不足'));\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              submitData = _objectSpread(_objectSpread({}, stateShopCartModel.form), {}, {\n                generateCoin: generateCoin,\n                actuallyPaid: actuallyPaid,\n                transportationCosts: transportationCosts,\n                subtotal: productTotal,\n                currentUserLevel: (_stateShopCartModel$u3 = stateShopCartModel.user.userInfo) === null || _stateShopCartModel$u3 === void 0 ? void 0 : _stateShopCartModel$u3.userLevel,\n                rOrderProduct: stateShopCartModel.shopCartList.map(function (v) {\n                  var _v$product;\n\n                  return {\n                    count: v.number,\n                    productId: (_v$product = v.product) === null || _v$product === void 0 ? void 0 : _v$product.id,\n                    product: v.product\n                  };\n                })\n              });\n              _context2.next = 6;\n              return actionsShopCartModel.submit(_objectSpread({}, submitData));\n\n            case 6:\n              res = _context2.sent;\n\n              if (!(res === null || res === void 0 ? void 0 : (_res$saveOrder = res.saveOrder) === null || _res$saveOrder === void 0 ? void 0 : _res$saveOrder.id)) {\n                _context2.next = 13;\n                break;\n              }\n\n              showMessage('操作成功'); // const _query = dealUrlQuery({orderId: res?.saveOrder?.id})\n\n              _context2.next = 11;\n              return router.replace(\"/pc/home\");\n\n            case 11:\n              actionsShopCartModel.clearData();\n              actionsShopCartModel.getList();\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }))\n  }, ls('提交订单'))))));\n};","map":null,"metadata":{},"sourceType":"module"}