{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { modelFactory } from '../../ModelAction/modelUtil';\nimport { PickUpTypeEnum } from '../../ss_common/enum';\nimport { dealMaybeNumber, fpMergePre } from '../../tools/utils';\nimport { setForm } from '../../tools/commonAction';\nimport { doc } from '../../graphqlTypes/doc';\nimport { ShopCartPage } from './shopCart';\nimport React from 'react';\nimport { useStoreModel } from '../../ModelAction/useStore';\nimport { OrderPage } from './orderPage';\nexport var pageTypeEnum = {\n  shopCart: 'shopCart',\n  order: 'order'\n};\nvar initForm = {\n  pickUpType: PickUpTypeEnum.Self,\n  addressId: '',\n  paymentMethodCardId: '',\n  deductCoin: 0,\n  saleTax: 0,\n  transportationCosts: 0\n};\nexport var shopCartModel = modelFactory('shopCartModel', {\n  user: {},\n  promoCode: {},\n  payCardList: [],\n  userAddressList: [],\n  selfAddress: [],\n  freightConfig: [],\n  userLevelList: [],\n  pageType: pageTypeEnum.shopCart,\n  shopCartList: [],\n  shopCartListNext: [],\n  form: _objectSpread({}, initForm),\n  dealProductNumber: function dealProductNumber(state) {\n    return state.shopCartList.reduce(function (pre, cur) {\n      var _cur$number;\n\n      return pre + ((_cur$number = cur === null || cur === void 0 ? void 0 : cur.number) !== null && _cur$number !== void 0 ? _cur$number : 0);\n    }, 0);\n  },\n  dealAddressList: function (state) {\n    return state.form.pickUpType === PickUpTypeEnum.Delivery && state.userAddressList || state.selfAddress.map(function (v) {\n      return _objectSpread(_objectSpread({}, v), {}, {\n        combineAddress: \"\".concat(v.province, \" \").concat(v.city, \" \").concat(v.streetAddress),\n        name: v.fullName,\n        contactInformation: v.phone\n      });\n    });\n  },\n  dealAddressData: function dealAddressData(state) {\n    return state.dealAddressList(state).find(function (v) {\n      return v.id === state.form.addressId;\n    }) || {};\n  },\n  initAddressId: function initAddressId(state) {\n    var _state$userAddressLis, _state$userAddressLis2, _state$selfAddress, _state$selfAddress$;\n\n    return state.form.pickUpType === PickUpTypeEnum.Delivery && ((_state$userAddressLis = state.userAddressList) === null || _state$userAddressLis === void 0 ? void 0 : (_state$userAddressLis2 = _state$userAddressLis.find(function (v) {\n      return v.isDefault;\n    })) === null || _state$userAddressLis2 === void 0 ? void 0 : _state$userAddressLis2.id) || ((_state$selfAddress = state.selfAddress) === null || _state$selfAddress === void 0 ? void 0 : (_state$selfAddress$ = _state$selfAddress[0]) === null || _state$selfAddress$ === void 0 ? void 0 : _state$selfAddress$.id);\n  },\n  dealProductTotal: function dealProductTotal(state) {\n    return state.shopCartList.reduce(function (pre, cur) {\n      var _cur$product;\n\n      return pre + dealMaybeNumber(cur === null || cur === void 0 ? void 0 : cur.number) * dealMaybeNumber(cur === null || cur === void 0 ? void 0 : (_cur$product = cur.product) === null || _cur$product === void 0 ? void 0 : _cur$product.priceOut);\n    }, 0);\n  },\n  dealTransportationCosts: function dealTransportationCosts(state, productTotal) {\n    var _state$freightConfig;\n\n    return state.form.pickUpType === PickUpTypeEnum.Delivery && state.freightConfig.reduce(function (pre, cur) {\n      if (pre > parseFloat(cur === null || cur === void 0 ? void 0 : cur.freightPay) && productTotal < parseFloat(cur === null || cur === void 0 ? void 0 : cur.orderMax)) {\n        return parseFloat(cur === null || cur === void 0 ? void 0 : cur.freightPay);\n      } else {\n        return pre;\n      }\n    }, parseFloat((_state$freightConfig = state.freightConfig[state.freightConfig.length - 1]) === null || _state$freightConfig === void 0 ? void 0 : _state$freightConfig.freightPay)) || 0;\n  }\n}, {\n  clearData: function clearData(value, option) {\n    option.setData(fpMergePre({\n      form: initForm,\n      pageType: pageTypeEnum.shopCart\n    }));\n  },\n  clearForm: function clearForm(value, option) {\n    return option.setData(fpMergePre({\n      form: _objectSpread({}, initForm)\n    }));\n  },\n  setForm: setForm,\n  getList: function () {\n    var _getList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value, option) {\n      var _userRes$oneUser, _res$shopCartList$fil, _res$shopCartList$fil2;\n\n      var userRes, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return option.query(doc.oneUser);\n\n            case 2:\n              userRes = _context.sent;\n              _context.next = 5;\n              return option.query(doc.userShopCartList);\n\n            case 5:\n              res = _context.sent;\n              option.setData(fpMergePre({\n                user: (_userRes$oneUser = userRes.oneUser) !== null && _userRes$oneUser !== void 0 ? _userRes$oneUser : {},\n                shopCartList: (_res$shopCartList$fil = res === null || res === void 0 ? void 0 : res.shopCartList.filter(function (v) {\n                  return !v.isNext;\n                })) !== null && _res$shopCartList$fil !== void 0 ? _res$shopCartList$fil : [],\n                shopCartListNext: (_res$shopCartList$fil2 = res === null || res === void 0 ? void 0 : res.shopCartList.filter(function (v) {\n                  return !!v.isNext;\n                })) !== null && _res$shopCartList$fil2 !== void 0 ? _res$shopCartList$fil2 : []\n              }));\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function getList(_x, _x2) {\n      return _getList.apply(this, arguments);\n    }\n\n    return getList;\n  }(),\n  dealPromoCode: function () {\n    var _dealPromoCode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value, option) {\n      var _res$promoCodeList;\n\n      var res, promoCode, category;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return option.query(doc.promoCodeList, {\n                promoCodeItemInput: {\n                  code: value\n                }\n              });\n\n            case 2:\n              res = _context2.sent;\n\n              if (!((res === null || res === void 0 ? void 0 : (_res$promoCodeList = res.promoCodeList) === null || _res$promoCodeList === void 0 ? void 0 : _res$promoCodeList.length) === 1)) {\n                _context2.next = 10;\n                break;\n              }\n\n              promoCode = res.promoCodeList[0];\n              option.setData(fpMergePre({\n                promoCode: promoCode\n              }));\n              _context2.next = 8;\n              return option.query(doc.categoryRootParent, {\n                categoryItemInput: {\n                  id: promoCode === null || promoCode === void 0 ? void 0 : promoCode.productCategory\n                }\n              });\n\n            case 8:\n              category = _context2.sent;\n              console.log(category);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function dealPromoCode(_x3, _x4) {\n      return _dealPromoCode.apply(this, arguments);\n    }\n\n    return dealPromoCode;\n  }(),\n  updatePageType: function updatePageType(value, option) {\n    return option.setData(fpMergePre({\n      pageType: value\n    }));\n  },\n  updatePayCardList: function () {\n    var _updatePayCardList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value, option) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return option.query(doc.orderConfirmInfo);\n\n            case 2:\n              res = _context3.sent;\n              option.setData(fpMergePre({\n                payCardList: res === null || res === void 0 ? void 0 : res.payCardListOneUser\n              }));\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function updatePayCardList(_x5, _x6) {\n      return _updatePayCardList.apply(this, arguments);\n    }\n\n    return updatePayCardList;\n  }(),\n  getOrderInfo: function () {\n    var _getOrderInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(value, option) {\n      var _res$getDataConfig$va, _res$getDataConfig, _res$getDataConfig$va2, _res$freightConfig$va, _res$freightConfig, _res$freightConfig$va2, _res$userLevelList, _res$userAddressListO, _res$userAddressListO2, _res$getDataConfig2, _res$getDataConfig2$v, _res$getDataConfig2$v2, _res$getDataConfig2$v3, _ref, _ref$find;\n\n      var res;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return option.query(doc.orderConfirmInfo);\n\n            case 2:\n              res = _context4.sent;\n              option.setData(fpMergePre({\n                user: res === null || res === void 0 ? void 0 : res.oneUser,\n                payCardList: res === null || res === void 0 ? void 0 : res.payCardListOneUser,\n                userAddressList: res === null || res === void 0 ? void 0 : res.userAddressListOneUser,\n                selfAddress: (_res$getDataConfig$va = res === null || res === void 0 ? void 0 : (_res$getDataConfig = res.getDataConfig) === null || _res$getDataConfig === void 0 ? void 0 : (_res$getDataConfig$va2 = _res$getDataConfig.value) === null || _res$getDataConfig$va2 === void 0 ? void 0 : _res$getDataConfig$va2.list) !== null && _res$getDataConfig$va !== void 0 ? _res$getDataConfig$va : [],\n                freightConfig: (_res$freightConfig$va = res === null || res === void 0 ? void 0 : (_res$freightConfig = res.freightConfig) === null || _res$freightConfig === void 0 ? void 0 : (_res$freightConfig$va2 = _res$freightConfig.value) === null || _res$freightConfig$va2 === void 0 ? void 0 : _res$freightConfig$va2.freightList) !== null && _res$freightConfig$va !== void 0 ? _res$freightConfig$va : [],\n                userLevelList: (_res$userLevelList = res === null || res === void 0 ? void 0 : res.userLevelList) !== null && _res$userLevelList !== void 0 ? _res$userLevelList : []\n              }));\n              option.setData(fpMergePre({\n                form: {\n                  addressId: option.data.form.pickUpType === PickUpTypeEnum.Delivery && (res === null || res === void 0 ? void 0 : (_res$userAddressListO = res.userAddressListOneUser) === null || _res$userAddressListO === void 0 ? void 0 : (_res$userAddressListO2 = _res$userAddressListO.find(function (v) {\n                    return v.isDefault;\n                  })) === null || _res$userAddressListO2 === void 0 ? void 0 : _res$userAddressListO2.id) || (res === null || res === void 0 ? void 0 : (_res$getDataConfig2 = res.getDataConfig) === null || _res$getDataConfig2 === void 0 ? void 0 : (_res$getDataConfig2$v = _res$getDataConfig2.value) === null || _res$getDataConfig2$v === void 0 ? void 0 : (_res$getDataConfig2$v2 = _res$getDataConfig2$v.list) === null || _res$getDataConfig2$v2 === void 0 ? void 0 : (_res$getDataConfig2$v3 = _res$getDataConfig2$v2[0]) === null || _res$getDataConfig2$v3 === void 0 ? void 0 : _res$getDataConfig2$v3.id),\n                  paymentMethodCardId: ((_ref = res === null || res === void 0 ? void 0 : res.payCardListOneUser) === null || _ref === void 0 ? void 0 : (_ref$find = _ref.find(function (v) {\n                    return v.isDefault;\n                  })) === null || _ref$find === void 0 ? void 0 : _ref$find.id) || ''\n                }\n              }));\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    function getOrderInfo(_x7, _x8) {\n      return _getOrderInfo.apply(this, arguments);\n    }\n\n    return getOrderInfo;\n  }(),\n  submit: function () {\n    var _submit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(value, option) {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return option.mutate(doc.saveOrder, {\n                orderInfoItemInput: _objectSpread({}, value)\n              });\n\n            case 2:\n              return _context5.abrupt(\"return\", _context5.sent);\n\n            case 3:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    function submit(_x9, _x10) {\n      return _submit.apply(this, arguments);\n    }\n\n    return submit;\n  }()\n});\nexport var CartPage = function CartPage() {\n  var _useStoreModel = useStoreModel(shopCartModel),\n      stateSCM = _useStoreModel.state;\n\n  return stateSCM.pageType === pageTypeEnum.order && __jsx(OrderPage, null) || __jsx(ShopCartPage, null);\n};","map":null,"metadata":{},"sourceType":"module"}