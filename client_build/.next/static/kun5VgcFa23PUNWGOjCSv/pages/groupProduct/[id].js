(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"9pAu":function(e,t,n){"use strict";n.r(t);var o=n("rePB"),r=n("KQm4"),u=n("o0o1"),i=n.n(u),l=n("HaE+"),a=n("q1tI"),c=n.n(a),d=n("zfZ/"),s=n.n(d),p=n("roQC"),f=n.n(p),v=n("nOHt"),b=n("+/yG"),m=n("i7FU"),g=n("U81q"),O=n("cBzo"),j=n("K0AU"),h=n("B42p"),y=n("vOnD"),w=n("+vfP"),x=n("ZtJr"),D=n("LXXt"),k=n("Z3vd"),C=n("GLZ+"),I=n("Oj7+"),P=n("oxxF"),N=n("r9w1"),A=n("jjAL"),S=n("PsDL"),L=n("cW92"),_=n("4Rmy"),Q=n("E2gh"),F=n.n(Q),U=n("7O+n"),E=n("c+KP"),z=n("q3aC"),B=n("n+/U"),G=n("+kHn"),T=n("OO/1"),q=c.a.createElement;function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=Object(b.c)("orderPageModel",{show:!1},{open:function(e,t){t.setData(Object(O.f)({show:!0}))},close:function(e,t){t.setData(Object(O.f)({show:!1}))}}),X=y.a.div.withConfig({displayName:"groupOrderPage__OrderPageBox",componentId:"bhof7w-0"})(["position:fixed;top:0;bottom:0;left:0;right:0;background:white;overflow-y:auto;> footer{position:fixed;bottom:0;box-sizing:border-box;box-shadow:",";width:100vw;text-align:right;}"],x.a.shadow[1]),Z=function(){var e,t,n,o,r,u,d=Object(v.useRouter)(),s=Object(g.b)(W),p=s.state,f=s.actions,b=Object(g.b)($),m=b.actions,j=b.state,y=j.product,x=Object(g.b)(E.c),D=x.state,k=x.actions;Object(a.useEffect)((function(){D.user.id||k.getOrderInfo()}),[]);var Q=Object(g.b)(z.b).actions,M=Object(g.b)(B.b).actions,Z=D.dealAddressData(D),H=(null===(e=D.payCardList)||void 0===e?void 0:e.find((function(e){return e.id===D.form.paymentMethodCardId})))||{},J=(null!==(t=y.priceOut)&&void 0!==t?t:0)*Y(y)*j.selectNum,K=D.dealTransportationCosts(D,J),V=j.dealDiscountAmount(j)+K+Object(O.a)(D.form.saleTax)-Object(O.a)(null===(n=D.form)||void 0===n?void 0:n.deductCoin),ee=.01*V;return Object(a.useEffect)((function(){return p.show&&(window.history.pushState(null,"",document.URL),window.addEventListener("popstate",(function(e){f.close()}),!1)),function(){window.removeEventListener("popstate",(function(e){f.close()}))}}),[p.show]),p.show&&q(c.a.Fragment,null,q(X,null,q(h.a,{title:"\u8ba2\u5355\u652f\u4ed8",backCall:function(){return f.close(),!0}}),q(C.b,{style:{padding:"20px"}},q("img",{src:Object(I.a)(null===y||void 0===y?void 0:null===(o=y.img)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:r.url),alt:""}),q("main",null,null===y||void 0===y?void 0:y.name,null===y||void 0===y?void 0:y.weight,null===y||void 0===y?void 0:y.unit),q("section",null,null===y||void 0===y?void 0:y.remark),q("footer",null,q(P.d,{priceOutTip:Object(w.a)("\u57fa\u51c6\u4ef7"),product:y}),q("span",null,Y(y)*j.selectNum,y.groupAmountUnitString,"/",j.selectNum,Object(w.a)("\u4efd")))),q(N.a,{style:{margin:"16px",width:"calc(100vw - 32px)"},fullWidth:!0,label:Object(w.a)("\u8fd0\u9001\u65b9\u5f0f"),select:!0,value:D.form.pickUpType,onChange:function(e){k.setForm(["pickUpType",e.target.value]),k.setForm(["addressId",D.initAddressId(Object(O.e)(D,{form:{pickUpType:e.target.value}}))])}},q(A.a,{value:_.h.Self},Object(w.a)(Object(_.l)(_.h.Self))),q(A.a,{value:_.h.Delivery},Object(w.a)(Object(_.l)(_.h.Delivery)))),q(U.a,null,q("main",null,q("header",null,"".concat(Z.combineAddress)),q("footer",null,"".concat(Z.name," ").concat(Z.contactInformation))),q("aside",null,q(S.a,{onClick:Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.openClick();case 2:(t=e.sent)&&k.setForm(["addressId",t]);case 4:case"end":return e.stop()}}),e)})))},q(F.a,null)))),q(U.e,null,q(L.b,{w:20}),Object(w.a)("\u4ed8\u6b3e\u65b9\u5f0f")),q(U.b,null,q("header",null,H.name),q("footer",null,H.number),q("aside",null,q(S.a,{onClick:Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.openClick();case 2:(t=e.sent)&&k.setForm(["paymentMethodCardId",t]);case 4:case"end":return e.stop()}}),e)})))},q(F.a,null)))),q(z.a,null),q(B.a,null),q(U.e,null,q(L.b,{w:20}),Object(w.a)("\u4f7f\u7528\u8fbe\u4eba\u5e01"),q(L.b,{w:16}),q("footer",null,Object(w.a)("\u5f53\u6708\u53ef\u7528\u4f59\u989d"),Object(O.b)(D.user.orderCoinCurrentMonth))),q("div",null,q(L.b,{w:20}),q(N.a,{style:{marginTop:"8px",marginBottom:"24px"},label:Object(w.a)(""),value:D.form.deductCoin,onChange:function(e){k.setForm(["deductCoin",e.target.value])}})),q(U.f,null,q("header",null,Object(w.a)("\u8d2d\u7269\u8f66\u603b\u8ba1")),q("footer",null,Object(O.b)(J))),q(U.f,null,q("header",null,Object(w.a)("\u4efd\u6570\u6298\u6263")),q("footer",null,j.numDiscount)),q(U.f,null,q("header",null,Object(w.a)("\u6210\u56e2\u6298\u4e0a\u6298")),q("footer",null,j.groupDiscount)),K>0&&q(U.f,null,q("header",null,Object(w.a)("\u8fd0\u8d39")),q("footer",null,Object(O.b)(K))),q(U.f,null,q("header",null,Object(w.a)("\u8fbe\u4eba\u5e01\u62b5\u6263")),q("footer",null,Object(O.b)(D.form.deductCoin,"-"))),q(U.f,{style:{fontSize:"18px"}},q("header",null,Object(w.a)("\u8ba2\u5355\u603b\u989d")),q("footer",null,Object(O.b)(V))),q(L.b,{h:120}),q(U.c,null,q("header",null,Object(w.a)("\u672c\u6b21\u8ba2\u5355"),q("span",null,Object(w.a)(null===(u=D.userLevelList.find((function(e){var t;return e.code===(null===(t=D.user.userInfo)||void 0===t?void 0:t.userLevel)})))||void 0===u?void 0:u.name))),q("footer",null,Object(w.a)("\u5c06\u83b7\u5f97\u4e0b\u6708\u4f7f\u7528\u8fbe\u4eba\u5e01 "),q("span",null,Object(O.b)(ee))),q("aside",null,q(G.a,{variant:"contained",color:"secondary",onClick:Object(l.a)(i.a.mark((function e(){var t,n,o,r,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object(O.a)(null===(t=D.user)||void 0===t?void 0:t.orderCoinCurrentMonth)<Object(O.a)(D.form.deductCoin))){e.next=3;break}return Object(T.b)(Object(w.a)("\u8fbe\u4eba\u5e01\u4f59\u989d\u4e0d\u8db3")),e.abrupt("return");case 3:return e.next=5,m.submit({orderInfoItemInput:R(R({},D.form),{},{generateCoin:ee,actuallyPaid:V,transportationCosts:K,subtotal:J,currentUserLevel:null===(n=D.user.userInfo)||void 0===n?void 0:n.userLevel,rOrderProduct:[{count:j.selectNum,productId:null===y||void 0===y?void 0:y.id,product:y}]})});case 5:if(!(null===(r=e.sent)||void 0===r?void 0:null===(o=r.saveGroupOrder)||void 0===o?void 0:o.id)){e.next=15;break}return Object(T.b)("\u64cd\u4f5c\u6210\u529f \u5c06\u524d\u5f80\u4ed8\u6b3e"),l=Object(O.c)({orderId:null===r||void 0===r?void 0:null===(u=r.saveGroupOrder)||void 0===u?void 0:u.id}),e.next=11,d.replace("/pay".concat(l),"/pay".concat(l));case 11:k.clearData(),k.getList(),m.clearData(),f.close();case 15:case"end":return e.stop()}}),e)})))},Object(w.a)("\u63d0\u4ea4\u8ba2\u5355"))))))||null},H=c.a.createElement;function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=function(e){var t;return(null!==(t=100-e)&&void 0!==t?t:0)/100},Y=function(e){var t,n;return~~((null!==(t=e.groupAmount)&&void 0!==t?t:0)/(null!==(n=e.groupPrecision)&&void 0!==n?n:1))},$=Object(b.c)("groupProductModel",{product:{},groupQueueList:[],selectNum:0,selectQueueId:"",numDiscount:1,groupDiscount:1,groupDiscountConfig:{},dealDiscountAmountUnit:function(e){var t;return(null!==(t=e.product.priceOut)&&void 0!==t?t:0)*e.numDiscount*e.groupDiscount},dealDiscountAmount:function(e){var t;return(null!==(t=e.product.priceOut)&&void 0!==t?t:0)*e.selectNum*Y(e.product)*e.numDiscount*e.groupDiscount}},{getData:function(){var e=Object(l.a)(i.a.mark((function e(t,n){var o,r,u,l,a,c,d,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.query(m.b.productListByIds,{ids:[t]});case 2:return c=e.sent,e.next=5,n.query(m.b.groupQueueList,{groupQueueItemInput:{product:{id:t}}});case 5:return d=e.sent,e.next=8,n.query(m.c,{data:{type:_.d.GroupPrecision}},{});case 8:s=e.sent,n.setData(Object(O.f)({product:null!==(o=null===c||void 0===c?void 0:null===(r=c.productListByIds)||void 0===r?void 0:r.list[0])&&void 0!==o?o:{},groupQueueList:null!==(u=null===d||void 0===d?void 0:null===(l=d.groupQueueList)||void 0===l?void 0:l.sort((function(e,t){var n,o;return(null!==(n=e.sumFillAmount)&&void 0!==n?n:0)-(null!==(o=t.sumFillAmount)&&void 0!==o?o:0)})))&&void 0!==u?u:[],groupDiscountConfig:null===s||void 0===s?void 0:null===(a=s.getDataConfig)||void 0===a?void 0:a.value}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),updateSelectNum:function(e,t){var n,o,u,i,l,a,c,d,s,p=t.data.groupDiscountConfig,f=e===t.data.selectNum?0:e,v=e===t.data.selectNum?"":null!==(n=null===(o=Object(r.a)(t.data.groupQueueList).reverse())||void 0===o?void 0:null===(u=o.find((function(n){var o,r,u,i;return(null!==(o=n.sumFillAmount)&&void 0!==o?o:0)+e<=(null!==(r=null===(u=t.data)||void 0===u?void 0:null===(i=u.product)||void 0===i?void 0:i.groupPrecision)&&void 0!==r?r:0)})))||void 0===u?void 0:u.id)&&void 0!==n?n:"";t.setData(Object(O.f)({selectNum:f,selectQueueId:v,groupDiscount:(null!==(i=null===(l=t.data.groupQueueList.find((function(e){return e.id===v})))||void 0===l?void 0:l.sumFillAmount)&&void 0!==i?i:0)+f===t.data.product.groupPrecision?V(p.groupDiscount):1,numDiscount:null!==(a=V(null===p||void 0===p?void 0:null===(c=p[null!==(s=t.data.product.groupPrecision)&&void 0!==s?s:0])||void 0===c?void 0:null===(d=c.discount)||void 0===d?void 0:d[f]))&&void 0!==a?a:1}))},clearData:function(e,t){t.setData(Object(O.f)({selectNum:0,selectQueueId:"",numDiscount:1,groupDiscount:1}))},submit:function(){var e=Object(l.a)(i.a.mark((function e(t,n){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.orderInfoItemInput,e.next=3,n.mutate(m.b.saveGroupOrder,{orderInfoItemInput:K({},o),groupOrderItemInput:{orderGroupAmount:n.data.selectNum},groupQueueItemInput:K({product:n.data.product},n.data.selectQueueId?{id:n.data.selectQueueId}:{})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}),ee=y.a.div.withConfig({displayName:"id__PriceRed",componentId:"sc-1c5vpsf-0"})(["background:",";color:white;display:grid;grid-template-columns:1fr 120px;grid-template-rows:repeat(2,30px);align-items:center;> main{grid-area:1/1/3/2;padding-left:20px;> span{margin-left:16px;}}"],x.a.red),te=y.a.div.withConfig({displayName:"id__Name",componentId:"sc-1c5vpsf-1"})(["padding:16px 20px;display:flex;align-items:flex-end;> main{font-size:22px;margin-right:8px;flex-shrink:0;}> section{> span{padding:0 4px;background:",";border-radius:4px;position:relative;bottom:-4px;margin-left:8px;display:inline-flex;align-items:center;}}"],D.a[700]),ne=function(){return H(s.a,{fontSize:"small",style:{color:"#FDD334"}})},oe=y.a.header.withConfig({displayName:"id__Title",componentId:"sc-1c5vpsf-2"})(["font-size:20px;"]),re=y.a.div.withConfig({displayName:"id__GroupQueueBox",componentId:"sc-1c5vpsf-3"})(["padding:16px;"]),ue=y.a.div.withConfig({displayName:"id__SmartMatch",componentId:"sc-1c5vpsf-4"})(["padding:16px 16px 90px;> section{margin-top:8px;display:flex;align-items:center;}> main{> svg{font-size:3.0rem;}}"]),ie=y.a.div.withConfig({displayName:"id__Price",componentId:"sc-1c5vpsf-5"})(["margin-top:8px;display:flex;justify-content:space-between;align-items:center;> main{font-weight:bold;}> main,section{> *{text-align:center;}}"]),le=y.a.div.withConfig({displayName:"id__Submit",componentId:"sc-1c5vpsf-6"})(["position:fixed;height:60px;bottom:0;width:100vw;background:white;border-top:1px solid ",";display:flex;align-items:center;justify-content:space-between;box-shadow:",";> aside{padding-left:16px;color:",";}"],x.a.red,x.a.shadow[1],x.a.red),ae=y.a.div.withConfig({displayName:"id__GroupQueueListBox",componentId:"sc-1c5vpsf-7"})(["margin-top:16px;border-radius:8px;background:",";display:flex;justify-content:space-between;align-items:center;padding:0 8px;"],(function(e){return e.select?"linear-gradient(to right, ".concat(x.a.red,", #FC7361)"):D.a[200]}));t.default=function(){var e,t,n,o,u=null!==(e=null===(t=Object(v.useRouter)().query)||void 0===t?void 0:t.id)&&void 0!==e?e:"",i=Object(g.b)($),l=i.actions,c=i.state;Object(a.useEffect)((function(){l.getData(u)}),[u]);var d=Object(g.b)(W).actions,p=c.product;return H("div",null,H(h.a,{title:"\u4ea7\u54c1\u8be6\u60c5"}),H(j.a,{height:"240px",dataList:null===p||void 0===p?void 0:null===(n=p.img)||void 0===n?void 0:n.map((function(e){return K(K({},e),{},{imgUrl:null===e||void 0===e?void 0:e.url})}))}),H(ee,null,H("main",null,Object(w.a)("\u57fa\u51c6\u4ef7\u683c"),H("span",null,Object(O.b)(p.priceOut),"/",p.packingUnitString)),H("aside",null,Object(w.a)("\u5df2\u6210\u56e2"),c.groupQueueList.filter((function(e){return e.sumFillAmount===(null===p||void 0===p?void 0:p.groupPrecision)})).length,Object(w.a)("\u5355")),H("aside",null,Object(w.a)("\u62fc\u56e2\u4e2d"),c.groupQueueList.filter((function(e){var t,n;return(null!==(t=e.sumFillAmount)&&void 0!==t?t:0)<(null!==(n=null===p||void 0===p?void 0:p.groupPrecision)&&void 0!==n?n:0)})).length,Object(w.a)("\u5355"))),H(te,null,H("main",null,p.name),H("section",null,p.groupRemark,"/",p.groupAmount,p.groupAmountUnitString," ","\u6bcf\u4e00\u4efd".concat(Y(p)).concat(p.groupAmountUnitString),H("br",null),Object(w.a)("\u5206\u56e2\u7cbe\u5ea6"),H("span",null,Object(r.a)(Array(p.groupPrecision)).map((function(e,t){return t})).map((function(e){return H(ne,{key:e})}))))),H(re,null,H(oe,null,Object(w.a)("\u62fc\u56e2\u4e2d")),c.groupQueueList.filter((function(e){var t,n;return(null!==(t=e.sumFillAmount)&&void 0!==t?t:0)<(null!==(n=null===p||void 0===p?void 0:p.groupPrecision)&&void 0!==n?n:0)})).map((function(e){var t,n=e.id===c.selectQueueId;return H(ae,{select:n,key:"GroupQueueListBox".concat(e.id)},H("aside",null,Object(r.a)(Array(p.groupPrecision)).map((function(e,t){return t})).map((function(t){var o;return t+1>(null!==(o=e.sumFillAmount)&&void 0!==o?o:0)+(n?c.selectNum:0)?H(f.a,{key:"clickStar".concat(t),fontSize:"large",onClick:function(){return l.updateSelectNum(t+1)},style:{color:n?"#fff":"#000"}}):H(s.a,{key:"clickStar".concat(t),style:{color:"#FDD334"},fontSize:"large",onClick:function(){return l.updateSelectNum(t+1)}})}))),H("footer",null,Object(w.a)((null!==(t=e.sumFillAmount)&&void 0!==t?t:0)+(n?c.selectNum:0)===p.groupPrecision?"\u6210\u56e2\u5566":"\u672a\u6210\u56e2")))}))),H(ue,null,H("header",null,H(oe,null,Object(w.a)("\u667a\u80fd\u5339\u914d"))),H("section",null,Object(w.a)("\u8bf7\u70b9\u51fb"),H(f.a,null),Object(w.a)("\u786e\u5b9a\u60a8\u9700\u8981\u7684\u4efd\u6570")),H("main",null,Object(r.a)(Array(p.groupPrecision)).map((function(e,t){return t})).map((function(e){return e+1>c.selectNum?H(f.a,{key:"clickStar".concat(e),fontSize:"large",onClick:function(){return l.updateSelectNum(e+1)}}):H(s.a,{key:"clickStar".concat(e),style:{color:"#FDD334"},fontSize:"large",onClick:function(){return l.updateSelectNum(e+1)}})}))),H(ie,null,H("main",null,H("header",null,Object(O.b)(c.dealDiscountAmountUnit(c))),H("footer",null,Object(w.a)("\u6298\u540e\u4ef7\u683c"))),H("div",null,"="),H("section",null,H("header",null,Object(O.b)(null!==(o=p.priceOut)&&void 0!==o?o:0)),H("footer",null,Object(w.a)("\u57fa\u51c6\u4ef7\u683c"))),H("div",null,"x"),H("section",null,H("header",null,c.numDiscount),H("footer",null,Object(w.a)("\u4efd\u6570\u6298\u6263"))),H("div",null,"x"),H("section",null,H("header",null,c.groupDiscount),H("footer",null,Object(w.a)("\u6210\u56e2\u6298\u4e0a\u6298"))))),H(le,null,H("aside",null,Object(w.a)("\u9009\u62e9\u4e86"),c.selectNum,Object(w.a)("\u4efd")),H(k.a,{disabled:0===c.selectNum,style:{height:"100%",padding:"0 32px",borderRadius:"0",fontSize:"18px"},color:"secondary",variant:"contained",onClick:function(){d.open()}},Object(w.a)("\u53bb\u7ed3\u7b97"))),H(Z,null))}},rOW0:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/groupProduct/[id]",function(){return n("9pAu")}])}},[["rOW0",1,0,5,2,3,4,6,7,8,9,10,12]]]);